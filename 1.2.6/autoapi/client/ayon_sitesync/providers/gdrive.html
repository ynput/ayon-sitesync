<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=dropbox.html><link rel=next href=lib.html><link rel=icon href=../../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>gdrive - ayon-sitesync</title><link rel=stylesheet href=../../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.ab4e12ef.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../css/custom.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#client.ayon_sitesync.providers.gdrive class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../index.html title=ayon-sitesync class="md-header__button md-logo" aria-label=ayon-sitesync data-md-component=logo> <img src=../../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-sitesync </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> gdrive </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ynput/ayon-sitesync title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../index.html title=ayon-sitesync class="md-nav__button md-logo" aria-label=ayon-sitesync data-md-component=logo> <img src=../../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-sitesync </label> <div class=md-nav__source> <a href=https://github.com/ynput/ayon-sitesync title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> client </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> client </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1 checked> <label class=md-nav__link for=__nav_3_1_1 id=__nav_3_1_1_label tabindex=0> <span class=md-ellipsis> ayon_sitesync </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> ayon_sitesync </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../addon.html class=md-nav__link> <span class=md-ellipsis> addon </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../launch_hooks/pre_copy_last_published_workfile.html class=md-nav__link> <span class=md-ellipsis> launch_hooks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../plugins/publish/integrate_site_sync.html class=md-nav__link> <span class=md-ellipsis> plugins </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_4 checked> <label class=md-nav__link for=__nav_3_1_1_4 id=__nav_3_1_1_4_label tabindex=0> <span class=md-ellipsis> providers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_1_1_4_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_4> <span class="md-nav__icon md-icon"></span> providers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=abstract_provider.html class=md-nav__link> <span class=md-ellipsis> abstract_provider </span> </a> </li> <li class=md-nav__item> <a href=dropbox.html class=md-nav__link> <span class=md-ellipsis> dropbox </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> gdrive </span> <span class="md-nav__icon md-icon"></span> </label> <a href=gdrive.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> gdrive </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive class=md-nav__link> <span class=md-ellipsis> gdrive </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler class=md-nav__link> <span class=md-ellipsis> GDriveHandler </span> </a> <nav class=md-nav aria-label=GDriveHandler> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.create_folder class=md-nav__link> <span class=md-ellipsis> create_folder </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.delete_file class=md-nav__link> <span class=md-ellipsis> delete_file </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.delete_folder class=md-nav__link> <span class=md-ellipsis> delete_folder </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.download_file class=md-nav__link> <span class=md-ellipsis> download_file </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.file_exists class=md-nav__link> <span class=md-ellipsis> file_exists </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.file_path_exists class=md-nav__link> <span class=md-ellipsis> file_path_exists </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.folder_path_exists class=md-nav__link> <span class=md-ellipsis> folder_path_exists </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.get_roots_config class=md-nav__link> <span class=md-ellipsis> get_roots_config </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.get_tree class=md-nav__link> <span class=md-ellipsis> get_tree </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.is_active class=md-nav__link> <span class=md-ellipsis> is_active </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.list_files class=md-nav__link> <span class=md-ellipsis> list_files </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.list_folder class=md-nav__link> <span class=md-ellipsis> list_folder </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.list_folders class=md-nav__link> <span class=md-ellipsis> list_folders </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.upload_file class=md-nav__link> <span class=md-ellipsis> upload_file </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=lib.html class=md-nav__link> <span class=md-ellipsis> lib </span> </a> </li> <li class=md-nav__item> <a href=local_drive.html class=md-nav__link> <span class=md-ellipsis> local_drive </span> </a> </li> <li class=md-nav__item> <a href=sftp.html class=md-nav__link> <span class=md-ellipsis> sftp </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../sitesync.html class=md-nav__link> <span class=md-ellipsis> sitesync </span> </a> </li> <li class=md-nav__item> <a href=../utils.html class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> <li class=md-nav__item> <a href=../version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../server/settings/models.html class=md-nav__link> <span class=md-ellipsis> server </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive class=md-nav__link> <span class=md-ellipsis> gdrive </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler class=md-nav__link> <span class=md-ellipsis> GDriveHandler </span> </a> <nav class=md-nav aria-label=GDriveHandler> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.create_folder class=md-nav__link> <span class=md-ellipsis> create_folder </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.delete_file class=md-nav__link> <span class=md-ellipsis> delete_file </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.delete_folder class=md-nav__link> <span class=md-ellipsis> delete_folder </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.download_file class=md-nav__link> <span class=md-ellipsis> download_file </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.file_exists class=md-nav__link> <span class=md-ellipsis> file_exists </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.file_path_exists class=md-nav__link> <span class=md-ellipsis> file_path_exists </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.folder_path_exists class=md-nav__link> <span class=md-ellipsis> folder_path_exists </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.get_roots_config class=md-nav__link> <span class=md-ellipsis> get_roots_config </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.get_tree class=md-nav__link> <span class=md-ellipsis> get_tree </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.is_active class=md-nav__link> <span class=md-ellipsis> is_active </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.list_files class=md-nav__link> <span class=md-ellipsis> list_files </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.list_folder class=md-nav__link> <span class=md-ellipsis> list_folder </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.list_folders class=md-nav__link> <span class=md-ellipsis> list_folders </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.providers.gdrive.GDriveHandler.upload_file class=md-nav__link> <span class=md-ellipsis> upload_file </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../../../../index.html class=md-path__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-path__item> <a href=../addon.html class=md-path__link> <span class=md-ellipsis> Reference </span> </a> </li> <li class=md-path__item> <a href=../addon.html class=md-path__link> <span class=md-ellipsis> client </span> </a> </li> <li class=md-path__item> <a href=../addon.html class=md-path__link> <span class=md-ellipsis> ayon_sitesync </span> </a> </li> <li class=md-path__item> <a href=abstract_provider.html class=md-path__link> <span class=md-ellipsis> providers </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1>gdrive</h1> <div class="doc doc-object doc-module"> <a id=client.ayon_sitesync.providers.gdrive></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=client.ayon_sitesync.providers.gdrive.GDriveHandler class="doc doc-heading"> <code>GDriveHandler</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=ayon_sitesync.providers.abstract_provider.AbstractProvider>AbstractProvider</span></code></p> <p>Implementation of Google Drive API. As GD API doesn't have real folder structure, 'tree' in memory structure is build in constructor to map folder paths to folder ids, which are used in API. Building of this tree might be expensive and slow and should be run only when necessary. Currently is set to lazy creation, created only after first call when necessary.</p> <p>Configuration for provider is in 'settings/defaults/project_settings/global.json'</p> <p>Settings could be overwritten per project.</p> <details class=example-of-config open> <summary>Example of config</summary> <p>"gdrive": { - site name "provider": "gdrive", - type of provider, label must be registered "credentials_url": "/my_secret_folder/credentials.json", "root": { - could be "root": "/My Drive" for single root "root_one": "/My Drive", "root_two": "/My Drive/different_folder" } }</p> </details> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span>
<span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span>
<span class=normal>675</span>
<span class=normal>676</span>
<span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span>
<span class=normal>687</span>
<span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span>
<span class=normal>744</span>
<span class=normal>745</span>
<span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span>
<span class=normal>749</span>
<span class=normal>750</span>
<span class=normal>751</span>
<span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>GDriveHandler</span><span class=p>(</span><span class=n>AbstractProvider</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Implementation of Google Drive API.</span>
<span class=sd>        As GD API doesn&#39;t have real folder structure, &#39;tree&#39; in memory</span>
<span class=sd>        structure is build in constructor to map folder paths to folder ids,</span>
<span class=sd>        which are used in API. Building of this tree might be expensive and</span>
<span class=sd>        slow and should be run only when necessary. Currently is set to</span>
<span class=sd>        lazy creation, created only after first call when necessary.</span>

<span class=sd>        Configuration for provider is in</span>
<span class=sd>            &#39;settings/defaults/project_settings/global.json&#39;</span>

<span class=sd>        Settings could be overwritten per project.</span>

<span class=sd>        Example of config:</span>
<span class=sd>          &quot;gdrive&quot;: {   - site name</span>
<span class=sd>            &quot;provider&quot;: &quot;gdrive&quot;, - type of provider, label must be registered</span>
<span class=sd>            &quot;credentials_url&quot;: &quot;/my_secret_folder/credentials.json&quot;,</span>
<span class=sd>            &quot;root&quot;: {  - could be &quot;root&quot;: &quot;/My Drive&quot; for single root</span>
<span class=sd>                &quot;root_one&quot;: &quot;/My Drive&quot;,</span>
<span class=sd>                &quot;root_two&quot;: &quot;/My Drive/different_folder&quot;</span>
<span class=sd>            }</span>
<span class=sd>          }</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>CODE</span> <span class=o>=</span> <span class=s2>&quot;gdrive&quot;</span>
    <span class=n>LABEL</span> <span class=o>=</span> <span class=s2>&quot;Google Drive&quot;</span>

    <span class=n>FOLDER_STR</span> <span class=o>=</span> <span class=s2>&quot;application/vnd.google-apps.folder&quot;</span>
    <span class=n>MY_DRIVE_STR</span> <span class=o>=</span> <span class=s2>&quot;My Drive&quot;</span>  <span class=c1># name of root folder of regular Google drive</span>
    <span class=n>CHUNK_SIZE</span> <span class=o>=</span> <span class=mi>2097152</span>  <span class=c1># must be divisible by 256! used for upload chunks</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>tree</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>presets</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>active</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>project_name</span> <span class=o>=</span> <span class=n>project_name</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>site_name</span> <span class=o>=</span> <span class=n>site_name</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>service</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>root</span> <span class=o>=</span> <span class=kc>None</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>presets</span> <span class=o>=</span> <span class=n>presets</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>presets</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
                <span class=s2>&quot;Sync Server: There are no presets for </span><span class=si>{}</span><span class=s2>.&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=k>return</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>presets</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enabled&quot;</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                <span class=s2>&quot;Sync Server: Site </span><span class=si>{}</span><span class=s2> not enabled for </span><span class=si>{}</span><span class=s2>.&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>site_name</span><span class=p>,</span> <span class=n>project_name</span>
                <span class=p>)</span>
            <span class=p>)</span>
            <span class=k>return</span>

        <span class=n>current_platform</span> <span class=o>=</span> <span class=n>platform</span><span class=o>.</span><span class=n>system</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=n>cred_paths</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>presets</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;credentials_url&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span> \
            <span class=n>get</span><span class=p>(</span><span class=n>current_platform</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
        <span class=n>cred_path</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>for</span> <span class=n>check_path</span> <span class=ow>in</span> <span class=n>cred_paths</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>check_path</span><span class=p>):</span>
                <span class=k>continue</span>
            <span class=n>cred_path</span> <span class=o>=</span> <span class=n>check_path</span>
            <span class=k>break</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>cred_path</span><span class=p>:</span>
            <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Sync Server: Please, fill the credentials for gdrive &quot;</span>\
                  <span class=s2>&quot;provider for platform &#39;</span><span class=si>{}</span><span class=s2>&#39; !&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>current_platform</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
            <span class=k>return</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>cred_path</span> <span class=o>=</span> <span class=n>cred_path</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>**</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>KeyError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>((</span>
                <span class=s2>&quot;Sync Server: The key(s) </span><span class=si>{}</span><span class=s2> does not exist in the &quot;</span>
                <span class=s2>&quot;environment variables&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&quot; &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>args</span><span class=p>)))</span>
            <span class=k>return</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>cred_path</span><span class=p>):</span>
            <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Sync Server: No credentials for gdrive provider &quot;</span> <span class=o>+</span> \
                  <span class=s2>&quot;for &#39;</span><span class=si>{}</span><span class=s2>&#39; on path &#39;</span><span class=si>{}</span><span class=s2>&#39;!&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>site_name</span><span class=p>,</span> <span class=n>cred_path</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
            <span class=k>return</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>service</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>service</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_gd_service</span><span class=p>(</span><span class=n>cred_path</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_tree</span> <span class=o>=</span> <span class=n>tree</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>active</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>def</span><span class=w> </span><span class=nf>is_active</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Returns True if provider is activated, eg. has working credentials.</span>
<span class=sd>        Returns:</span>
<span class=sd>            (boolean)</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>presets</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enabled&quot;</span><span class=p>)</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_roots_config</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>anatomy</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Returns root values for path resolving</span>

<span class=sd>            Use only Settings as GDrive cannot be modified by Local Settings</span>

<span class=sd>        Returns:</span>
<span class=sd>            (dict) - {&quot;root&quot;: {&quot;root&quot;: &quot;/My Drive&quot;}}</span>
<span class=sd>                     OR</span>
<span class=sd>                     {&quot;root&quot;: {&quot;root_ONE&quot;: &quot;value&quot;, &quot;root_TWO&quot;:&quot;value}}</span>
<span class=sd>            Format is importing for usage of python&#39;s format ** approach</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># GDrive roots cannot be locally overridden</span>
        <span class=c1># TODO implement multiple roots</span>
        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;root&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;work&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>presets</span><span class=p>[</span><span class=s2>&quot;root&quot;</span><span class=p>]}}</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_tree</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Building of the folder tree could be potentially expensive,</span>
<span class=sd>            constructor provides argument that could inject previously created</span>
<span class=sd>            tree.</span>
<span class=sd>            Tree structure must be handled in thread safe fashion!</span>
<span class=sd>        Returns:</span>
<span class=sd>             (dictionary) - url to id mapping</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tree</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_tree</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_build_tree</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>list_folders</span><span class=p>())</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tree</span>

    <span class=k>def</span><span class=w> </span><span class=nf>create_folder</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Create all nonexistent folders and subfolders in &#39;path&#39;.</span>
<span class=sd>            Updates self._tree structure with new paths</span>

<span class=sd>        Args:</span>
<span class=sd>            path (string): absolute path, starts with GDrive root,</span>
<span class=sd>                           without filename</span>
<span class=sd>        Returns:</span>
<span class=sd>            (string) folder id of lowest subfolder from &#39;path&#39;</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>folder_id</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>folder_id</span>
        <span class=n>parts</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)</span>
        <span class=n>folders_to_create</span> <span class=o>=</span> <span class=p>[]</span>

        <span class=k>while</span> <span class=n>parts</span><span class=p>:</span>
            <span class=n>folders_to_create</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>parts</span><span class=o>.</span><span class=n>pop</span><span class=p>())</span>
            <span class=n>path</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span>
            <span class=n>path</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
            <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>  <span class=c1># lowest common path</span>
            <span class=k>if</span> <span class=n>folder_id</span><span class=p>:</span>
                <span class=k>while</span> <span class=n>folders_to_create</span><span class=p>:</span>
                    <span class=n>new_folder_name</span> <span class=o>=</span> <span class=n>folders_to_create</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span>
                    <span class=n>folder_metadata</span> <span class=o>=</span> <span class=p>{</span>
                        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>new_folder_name</span><span class=p>,</span>
                        <span class=s2>&quot;mimeType&quot;</span><span class=p>:</span> <span class=s2>&quot;application/vnd.google-apps.folder&quot;</span><span class=p>,</span>
                        <span class=s2>&quot;parents&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>folder_id</span><span class=p>]</span>
                    <span class=p>}</span>
                    <span class=n>folder</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
                        <span class=n>body</span><span class=o>=</span><span class=n>folder_metadata</span><span class=p>,</span>
                        <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                        <span class=n>fields</span><span class=o>=</span><span class=s2>&quot;id&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
                    <span class=n>folder_id</span> <span class=o>=</span> <span class=n>folder</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>

                    <span class=n>new_path_key</span> <span class=o>=</span> <span class=n>path</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>new_folder_name</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>get_tree</span><span class=p>()[</span><span class=n>new_path_key</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>folder_id</span><span class=p>}</span>

                    <span class=n>path</span> <span class=o>=</span> <span class=n>new_path_key</span>
                <span class=k>return</span> <span class=n>folder_id</span>

    <span class=k>def</span><span class=w> </span><span class=nf>upload_file</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>source_path</span><span class=p>,</span>
        <span class=n>target_path</span><span class=p>,</span>
        <span class=n>addon</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>file</span><span class=p>,</span>
        <span class=n>repre_status</span><span class=p>,</span>
        <span class=n>site_name</span><span class=p>,</span>
        <span class=n>overwrite</span><span class=o>=</span><span class=kc>False</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Uploads single file from &#39;source_path&#39; to destination &#39;path&#39;.</span>
<span class=sd>            It creates all folders on the path if are not existing.</span>

<span class=sd>        Args:</span>
<span class=sd>            source_path (string): absolute path on provider</span>
<span class=sd>            target_path (string): absolute path with or without name of the file</span>
<span class=sd>            addon (SiteSyncAddon): addon instance to call update_db on</span>
<span class=sd>            project_name (str):</span>
<span class=sd>            file (dict): info about uploaded file (matches structure from db)</span>
<span class=sd>            repre_status (dict): complete representation containing</span>
<span class=sd>                sync progress</span>
<span class=sd>            site_name (str): site name</span>
<span class=sd>            overwrite (boolean): replace existing file</span>

<span class=sd>        Returns:</span>
<span class=sd>            (string) file_id of created/modified file ,</span>
<span class=sd>                throws FileExistsError, FileNotFoundError exceptions</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>source_path</span><span class=p>):</span>
            <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=s2>&quot;Source file </span><span class=si>{}</span><span class=s2> doesn&#39;t exist.&quot;</span>
                                    <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>source_path</span><span class=p>))</span>

        <span class=n>root</span><span class=p>,</span> <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>ext</span><span class=p>:</span>
            <span class=c1># full path</span>
            <span class=n>target_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>
            <span class=n>target_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>target_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>source_path</span><span class=p>)</span>
        <span class=n>target_file</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_path_exists</span><span class=p>(</span><span class=n>target_path</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>target_name</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>target_file</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>overwrite</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>FileExistsError</span><span class=p>(</span><span class=s2>&quot;File already exists, &quot;</span>
                                  <span class=s2>&quot;use &#39;overwrite&#39; argument&quot;</span><span class=p>)</span>

        <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>folder_id</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>NotADirectoryError</span><span class=p>(</span>
                <span class=s2>&quot;Folder </span><span class=si>{}</span><span class=s2> doesn&#39;t exists&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>target_path</span><span class=p>))</span>

        <span class=n>file_metadata</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>target_name</span>
        <span class=p>}</span>
        <span class=n>media</span> <span class=o>=</span> <span class=n>MediaFileUpload</span><span class=p>(</span><span class=n>source_path</span><span class=p>,</span>
                                <span class=n>mimetype</span><span class=o>=</span><span class=s2>&quot;application/octet-stream&quot;</span><span class=p>,</span>
                                <span class=n>chunksize</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>CHUNK_SIZE</span><span class=p>,</span>
                                <span class=n>resumable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>target_file</span><span class=p>:</span>
                <span class=c1># update doesnt like parent</span>
                <span class=n>file_metadata</span><span class=p>[</span><span class=s2>&quot;parents&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>folder_id</span><span class=p>]</span>

                <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
                    <span class=n>body</span><span class=o>=</span><span class=n>file_metadata</span><span class=p>,</span>
                    <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                    <span class=n>media_body</span><span class=o>=</span><span class=n>media</span><span class=p>,</span>
                    <span class=n>fields</span><span class=o>=</span><span class=s2>&quot;id&quot;</span>
                <span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
                    <span class=n>fileId</span><span class=o>=</span><span class=n>target_file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                    <span class=n>body</span><span class=o>=</span><span class=n>file_metadata</span><span class=p>,</span>
                    <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                    <span class=n>media_body</span><span class=o>=</span><span class=n>media</span><span class=p>,</span>
                    <span class=n>fields</span><span class=o>=</span><span class=s2>&quot;id&quot;</span>
                <span class=p>)</span>

            <span class=n>media</span><span class=o>.</span><span class=n>stream</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Start Upload! </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>source_path</span><span class=p>))</span>
            <span class=n>last_tick</span> <span class=o>=</span> <span class=n>status</span> <span class=o>=</span> <span class=n>response</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=n>status_val</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>while</span> <span class=n>response</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>addon</span><span class=o>.</span><span class=n>is_representation_paused</span><span class=p>(</span>
                        <span class=n>repre_status</span><span class=p>[</span><span class=s2>&quot;representationId&quot;</span><span class=p>],</span>
                        <span class=n>check_parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                        <span class=n>project_name</span><span class=o>=</span><span class=n>project_name</span><span class=p>):</span>
                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Paused during process, please redo.&quot;</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>status</span><span class=p>:</span>
                    <span class=n>status_val</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>status</span><span class=o>.</span><span class=n>progress</span><span class=p>())</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>last_tick</span> <span class=ow>or</span> \
                        <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>last_tick</span> <span class=o>&gt;=</span> <span class=n>addon</span><span class=o>.</span><span class=n>LOG_PROGRESS_SEC</span><span class=p>:</span>
                    <span class=n>last_tick</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Uploaded </span><span class=si>%d%%</span><span class=s2>.&quot;</span> <span class=o>%</span> <span class=nb>int</span><span class=p>(</span><span class=n>status_val</span> <span class=o>*</span> <span class=mi>100</span><span class=p>))</span>
                    <span class=n>addon</span><span class=o>.</span><span class=n>update_db</span><span class=p>(</span>
                        <span class=n>project_name</span><span class=o>=</span><span class=n>project_name</span><span class=p>,</span>
                        <span class=n>new_file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
                        <span class=n>file</span><span class=o>=</span><span class=n>file</span><span class=p>,</span>
                        <span class=n>repre_status</span><span class=o>=</span><span class=n>repre_status</span><span class=p>,</span>
                        <span class=n>site_name</span><span class=o>=</span><span class=n>site_name</span><span class=p>,</span>
                        <span class=n>side</span><span class=o>=</span><span class=s2>&quot;remote&quot;</span><span class=p>,</span>
                        <span class=n>progress</span><span class=o>=</span><span class=n>status_val</span>
                    <span class=p>)</span>
                <span class=n>status</span><span class=p>,</span> <span class=n>response</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>next_chunk</span><span class=p>()</span>

        <span class=k>except</span> <span class=n>errors</span><span class=o>.</span><span class=n>HttpError</span> <span class=k>as</span> <span class=n>ex</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>ex</span><span class=o>.</span><span class=n>resp</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;404&quot;</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>False</span>
            <span class=k>if</span> <span class=n>ex</span><span class=o>.</span><span class=n>resp</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;403&quot;</span><span class=p>:</span>
                <span class=c1># real permission issue</span>
                <span class=k>if</span> <span class=s2>&quot;has not granted&quot;</span> <span class=ow>in</span> <span class=n>ex</span><span class=o>.</span><span class=n>_get_reason</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>():</span>
                    <span class=k>raise</span> <span class=ne>PermissionError</span><span class=p>(</span><span class=n>ex</span><span class=o>.</span><span class=n>_get_reason</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>

                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                    <span class=s2>&quot;Forbidden received, hit quota. Injecting 60s delay.&quot;</span>
                <span class=p>)</span>
                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>60</span><span class=p>)</span>
                <span class=k>return</span> <span class=kc>False</span>
            <span class=k>raise</span>
        <span class=k>return</span> <span class=n>response</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>download_file</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>source_path</span><span class=p>,</span>
        <span class=n>local_path</span><span class=p>,</span>
        <span class=n>addon</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>file</span><span class=p>,</span>
        <span class=n>repre_status</span><span class=p>,</span>
        <span class=n>site_name</span><span class=p>,</span>
        <span class=n>overwrite</span><span class=o>=</span><span class=kc>False</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Downloads single file from &#39;source_path&#39; (remote) to &#39;local_path&#39;.</span>
<span class=sd>            It creates all folders on the local_path if are not existing.</span>
<span class=sd>            By default existing file on &#39;local_path&#39; will trigger an exception</span>

<span class=sd>        Args:</span>
<span class=sd>            source_path (string): absolute path on provider</span>
<span class=sd>            local_path (string): absolute path with or without name of the file</span>
<span class=sd>            addon (SiteSyncAddon): addon instance to call update_db on</span>
<span class=sd>            project_name (str):</span>
<span class=sd>            file (dict): info about uploaded file (matches structure from db)</span>
<span class=sd>            repre_status (dict): complete representation containing</span>
<span class=sd>                sync progress</span>
<span class=sd>            site_name (str): site name</span>
<span class=sd>            overwrite (boolean): replace existing file</span>

<span class=sd>        Returns:</span>
<span class=sd>            (string) file_id of created/modified file ,</span>
<span class=sd>                throws FileExistsError, FileNotFoundError exceptions</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>remote_file</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_path_exists</span><span class=p>(</span><span class=n>source_path</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>remote_file</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=s2>&quot;Source file </span><span class=si>{}</span><span class=s2> doesn&#39;t exist.&quot;</span>
                                    <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>source_path</span><span class=p>))</span>

        <span class=n>root</span><span class=p>,</span> <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>ext</span><span class=p>:</span>
            <span class=c1># full path with file name</span>
            <span class=n>target_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
            <span class=n>local_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>  <span class=c1># just folder, get file name from source</span>
            <span class=n>target_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>source_path</span><span class=p>)</span>

        <span class=n>local_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>local_path</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>target_name</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>local_file</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>overwrite</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>FileExistsError</span><span class=p>(</span><span class=s2>&quot;File already exists, &quot;</span>
                                  <span class=s2>&quot;use &#39;overwrite&#39; argument&quot;</span><span class=p>)</span>

        <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>get_media</span><span class=p>(</span><span class=n>fileId</span><span class=o>=</span><span class=n>remote_file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                                                 <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>target_name</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fh</span><span class=p>:</span>
            <span class=n>downloader</span> <span class=o>=</span> <span class=n>MediaIoBaseDownload</span><span class=p>(</span><span class=n>fh</span><span class=p>,</span> <span class=n>request</span><span class=p>)</span>
            <span class=n>last_tick</span> <span class=o>=</span> <span class=n>status</span> <span class=o>=</span> <span class=n>response</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=n>status_val</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>while</span> <span class=n>response</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>addon</span><span class=o>.</span><span class=n>is_representation_paused</span><span class=p>(</span>
                    <span class=n>repre_status</span><span class=p>[</span><span class=s2>&quot;representationId&quot;</span><span class=p>],</span>
                    <span class=n>check_parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                    <span class=n>project_name</span><span class=o>=</span><span class=n>project_name</span>
                <span class=p>):</span>
                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Paused during process, please redo.&quot;</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>status</span><span class=p>:</span>
                    <span class=n>status_val</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>status</span><span class=o>.</span><span class=n>progress</span><span class=p>())</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>last_tick</span> <span class=ow>or</span> \
                        <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>last_tick</span> <span class=o>&gt;=</span> <span class=n>addon</span><span class=o>.</span><span class=n>LOG_PROGRESS_SEC</span><span class=p>:</span>
                    <span class=n>last_tick</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Downloaded </span><span class=si>%d%%</span><span class=s2>.&quot;</span> <span class=o>%</span> <span class=nb>int</span><span class=p>(</span><span class=n>status_val</span> <span class=o>*</span> <span class=mi>100</span><span class=p>))</span>
                    <span class=n>addon</span><span class=o>.</span><span class=n>update_db</span><span class=p>(</span>
                        <span class=n>project_name</span><span class=o>=</span><span class=n>project_name</span><span class=p>,</span>
                        <span class=n>new_file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
                        <span class=n>file</span><span class=o>=</span><span class=n>file</span><span class=p>,</span>
                        <span class=n>repre_status</span><span class=o>=</span><span class=n>repre_status</span><span class=p>,</span>
                        <span class=n>site_name</span><span class=o>=</span><span class=n>site_name</span><span class=p>,</span>
                        <span class=n>side</span><span class=o>=</span><span class=s2>&quot;local&quot;</span><span class=p>,</span>
                        <span class=n>progress</span><span class=o>=</span><span class=n>status_val</span>
                    <span class=p>)</span>
                <span class=n>status</span><span class=p>,</span> <span class=n>response</span> <span class=o>=</span> <span class=n>downloader</span><span class=o>.</span><span class=n>next_chunk</span><span class=p>()</span>

        <span class=k>return</span> <span class=n>target_name</span>

    <span class=k>def</span><span class=w> </span><span class=nf>delete_folder</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Deletes folder on GDrive. Checks if folder contains any files or</span>
<span class=sd>            subfolders. In that case raises error, could be overridden by</span>
<span class=sd>            &#39;force&#39; argument.</span>
<span class=sd>            In that case deletes folder on &#39;path&#39; and all its children.</span>

<span class=sd>        Args:</span>
<span class=sd>            path (string): absolute path on GDrive</span>
<span class=sd>            force (boolean): delete even if children in folder</span>

<span class=sd>        Returns:</span>
<span class=sd>            None</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>folder_id</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Not valid folder path </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

        <span class=n>fields</span> <span class=o>=</span> <span class=s2>&quot;nextPageToken, files(id, name, parents)&quot;</span>
        <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_q</span><span class=p>(</span><span class=s2>&quot;&#39;</span><span class=si>{}</span><span class=s2>&#39; in parents &quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>folder_id</span><span class=p>))</span>
        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
            <span class=n>q</span><span class=o>=</span><span class=n>q</span><span class=p>,</span>
            <span class=n>corpora</span><span class=o>=</span><span class=s2>&quot;allDrives&quot;</span><span class=p>,</span>
            <span class=n>includeItemsFromAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>pageSize</span><span class=o>=</span><span class=s2>&quot;1&quot;</span><span class=p>,</span>
            <span class=n>fields</span><span class=o>=</span><span class=n>fields</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
        <span class=n>children</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[])</span>
        <span class=k>if</span> <span class=n>children</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>force</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Folder </span><span class=si>{}</span><span class=s2> is not empty, use &#39;force&#39;&quot;</span><span class=o>.</span>
                             <span class=nb>format</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>fileId</span><span class=o>=</span><span class=n>folder_id</span><span class=p>,</span>
                                    <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>delete_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Deletes file from &#39;path&#39;. Expects path to specific file.</span>

<span class=sd>        Args:</span>
<span class=sd>            path: absolute path to particular file</span>

<span class=sd>        Returns:</span>
<span class=sd>            None</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>file</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_path_exists</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>file</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;File </span><span class=si>{}</span><span class=s2> doesn&#39;t exist&quot;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>fileId</span><span class=o>=</span><span class=n>file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                                    <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>list_folder</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>folder_path</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            List all files and subfolders of particular path non-recursively.</span>

<span class=sd>        Args:</span>
<span class=sd>            folder_path (string): absolut path on provider</span>
<span class=sd>        Returns:</span>
<span class=sd>             (list)</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>pass</span>

    <span class=nd>@time_function</span>
    <span class=k>def</span><span class=w> </span><span class=nf>list_folders</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot; Lists all folders in GDrive.</span>
<span class=sd>            Used to build in-memory structure of path to folder ids model.</span>

<span class=sd>        Returns:</span>
<span class=sd>            (list) of dictionaries(&#39;id&#39;, &#39;name&#39;, [parents])</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>folders</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>page_token</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>fields</span> <span class=o>=</span> <span class=s2>&quot;nextPageToken, files(id, name, parents)&quot;</span>
        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
            <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_q</span><span class=p>(</span><span class=s2>&quot;mimeType=&#39;application/vnd.google-apps.folder&#39;&quot;</span><span class=p>)</span>
            <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
                <span class=n>q</span><span class=o>=</span><span class=n>q</span><span class=p>,</span>
                <span class=n>pageSize</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span>
                <span class=n>corpora</span><span class=o>=</span><span class=s2>&quot;allDrives&quot;</span><span class=p>,</span>
                <span class=n>includeItemsFromAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>fields</span><span class=o>=</span><span class=n>fields</span><span class=p>,</span>
                <span class=n>pageToken</span><span class=o>=</span><span class=n>page_token</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
            <span class=n>folders</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[]))</span>
            <span class=n>page_token</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;nextPageToken&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>page_token</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>break</span>

        <span class=k>return</span> <span class=n>folders</span>

    <span class=k>def</span><span class=w> </span><span class=nf>list_files</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot; Lists all files in GDrive</span>
<span class=sd>            Runs loop through possibly multiple pages. Result could be large,</span>
<span class=sd>            if it would be a problem, change it to generator</span>
<span class=sd>        Returns:</span>
<span class=sd>            (list) of dictionaries(&#39;id&#39;, &#39;name&#39;, [parents])</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>files</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>page_token</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>fields</span> <span class=o>=</span> <span class=s2>&quot;nextPageToken, files(id, name, parents)&quot;</span>
        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
            <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_q</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
            <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
                <span class=n>q</span><span class=o>=</span><span class=n>q</span><span class=p>,</span>
                <span class=n>corpora</span><span class=o>=</span><span class=s2>&quot;allDrives&quot;</span><span class=p>,</span>
                <span class=n>includeItemsFromAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>fields</span><span class=o>=</span><span class=n>fields</span><span class=p>,</span>
                <span class=n>pageToken</span><span class=o>=</span><span class=n>page_token</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
            <span class=n>files</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[]))</span>
            <span class=n>page_token</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;nextPageToken&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>page_token</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>break</span>

        <span class=k>return</span> <span class=n>files</span>

    <span class=k>def</span><span class=w> </span><span class=nf>folder_path_exists</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Checks if path from &#39;file_path&#39; exists. If so, return its</span>
<span class=sd>            folder id.</span>
<span class=sd>        Args:</span>
<span class=sd>            file_path (string): gdrive path with / as a separator</span>
<span class=sd>        Returns:</span>
<span class=sd>            (string) folder id or False</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>file_path</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>False</span>

        <span class=n>root</span><span class=p>,</span> <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>ext</span><span class=p>:</span>
            <span class=n>file_path</span> <span class=o>+=</span> <span class=s2>&quot;/&quot;</span>

        <span class=n>dir_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>

        <span class=n>path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>dir_path</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>path</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>path</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>

        <span class=k>return</span> <span class=kc>False</span>

    <span class=k>def</span><span class=w> </span><span class=nf>file_path_exists</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Checks if &#39;file_path&#39; exists on GDrive</span>

<span class=sd>        Args:</span>
<span class=sd>            file_path (string): separated by &#39;/&#39;, from root, with file name</span>
<span class=sd>        Returns:</span>
<span class=sd>            (dictionary|boolean) file metadata | False if not found</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>folder_id</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>),</span> <span class=n>folder_id</span><span class=p>)</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=k>def</span><span class=w> </span><span class=nf>file_exists</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_name</span><span class=p>,</span> <span class=n>folder_id</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Checks if &#39;file_name&#39; exists in &#39;folder_id&#39;</span>

<span class=sd>        Args:</span>
<span class=sd>            file_name (string):</span>
<span class=sd>            folder_id (int): google drive folder id</span>

<span class=sd>        Returns:</span>
<span class=sd>            (dictionary|boolean) file metadata, False if not found</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_q</span><span class=p>(</span><span class=s2>&quot;name = &#39;</span><span class=si>{}</span><span class=s2>&#39; and &#39;</span><span class=si>{}</span><span class=s2>&#39; in parents&quot;</span>
                           <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=n>folder_id</span><span class=p>))</span>
        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
            <span class=n>q</span><span class=o>=</span><span class=n>q</span><span class=p>,</span>
            <span class=n>corpora</span><span class=o>=</span><span class=s2>&quot;allDrives&quot;</span><span class=p>,</span>
            <span class=n>includeItemsFromAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>fields</span><span class=o>=</span><span class=s2>&quot;nextPageToken, files(id, name, parents, &quot;</span>
                   <span class=s2>&quot;mimeType, modifiedTime,size,md5Checksum)&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>))</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Too many files returned for </span><span class=si>{}</span><span class=s2> in </span><span class=si>{}</span><span class=s2>&quot;</span>
                             <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=n>folder_id</span><span class=p>))</span>

        <span class=n>file</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[])</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>file</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>False</span>
        <span class=k>return</span> <span class=n>file</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_gd_service</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>credentials_path</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Authorize client with &#39;credentials.json&#39;, uses service account.</span>
<span class=sd>            Service account needs to have target folder shared with.</span>
<span class=sd>            Produces service that communicates with GDrive API.</span>

<span class=sd>        Returns:</span>
<span class=sd>            None</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>service</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>creds</span> <span class=o>=</span> <span class=n>service_account</span><span class=o>.</span><span class=n>Credentials</span><span class=o>.</span><span class=n>from_service_account_file</span><span class=p>(</span>
                <span class=n>credentials_path</span><span class=p>,</span>
                <span class=n>scopes</span><span class=o>=</span><span class=n>SCOPES</span><span class=p>)</span>
            <span class=n>service</span> <span class=o>=</span> <span class=n>build</span><span class=p>(</span><span class=s2>&quot;drive&quot;</span><span class=p>,</span> <span class=s2>&quot;v3&quot;</span><span class=p>,</span>
                            <span class=n>credentials</span><span class=o>=</span><span class=n>creds</span><span class=p>,</span> <span class=n>cache_discovery</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;Connection failed, &quot;</span> <span class=o>+</span>
                      <span class=s2>&quot;check &#39;</span><span class=si>{}</span><span class=s2>&#39; credentials file&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>credentials_path</span><span class=p>),</span>
                      <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>service</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_prepare_root_info</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Prepare info about roots and theirs folder ids from &#39;presets&#39;.</span>
<span class=sd>            Configuration might be for single or multiroot projects.</span>
<span class=sd>            Regular My Drive and Shared drives are implemented, their root</span>
<span class=sd>            folder ids need to be queried in slightly different way.</span>

<span class=sd>        Returns:</span>
<span class=sd>            (dicts) of dicts where root folders are keys</span>
<span class=sd>            throws ResumableError in case of errors.HttpError</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>roots</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=n>config_roots</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_roots_config</span><span class=p>()[</span><span class=s2>&quot;root&quot;</span><span class=p>]</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>config_roots</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>MY_DRIVE_STR</span> <span class=ow>in</span> <span class=n>path</span><span class=p>:</span>
                    <span class=n>roots</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>MY_DRIVE_STR</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span>\
                                                   <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>fileId</span><span class=o>=</span><span class=s2>&quot;root&quot;</span><span class=p>)</span>\
                                                   <span class=o>.</span><span class=n>execute</span><span class=p>()</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>shared_drives</span> <span class=o>=</span> <span class=p>[]</span>
                    <span class=n>page_token</span> <span class=o>=</span> <span class=kc>None</span>

                    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
                        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>drives</span><span class=p>()</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
                            <span class=n>pageSize</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
                            <span class=n>pageToken</span><span class=o>=</span><span class=n>page_token</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
                        <span class=n>shared_drives</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;drives&quot;</span><span class=p>,</span> <span class=p>[]))</span>
                        <span class=n>page_token</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;nextPageToken&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
                        <span class=k>if</span> <span class=n>page_token</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                            <span class=k>break</span>

                    <span class=n>folders</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)</span>
                    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>folders</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
                        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Wrong root folder definition </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span>
                                         <span class=nb>format</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

                    <span class=k>for</span> <span class=n>shared_drive</span> <span class=ow>in</span> <span class=n>shared_drives</span><span class=p>:</span>
                        <span class=k>if</span> <span class=n>folders</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=ow>in</span> <span class=n>shared_drive</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]:</span>
                            <span class=n>roots</span><span class=p>[</span><span class=n>shared_drive</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{</span>
                                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>shared_drive</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
                                <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>shared_drive</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]}</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>MY_DRIVE_STR</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>roots</span><span class=p>:</span>  <span class=c1># add My Drive always</span>
                <span class=n>roots</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>MY_DRIVE_STR</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span> \
                    <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>fileId</span><span class=o>=</span><span class=s2>&quot;root&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
        <span class=k>except</span> <span class=n>errors</span><span class=o>.</span><span class=n>HttpError</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;HttpError in sync loop, &quot;</span>
                        <span class=s2>&quot;trying next loop&quot;</span><span class=p>,</span>
                        <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
            <span class=k>raise</span> <span class=n>ResumableError</span>

        <span class=k>return</span> <span class=n>roots</span>

    <span class=nd>@time_function</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_build_tree</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>folders</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Create in-memory structure resolving paths to folder id as</span>
<span class=sd>            recursive querying might be slower.</span>
<span class=sd>            Initialized in the time of class initialization.</span>
<span class=sd>            Maybe should be persisted</span>
<span class=sd>            Tree is structure of path to id:</span>
<span class=sd>                &#39;/ROOT&#39;: {&#39;id&#39;: &#39;1234567&#39;}</span>
<span class=sd>                &#39;/ROOT/PROJECT_FOLDER&#39;: {&#39;id&#39;:&#39;222222&#39;}</span>
<span class=sd>                &#39;/ROOT/PROJECT_FOLDER/Assets&#39;: {&#39;id&#39;: &#39;3434545&#39;}</span>
<span class=sd>        Args:</span>
<span class=sd>            folders (list): list of dictionaries with folder metadata</span>
<span class=sd>        Returns:</span>
<span class=sd>            (dictionary) path as a key, folder id as a value</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;build_tree len </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>folders</span><span class=p>)))</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>root</span><span class=p>:</span>  <span class=c1># build only when necessary, could be expensive</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>root</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_root_info</span><span class=p>()</span>

        <span class=n>root_ids</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>default_root_id</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>tree</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=n>ending_by</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>for</span> <span class=n>root_name</span><span class=p>,</span> <span class=n>root</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>root</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>  <span class=c1># might be multiple roots</span>
            <span class=k>if</span> <span class=n>root</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>root_ids</span><span class=p>:</span>
                <span class=n>tree</span><span class=p>[</span><span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>root_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>root</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]}</span>
                <span class=n>ending_by</span><span class=p>[</span><span class=n>root</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>root_name</span>
                <span class=n>root_ids</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>root</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>])</span>

                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>MY_DRIVE_STR</span> <span class=o>==</span> <span class=n>root_name</span><span class=p>:</span>
                    <span class=n>default_root_id</span> <span class=o>=</span> <span class=n>root</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>

        <span class=n>no_parents_yet</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>while</span> <span class=n>folders</span><span class=p>:</span>
            <span class=n>folder</span> <span class=o>=</span> <span class=n>folders</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
            <span class=n>parents</span> <span class=o>=</span> <span class=n>folder</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;parents&quot;</span><span class=p>,</span> <span class=p>[])</span>
            <span class=c1># weird cases, shared folders, etc, parent under root</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>parents</span><span class=p>:</span>
                <span class=n>parent</span> <span class=o>=</span> <span class=n>default_root_id</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>parent</span> <span class=o>=</span> <span class=n>parents</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

            <span class=k>if</span> <span class=n>folder</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span> <span class=ow>in</span> <span class=n>root_ids</span><span class=p>:</span>  <span class=c1># do not process root</span>
                <span class=k>continue</span>

            <span class=k>if</span> <span class=n>parent</span> <span class=ow>in</span> <span class=n>ending_by</span><span class=p>:</span>
                <span class=n>path_key</span> <span class=o>=</span> <span class=n>ending_by</span><span class=p>[</span><span class=n>parent</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>folder</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
                <span class=n>ending_by</span><span class=p>[</span><span class=n>folder</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>path_key</span>
                <span class=n>tree</span><span class=p>[</span><span class=n>path_key</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>folder</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]}</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>no_parents_yet</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span> <span class=p>[])</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>folder</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                                                              <span class=n>folder</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]))</span>
        <span class=n>loop_cnt</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=c1># break if looped more then X times - safety against infinite loop</span>
        <span class=k>while</span> <span class=n>no_parents_yet</span> <span class=ow>and</span> <span class=n>loop_cnt</span> <span class=o>&lt;</span> <span class=mi>20</span><span class=p>:</span>

            <span class=n>keys</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>no_parents_yet</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
            <span class=k>for</span> <span class=n>parent</span> <span class=ow>in</span> <span class=n>keys</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>parent</span> <span class=ow>in</span> <span class=n>ending_by</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
                    <span class=n>subfolders</span> <span class=o>=</span> <span class=n>no_parents_yet</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>parent</span><span class=p>)</span>
                    <span class=k>for</span> <span class=n>folder_id</span><span class=p>,</span> <span class=n>folder_name</span> <span class=ow>in</span> <span class=n>subfolders</span><span class=p>:</span>
                        <span class=n>path_key</span> <span class=o>=</span> <span class=n>ending_by</span><span class=p>[</span><span class=n>parent</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>folder_name</span>
                        <span class=n>ending_by</span><span class=p>[</span><span class=n>folder_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>path_key</span>
                        <span class=n>tree</span><span class=p>[</span><span class=n>path_key</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>folder_id</span><span class=p>}</span>
            <span class=n>loop_cnt</span> <span class=o>+=</span> <span class=mi>1</span>

        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>no_parents_yet</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Some folders path are not resolved </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span>
                      <span class=nb>format</span><span class=p>(</span><span class=n>no_parents_yet</span><span class=p>))</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Remove deleted folders from trash.&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>tree</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_folder_metadata</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Get info about folder with &#39;path&#39;</span>
<span class=sd>        Args:</span>
<span class=sd>            path (string):</span>

<span class=sd>        Returns:</span>
<span class=sd>         (dictionary) with metadata or raises ValueError</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tree</span><span class=p>()[</span><span class=n>path</span><span class=p>]</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Uknown folder id </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>id</span><span class=p>))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_handle_q</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>trashed</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot; API list call contain trashed and hidden files/folder by default.</span>
<span class=sd>            Usually we dont want those, must be included in query explicitly.</span>

<span class=sd>        Args:</span>
<span class=sd>            q (string): query portion</span>
<span class=sd>            trashed (boolean): False|True</span>

<span class=sd>        Returns:</span>
<span class=sd>            (string) - modified query</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>parts</span> <span class=o>=</span> <span class=p>[</span><span class=n>q</span><span class=p>]</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>trashed</span><span class=p>:</span>
            <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot; trashed = false &quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=s2>&quot; and &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.create_folder class="doc doc-heading"> <code class="highlight language-python"><span class=n>create_folder</span><span class=p>(</span><span class=n>path</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Create all nonexistent folders and subfolders in 'path'.
Updates self._tree structure with new paths
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>path</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> <p>absolute path, starts with GDrive root, without filename</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p>Returns: (string) folder id of lowest subfolder from 'path'</p> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>create_folder</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Create all nonexistent folders and subfolders in &#39;path&#39;.</span>
<span class=sd>        Updates self._tree structure with new paths</span>

<span class=sd>    Args:</span>
<span class=sd>        path (string): absolute path, starts with GDrive root,</span>
<span class=sd>                       without filename</span>
<span class=sd>    Returns:</span>
<span class=sd>        (string) folder id of lowest subfolder from &#39;path&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>folder_id</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>folder_id</span>
    <span class=n>parts</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)</span>
    <span class=n>folders_to_create</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=k>while</span> <span class=n>parts</span><span class=p>:</span>
        <span class=n>folders_to_create</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>parts</span><span class=o>.</span><span class=n>pop</span><span class=p>())</span>
        <span class=n>path</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span>
        <span class=n>path</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
        <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>  <span class=c1># lowest common path</span>
        <span class=k>if</span> <span class=n>folder_id</span><span class=p>:</span>
            <span class=k>while</span> <span class=n>folders_to_create</span><span class=p>:</span>
                <span class=n>new_folder_name</span> <span class=o>=</span> <span class=n>folders_to_create</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span>
                <span class=n>folder_metadata</span> <span class=o>=</span> <span class=p>{</span>
                    <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>new_folder_name</span><span class=p>,</span>
                    <span class=s2>&quot;mimeType&quot;</span><span class=p>:</span> <span class=s2>&quot;application/vnd.google-apps.folder&quot;</span><span class=p>,</span>
                    <span class=s2>&quot;parents&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>folder_id</span><span class=p>]</span>
                <span class=p>}</span>
                <span class=n>folder</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
                    <span class=n>body</span><span class=o>=</span><span class=n>folder_metadata</span><span class=p>,</span>
                    <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                    <span class=n>fields</span><span class=o>=</span><span class=s2>&quot;id&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
                <span class=n>folder_id</span> <span class=o>=</span> <span class=n>folder</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>

                <span class=n>new_path_key</span> <span class=o>=</span> <span class=n>path</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>new_folder_name</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>get_tree</span><span class=p>()[</span><span class=n>new_path_key</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>folder_id</span><span class=p>}</span>

                <span class=n>path</span> <span class=o>=</span> <span class=n>new_path_key</span>
            <span class=k>return</span> <span class=n>folder_id</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.delete_file class="doc doc-heading"> <code class="highlight language-python"><span class=n>delete_file</span><span class=p>(</span><span class=n>path</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Deletes file from 'path'. Expects path to specific file.
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>path</code> </td> <td> </td> <td> <div class=doc-md-description> <p>absolute path to particular file</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>None</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>delete_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Deletes file from &#39;path&#39;. Expects path to specific file.</span>

<span class=sd>    Args:</span>
<span class=sd>        path: absolute path to particular file</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>file</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_path_exists</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>file</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;File </span><span class=si>{}</span><span class=s2> doesn&#39;t exist&quot;</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>fileId</span><span class=o>=</span><span class=n>file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                                <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.delete_folder class="doc doc-heading"> <code class="highlight language-python"><span class=n>delete_folder</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Deletes folder on GDrive. Checks if folder contains any files or
subfolders. In that case raises error, could be overridden by
'force' argument.
In that case deletes folder on 'path' and all its children.
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>path</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> <p>absolute path on GDrive</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>force</code> </td> <td> <code><span title=boolean>boolean</span></code> </td> <td> <div class=doc-md-description> <p>delete even if children in folder</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>None</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>delete_folder</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Deletes folder on GDrive. Checks if folder contains any files or</span>
<span class=sd>        subfolders. In that case raises error, could be overridden by</span>
<span class=sd>        &#39;force&#39; argument.</span>
<span class=sd>        In that case deletes folder on &#39;path&#39; and all its children.</span>

<span class=sd>    Args:</span>
<span class=sd>        path (string): absolute path on GDrive</span>
<span class=sd>        force (boolean): delete even if children in folder</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>folder_id</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Not valid folder path </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

    <span class=n>fields</span> <span class=o>=</span> <span class=s2>&quot;nextPageToken, files(id, name, parents)&quot;</span>
    <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_q</span><span class=p>(</span><span class=s2>&quot;&#39;</span><span class=si>{}</span><span class=s2>&#39; in parents &quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>folder_id</span><span class=p>))</span>
    <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
        <span class=n>q</span><span class=o>=</span><span class=n>q</span><span class=p>,</span>
        <span class=n>corpora</span><span class=o>=</span><span class=s2>&quot;allDrives&quot;</span><span class=p>,</span>
        <span class=n>includeItemsFromAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
        <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
        <span class=n>pageSize</span><span class=o>=</span><span class=s2>&quot;1&quot;</span><span class=p>,</span>
        <span class=n>fields</span><span class=o>=</span><span class=n>fields</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
    <span class=n>children</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[])</span>
    <span class=k>if</span> <span class=n>children</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>force</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Folder </span><span class=si>{}</span><span class=s2> is not empty, use &#39;force&#39;&quot;</span><span class=o>.</span>
                         <span class=nb>format</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>fileId</span><span class=o>=</span><span class=n>folder_id</span><span class=p>,</span>
                                <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.download_file class="doc doc-heading"> <code class="highlight language-python"><span class=n>download_file</span><span class=p>(</span><span class=n>source_path</span><span class=p>,</span> <span class=n>local_path</span><span class=p>,</span> <span class=n>addon</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>file</span><span class=p>,</span> <span class=n>repre_status</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>overwrite</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Downloads single file from 'source_path' (remote) to 'local_path'.
It creates all folders on the local_path if are not existing.
By default existing file on 'local_path' will trigger an exception
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>source_path</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> <p>absolute path on provider</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>local_path</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> <p>absolute path with or without name of the file</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>addon</code> </td> <td> <code><a class="autorefs autorefs-internal" title="SiteSyncAddon (client.ayon_sitesync.addon.SiteSyncAddon)" href=../addon.html#client.ayon_sitesync.addon.SiteSyncAddon>SiteSyncAddon</a></code> </td> <td> <div class=doc-md-description> <p>addon instance to call update_db on</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>file</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>info about uploaded file (matches structure from db)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>repre_status</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>complete representation containing sync progress</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>site name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>overwrite</code> </td> <td> <code><span title=boolean>boolean</span></code> </td> <td> <div class=doc-md-description> <p>replace existing file</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>(string) file_id of created/modified file , throws FileExistsError, FileNotFoundError exceptions</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>download_file</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>source_path</span><span class=p>,</span>
    <span class=n>local_path</span><span class=p>,</span>
    <span class=n>addon</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>file</span><span class=p>,</span>
    <span class=n>repre_status</span><span class=p>,</span>
    <span class=n>site_name</span><span class=p>,</span>
    <span class=n>overwrite</span><span class=o>=</span><span class=kc>False</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Downloads single file from &#39;source_path&#39; (remote) to &#39;local_path&#39;.</span>
<span class=sd>        It creates all folders on the local_path if are not existing.</span>
<span class=sd>        By default existing file on &#39;local_path&#39; will trigger an exception</span>

<span class=sd>    Args:</span>
<span class=sd>        source_path (string): absolute path on provider</span>
<span class=sd>        local_path (string): absolute path with or without name of the file</span>
<span class=sd>        addon (SiteSyncAddon): addon instance to call update_db on</span>
<span class=sd>        project_name (str):</span>
<span class=sd>        file (dict): info about uploaded file (matches structure from db)</span>
<span class=sd>        repre_status (dict): complete representation containing</span>
<span class=sd>            sync progress</span>
<span class=sd>        site_name (str): site name</span>
<span class=sd>        overwrite (boolean): replace existing file</span>

<span class=sd>    Returns:</span>
<span class=sd>        (string) file_id of created/modified file ,</span>
<span class=sd>            throws FileExistsError, FileNotFoundError exceptions</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>remote_file</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_path_exists</span><span class=p>(</span><span class=n>source_path</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>remote_file</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=s2>&quot;Source file </span><span class=si>{}</span><span class=s2> doesn&#39;t exist.&quot;</span>
                                <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>source_path</span><span class=p>))</span>

    <span class=n>root</span><span class=p>,</span> <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>ext</span><span class=p>:</span>
        <span class=c1># full path with file name</span>
        <span class=n>target_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
        <span class=n>local_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>  <span class=c1># just folder, get file name from source</span>
        <span class=n>target_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>source_path</span><span class=p>)</span>

    <span class=n>local_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>local_path</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>target_name</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>local_file</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>overwrite</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileExistsError</span><span class=p>(</span><span class=s2>&quot;File already exists, &quot;</span>
                              <span class=s2>&quot;use &#39;overwrite&#39; argument&quot;</span><span class=p>)</span>

    <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>get_media</span><span class=p>(</span><span class=n>fileId</span><span class=o>=</span><span class=n>remote_file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                                             <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>target_name</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fh</span><span class=p>:</span>
        <span class=n>downloader</span> <span class=o>=</span> <span class=n>MediaIoBaseDownload</span><span class=p>(</span><span class=n>fh</span><span class=p>,</span> <span class=n>request</span><span class=p>)</span>
        <span class=n>last_tick</span> <span class=o>=</span> <span class=n>status</span> <span class=o>=</span> <span class=n>response</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>status_val</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>while</span> <span class=n>response</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>addon</span><span class=o>.</span><span class=n>is_representation_paused</span><span class=p>(</span>
                <span class=n>repre_status</span><span class=p>[</span><span class=s2>&quot;representationId&quot;</span><span class=p>],</span>
                <span class=n>check_parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>project_name</span><span class=o>=</span><span class=n>project_name</span>
            <span class=p>):</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Paused during process, please redo.&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>status</span><span class=p>:</span>
                <span class=n>status_val</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>status</span><span class=o>.</span><span class=n>progress</span><span class=p>())</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>last_tick</span> <span class=ow>or</span> \
                    <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>last_tick</span> <span class=o>&gt;=</span> <span class=n>addon</span><span class=o>.</span><span class=n>LOG_PROGRESS_SEC</span><span class=p>:</span>
                <span class=n>last_tick</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Downloaded </span><span class=si>%d%%</span><span class=s2>.&quot;</span> <span class=o>%</span> <span class=nb>int</span><span class=p>(</span><span class=n>status_val</span> <span class=o>*</span> <span class=mi>100</span><span class=p>))</span>
                <span class=n>addon</span><span class=o>.</span><span class=n>update_db</span><span class=p>(</span>
                    <span class=n>project_name</span><span class=o>=</span><span class=n>project_name</span><span class=p>,</span>
                    <span class=n>new_file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
                    <span class=n>file</span><span class=o>=</span><span class=n>file</span><span class=p>,</span>
                    <span class=n>repre_status</span><span class=o>=</span><span class=n>repre_status</span><span class=p>,</span>
                    <span class=n>site_name</span><span class=o>=</span><span class=n>site_name</span><span class=p>,</span>
                    <span class=n>side</span><span class=o>=</span><span class=s2>&quot;local&quot;</span><span class=p>,</span>
                    <span class=n>progress</span><span class=o>=</span><span class=n>status_val</span>
                <span class=p>)</span>
            <span class=n>status</span><span class=p>,</span> <span class=n>response</span> <span class=o>=</span> <span class=n>downloader</span><span class=o>.</span><span class=n>next_chunk</span><span class=p>()</span>

    <span class=k>return</span> <span class=n>target_name</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.file_exists class="doc doc-heading"> <code class="highlight language-python"><span class=n>file_exists</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=n>folder_id</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Checks if 'file_name' exists in 'folder_id'
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>file_name</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>folder_id</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>google drive folder id</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>(dictionary|boolean) file metadata, False if not found</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>file_exists</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_name</span><span class=p>,</span> <span class=n>folder_id</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Checks if &#39;file_name&#39; exists in &#39;folder_id&#39;</span>

<span class=sd>    Args:</span>
<span class=sd>        file_name (string):</span>
<span class=sd>        folder_id (int): google drive folder id</span>

<span class=sd>    Returns:</span>
<span class=sd>        (dictionary|boolean) file metadata, False if not found</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_q</span><span class=p>(</span><span class=s2>&quot;name = &#39;</span><span class=si>{}</span><span class=s2>&#39; and &#39;</span><span class=si>{}</span><span class=s2>&#39; in parents&quot;</span>
                       <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=n>folder_id</span><span class=p>))</span>
    <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
        <span class=n>q</span><span class=o>=</span><span class=n>q</span><span class=p>,</span>
        <span class=n>corpora</span><span class=o>=</span><span class=s2>&quot;allDrives&quot;</span><span class=p>,</span>
        <span class=n>includeItemsFromAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
        <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
        <span class=n>fields</span><span class=o>=</span><span class=s2>&quot;nextPageToken, files(id, name, parents, &quot;</span>
               <span class=s2>&quot;mimeType, modifiedTime,size,md5Checksum)&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>))</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Too many files returned for </span><span class=si>{}</span><span class=s2> in </span><span class=si>{}</span><span class=s2>&quot;</span>
                         <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=n>folder_id</span><span class=p>))</span>

    <span class=n>file</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[])</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>file</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>False</span>
    <span class=k>return</span> <span class=n>file</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.file_path_exists class="doc doc-heading"> <code class="highlight language-python"><span class=n>file_path_exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Checks if 'file_path' exists on GDrive
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>file_path</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> <p>separated by '/', from root, with file name</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p>Returns: (dictionary|boolean) file metadata | False if not found</p> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>file_path_exists</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Checks if &#39;file_path&#39; exists on GDrive</span>

<span class=sd>    Args:</span>
<span class=sd>        file_path (string): separated by &#39;/&#39;, from root, with file name</span>
<span class=sd>    Returns:</span>
<span class=sd>        (dictionary|boolean) file metadata | False if not found</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>folder_id</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>),</span> <span class=n>folder_id</span><span class=p>)</span>
    <span class=k>return</span> <span class=kc>False</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.folder_path_exists class="doc doc-heading"> <code class="highlight language-python"><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Checks if path from 'file_path' exists. If so, return its
folder id.
</code></pre> <p>Args: file_path (string): gdrive path with / as a separator Returns: (string) folder id or False</p> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>folder_path_exists</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Checks if path from &#39;file_path&#39; exists. If so, return its</span>
<span class=sd>        folder id.</span>
<span class=sd>    Args:</span>
<span class=sd>        file_path (string): gdrive path with / as a separator</span>
<span class=sd>    Returns:</span>
<span class=sd>        (string) folder id or False</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>file_path</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=n>root</span><span class=p>,</span> <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>ext</span><span class=p>:</span>
        <span class=n>file_path</span> <span class=o>+=</span> <span class=s2>&quot;/&quot;</span>

    <span class=n>dir_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>

    <span class=n>path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>dir_path</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>path</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>path</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>

    <span class=k>return</span> <span class=kc>False</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.get_roots_config class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_roots_config</span><span class=p>(</span><span class=n>anatomy</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Returns root values for path resolving

Use only Settings as GDrive cannot be modified by Local Settings
</code></pre> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>(dict) - {"root": {"root": "/My Drive"}} OR {"root": {"root_ONE": "value", "root_TWO":"value}}</p> </div> </td> </tr> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>Format is importing for usage of python's format ** approach</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_roots_config</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>anatomy</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Returns root values for path resolving</span>

<span class=sd>        Use only Settings as GDrive cannot be modified by Local Settings</span>

<span class=sd>    Returns:</span>
<span class=sd>        (dict) - {&quot;root&quot;: {&quot;root&quot;: &quot;/My Drive&quot;}}</span>
<span class=sd>                 OR</span>
<span class=sd>                 {&quot;root&quot;: {&quot;root_ONE&quot;: &quot;value&quot;, &quot;root_TWO&quot;:&quot;value}}</span>
<span class=sd>        Format is importing for usage of python&#39;s format ** approach</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># GDrive roots cannot be locally overridden</span>
    <span class=c1># TODO implement multiple roots</span>
    <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;root&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;work&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>presets</span><span class=p>[</span><span class=s2>&quot;root&quot;</span><span class=p>]}}</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.get_tree class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_tree</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <pre><code>Building of the folder tree could be potentially expensive,
constructor provides argument that could inject previously created
tree.
Tree structure must be handled in thread safe fashion!
</code></pre> <p>Returns: (dictionary) - url to id mapping</p> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_tree</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Building of the folder tree could be potentially expensive,</span>
<span class=sd>        constructor provides argument that could inject previously created</span>
<span class=sd>        tree.</span>
<span class=sd>        Tree structure must be handled in thread safe fashion!</span>
<span class=sd>    Returns:</span>
<span class=sd>         (dictionary) - url to id mapping</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tree</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_tree</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_build_tree</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>list_folders</span><span class=p>())</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tree</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.is_active class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_active</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <pre><code>Returns True if provider is activated, eg. has working credentials.
</code></pre> <p>Returns: (boolean)</p> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>is_active</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Returns True if provider is activated, eg. has working credentials.</span>
<span class=sd>    Returns:</span>
<span class=sd>        (boolean)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>presets</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enabled&quot;</span><span class=p>)</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.list_files class="doc doc-heading"> <code class="highlight language-python"><span class=n>list_files</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Lists all files in GDrive Runs loop through possibly multiple pages. Result could be large, if it would be a problem, change it to generator Returns: (list) of dictionaries('id', 'name', [parents])</p> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>list_files</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot; Lists all files in GDrive</span>
<span class=sd>        Runs loop through possibly multiple pages. Result could be large,</span>
<span class=sd>        if it would be a problem, change it to generator</span>
<span class=sd>    Returns:</span>
<span class=sd>        (list) of dictionaries(&#39;id&#39;, &#39;name&#39;, [parents])</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>files</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>page_token</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>fields</span> <span class=o>=</span> <span class=s2>&quot;nextPageToken, files(id, name, parents)&quot;</span>
    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
        <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_q</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
            <span class=n>q</span><span class=o>=</span><span class=n>q</span><span class=p>,</span>
            <span class=n>corpora</span><span class=o>=</span><span class=s2>&quot;allDrives&quot;</span><span class=p>,</span>
            <span class=n>includeItemsFromAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>fields</span><span class=o>=</span><span class=n>fields</span><span class=p>,</span>
            <span class=n>pageToken</span><span class=o>=</span><span class=n>page_token</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
        <span class=n>files</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[]))</span>
        <span class=n>page_token</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;nextPageToken&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>page_token</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>break</span>

    <span class=k>return</span> <span class=n>files</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.list_folder class="doc doc-heading"> <code class="highlight language-python"><span class=n>list_folder</span><span class=p>(</span><span class=n>folder_path</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>List all files and subfolders of particular path non-recursively.
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>folder_path</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> <p>absolut path on provider</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p>Returns: (list)</p> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>list_folder</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>folder_path</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        List all files and subfolders of particular path non-recursively.</span>

<span class=sd>    Args:</span>
<span class=sd>        folder_path (string): absolut path on provider</span>
<span class=sd>    Returns:</span>
<span class=sd>         (list)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>pass</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.list_folders class="doc doc-heading"> <code class="highlight language-python"><span class=n>list_folders</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Lists all folders in GDrive. Used to build in-memory structure of path to folder ids model.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>(list) of dictionaries('id', 'name', [parents])</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@time_function</span>
<span class=k>def</span><span class=w> </span><span class=nf>list_folders</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot; Lists all folders in GDrive.</span>
<span class=sd>        Used to build in-memory structure of path to folder ids model.</span>

<span class=sd>    Returns:</span>
<span class=sd>        (list) of dictionaries(&#39;id&#39;, &#39;name&#39;, [parents])</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>folders</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>page_token</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>fields</span> <span class=o>=</span> <span class=s2>&quot;nextPageToken, files(id, name, parents)&quot;</span>
    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
        <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_q</span><span class=p>(</span><span class=s2>&quot;mimeType=&#39;application/vnd.google-apps.folder&#39;&quot;</span><span class=p>)</span>
        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
            <span class=n>q</span><span class=o>=</span><span class=n>q</span><span class=p>,</span>
            <span class=n>pageSize</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span>
            <span class=n>corpora</span><span class=o>=</span><span class=s2>&quot;allDrives&quot;</span><span class=p>,</span>
            <span class=n>includeItemsFromAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>fields</span><span class=o>=</span><span class=n>fields</span><span class=p>,</span>
            <span class=n>pageToken</span><span class=o>=</span><span class=n>page_token</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
        <span class=n>folders</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[]))</span>
        <span class=n>page_token</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;nextPageToken&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>page_token</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>break</span>

    <span class=k>return</span> <span class=n>folders</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.providers.gdrive.GDriveHandler.upload_file class="doc doc-heading"> <code class="highlight language-python"><span class=n>upload_file</span><span class=p>(</span><span class=n>source_path</span><span class=p>,</span> <span class=n>target_path</span><span class=p>,</span> <span class=n>addon</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>file</span><span class=p>,</span> <span class=n>repre_status</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>overwrite</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Uploads single file from 'source_path' to destination 'path'.
It creates all folders on the path if are not existing.
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>source_path</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> <p>absolute path on provider</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>target_path</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> <p>absolute path with or without name of the file</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>addon</code> </td> <td> <code><a class="autorefs autorefs-internal" title="SiteSyncAddon (client.ayon_sitesync.addon.SiteSyncAddon)" href=../addon.html#client.ayon_sitesync.addon.SiteSyncAddon>SiteSyncAddon</a></code> </td> <td> <div class=doc-md-description> <p>addon instance to call update_db on</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>file</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>info about uploaded file (matches structure from db)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>repre_status</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>complete representation containing sync progress</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>site name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>overwrite</code> </td> <td> <code><span title=boolean>boolean</span></code> </td> <td> <div class=doc-md-description> <p>replace existing file</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>(string) file_id of created/modified file , throws FileExistsError, FileNotFoundError exceptions</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>client/ayon_sitesync/providers/gdrive.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>upload_file</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>source_path</span><span class=p>,</span>
    <span class=n>target_path</span><span class=p>,</span>
    <span class=n>addon</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>file</span><span class=p>,</span>
    <span class=n>repre_status</span><span class=p>,</span>
    <span class=n>site_name</span><span class=p>,</span>
    <span class=n>overwrite</span><span class=o>=</span><span class=kc>False</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Uploads single file from &#39;source_path&#39; to destination &#39;path&#39;.</span>
<span class=sd>        It creates all folders on the path if are not existing.</span>

<span class=sd>    Args:</span>
<span class=sd>        source_path (string): absolute path on provider</span>
<span class=sd>        target_path (string): absolute path with or without name of the file</span>
<span class=sd>        addon (SiteSyncAddon): addon instance to call update_db on</span>
<span class=sd>        project_name (str):</span>
<span class=sd>        file (dict): info about uploaded file (matches structure from db)</span>
<span class=sd>        repre_status (dict): complete representation containing</span>
<span class=sd>            sync progress</span>
<span class=sd>        site_name (str): site name</span>
<span class=sd>        overwrite (boolean): replace existing file</span>

<span class=sd>    Returns:</span>
<span class=sd>        (string) file_id of created/modified file ,</span>
<span class=sd>            throws FileExistsError, FileNotFoundError exceptions</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>source_path</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=s2>&quot;Source file </span><span class=si>{}</span><span class=s2> doesn&#39;t exist.&quot;</span>
                                <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>source_path</span><span class=p>))</span>

    <span class=n>root</span><span class=p>,</span> <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>ext</span><span class=p>:</span>
        <span class=c1># full path</span>
        <span class=n>target_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>
        <span class=n>target_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>target_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>source_path</span><span class=p>)</span>
    <span class=n>target_file</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_path_exists</span><span class=p>(</span><span class=n>target_path</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>target_name</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>target_file</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>overwrite</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileExistsError</span><span class=p>(</span><span class=s2>&quot;File already exists, &quot;</span>
                              <span class=s2>&quot;use &#39;overwrite&#39; argument&quot;</span><span class=p>)</span>

    <span class=n>folder_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path_exists</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>folder_id</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>NotADirectoryError</span><span class=p>(</span>
            <span class=s2>&quot;Folder </span><span class=si>{}</span><span class=s2> doesn&#39;t exists&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>target_path</span><span class=p>))</span>

    <span class=n>file_metadata</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>target_name</span>
    <span class=p>}</span>
    <span class=n>media</span> <span class=o>=</span> <span class=n>MediaFileUpload</span><span class=p>(</span><span class=n>source_path</span><span class=p>,</span>
                            <span class=n>mimetype</span><span class=o>=</span><span class=s2>&quot;application/octet-stream&quot;</span><span class=p>,</span>
                            <span class=n>chunksize</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>CHUNK_SIZE</span><span class=p>,</span>
                            <span class=n>resumable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>target_file</span><span class=p>:</span>
            <span class=c1># update doesnt like parent</span>
            <span class=n>file_metadata</span><span class=p>[</span><span class=s2>&quot;parents&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>folder_id</span><span class=p>]</span>

            <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
                <span class=n>body</span><span class=o>=</span><span class=n>file_metadata</span><span class=p>,</span>
                <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>media_body</span><span class=o>=</span><span class=n>media</span><span class=p>,</span>
                <span class=n>fields</span><span class=o>=</span><span class=s2>&quot;id&quot;</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>service</span><span class=o>.</span><span class=n>files</span><span class=p>()</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
                <span class=n>fileId</span><span class=o>=</span><span class=n>target_file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                <span class=n>body</span><span class=o>=</span><span class=n>file_metadata</span><span class=p>,</span>
                <span class=n>supportsAllDrives</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>media_body</span><span class=o>=</span><span class=n>media</span><span class=p>,</span>
                <span class=n>fields</span><span class=o>=</span><span class=s2>&quot;id&quot;</span>
            <span class=p>)</span>

        <span class=n>media</span><span class=o>.</span><span class=n>stream</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Start Upload! </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>source_path</span><span class=p>))</span>
        <span class=n>last_tick</span> <span class=o>=</span> <span class=n>status</span> <span class=o>=</span> <span class=n>response</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>status_val</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>while</span> <span class=n>response</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>addon</span><span class=o>.</span><span class=n>is_representation_paused</span><span class=p>(</span>
                    <span class=n>repre_status</span><span class=p>[</span><span class=s2>&quot;representationId&quot;</span><span class=p>],</span>
                    <span class=n>check_parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                    <span class=n>project_name</span><span class=o>=</span><span class=n>project_name</span><span class=p>):</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Paused during process, please redo.&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>status</span><span class=p>:</span>
                <span class=n>status_val</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>status</span><span class=o>.</span><span class=n>progress</span><span class=p>())</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>last_tick</span> <span class=ow>or</span> \
                    <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>last_tick</span> <span class=o>&gt;=</span> <span class=n>addon</span><span class=o>.</span><span class=n>LOG_PROGRESS_SEC</span><span class=p>:</span>
                <span class=n>last_tick</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Uploaded </span><span class=si>%d%%</span><span class=s2>.&quot;</span> <span class=o>%</span> <span class=nb>int</span><span class=p>(</span><span class=n>status_val</span> <span class=o>*</span> <span class=mi>100</span><span class=p>))</span>
                <span class=n>addon</span><span class=o>.</span><span class=n>update_db</span><span class=p>(</span>
                    <span class=n>project_name</span><span class=o>=</span><span class=n>project_name</span><span class=p>,</span>
                    <span class=n>new_file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
                    <span class=n>file</span><span class=o>=</span><span class=n>file</span><span class=p>,</span>
                    <span class=n>repre_status</span><span class=o>=</span><span class=n>repre_status</span><span class=p>,</span>
                    <span class=n>site_name</span><span class=o>=</span><span class=n>site_name</span><span class=p>,</span>
                    <span class=n>side</span><span class=o>=</span><span class=s2>&quot;remote&quot;</span><span class=p>,</span>
                    <span class=n>progress</span><span class=o>=</span><span class=n>status_val</span>
                <span class=p>)</span>
            <span class=n>status</span><span class=p>,</span> <span class=n>response</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>next_chunk</span><span class=p>()</span>

    <span class=k>except</span> <span class=n>errors</span><span class=o>.</span><span class=n>HttpError</span> <span class=k>as</span> <span class=n>ex</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>ex</span><span class=o>.</span><span class=n>resp</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;404&quot;</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>False</span>
        <span class=k>if</span> <span class=n>ex</span><span class=o>.</span><span class=n>resp</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;403&quot;</span><span class=p>:</span>
            <span class=c1># real permission issue</span>
            <span class=k>if</span> <span class=s2>&quot;has not granted&quot;</span> <span class=ow>in</span> <span class=n>ex</span><span class=o>.</span><span class=n>_get_reason</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>():</span>
                <span class=k>raise</span> <span class=ne>PermissionError</span><span class=p>(</span><span class=n>ex</span><span class=o>.</span><span class=n>_get_reason</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=s2>&quot;Forbidden received, hit quota. Injecting 60s delay.&quot;</span>
            <span class=p>)</span>
            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>60</span><span class=p>)</span>
            <span class=k>return</span> <span class=kc>False</span>
        <span class=k>raise</span>
    <span class=k>return</span> <span class=n>response</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>