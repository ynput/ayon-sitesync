<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=index.html><link rel=next href=launch_hooks/index.html><link rel=icon href=../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>addon - ayon-sitesync</title><link rel=stylesheet href=../../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../css/custom.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#client.ayon_sitesync.addon class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../index.html title=ayon-sitesync class="md-header__button md-logo" aria-label=ayon-sitesync data-md-component=logo> <img src=../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-sitesync </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> addon </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ynput/ayon-sitesync title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../index.html title=ayon-sitesync class="md-nav__button md-logo" aria-label=ayon-sitesync data-md-component=logo> <img src=../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-sitesync </label> <div class=md-nav__source> <a href=https://github.com/ynput/ayon-sitesync title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> client </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> client </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1 checked> <label class=md-nav__link for=__nav_3_1_1 id=__nav_3_1_1_label tabindex=0> <span class=md-ellipsis> ayon_sitesync </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> ayon_sitesync </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> addon </span> <span class="md-nav__icon md-icon"></span> </label> <a href=addon.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> addon </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon class=md-nav__link> <span class=md-ellipsis> addon </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon class=md-nav__link> <span class=md-ellipsis> SiteSyncAddon </span> </a> <nav class=md-nav aria-label=SiteSyncAddon> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.add_site class=md-nav__link> <span class=md-ellipsis> add_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.check_status class=md-nav__link> <span class=md-ellipsis> check_status </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.clear_project class=md-nav__link> <span class=md-ellipsis> clear_project </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.compute_resource_sync_sites class=md-nav__link> <span class=md-ellipsis> compute_resource_sync_sites </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_active_site class=md-nav__link> <span class=md-ellipsis> get_active_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_active_site_type class=md-nav__link> <span class=md-ellipsis> get_active_site_type </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_anatomy class=md-nav__link> <span class=md-ellipsis> get_anatomy </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_enabled_projects class=md-nav__link> <span class=md-ellipsis> get_enabled_projects </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_launch_hook_paths class=md-nav__link> <span class=md-ellipsis> get_launch_hook_paths </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_local_file_path class=md-nav__link> <span class=md-ellipsis> get_local_file_path </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_local_normalized_site class=md-nav__link> <span class=md-ellipsis> get_local_normalized_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_loop_delay class=md-nav__link> <span class=md-ellipsis> get_loop_delay </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_progress_for_repre class=md-nav__link> <span class=md-ellipsis> get_progress_for_repre </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_provider_for_site class=md-nav__link> <span class=md-ellipsis> get_provider_for_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_remote_site class=md-nav__link> <span class=md-ellipsis> get_remote_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_repre_info_for_versions class=md-nav__link> <span class=md-ellipsis> get_repre_info_for_versions </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_repre_sync_state class=md-nav__link> <span class=md-ellipsis> get_repre_sync_state </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_representations_sites_sync_state class=md-nav__link> <span class=md-ellipsis> get_representations_sites_sync_state </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_representations_sync_state class=md-nav__link> <span class=md-ellipsis> get_representations_sync_state </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_site_icons class=md-nav__link> <span class=md-ellipsis> get_site_icons </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_site_root_overrides class=md-nav__link> <span class=md-ellipsis> get_site_root_overrides </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_sync_project_setting class=md-nav__link> <span class=md-ellipsis> get_sync_project_setting </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_sync_representations class=md-nav__link> <span class=md-ellipsis> get_sync_representations </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_version_availability class=md-nav__link> <span class=md-ellipsis> get_version_availability </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.handle_alternate_site class=md-nav__link> <span class=md-ellipsis> handle_alternate_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.initialize class=md-nav__link> <span class=md-ellipsis> initialize </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_paused class=md-nav__link> <span class=md-ellipsis> is_paused </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_project_enabled class=md-nav__link> <span class=md-ellipsis> is_project_enabled </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_project_paused class=md-nav__link> <span class=md-ellipsis> is_project_paused </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_representation_on_site class=md-nav__link> <span class=md-ellipsis> is_representation_on_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_representation_paused class=md-nav__link> <span class=md-ellipsis> is_representation_paused </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.pause_project class=md-nav__link> <span class=md-ellipsis> pause_project </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.pause_representation class=md-nav__link> <span class=md-ellipsis> pause_representation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.pause_server class=md-nav__link> <span class=md-ellipsis> pause_server </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.remove_site class=md-nav__link> <span class=md-ellipsis> remove_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.reset_site_on_representation class=md-nav__link> <span class=md-ellipsis> reset_site_on_representation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.reset_timer class=md-nav__link> <span class=md-ellipsis> reset_timer </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.server_init class=md-nav__link> <span class=md-ellipsis> server_init </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.set_sync_project_settings class=md-nav__link> <span class=md-ellipsis> set_sync_project_settings </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.tray_exit class=md-nav__link> <span class=md-ellipsis> tray_exit </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.tray_init class=md-nav__link> <span class=md-ellipsis> tray_init </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.tray_start class=md-nav__link> <span class=md-ellipsis> tray_start </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.unpause_project class=md-nav__link> <span class=md-ellipsis> unpause_project </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.unpause_representation class=md-nav__link> <span class=md-ellipsis> unpause_representation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.unpause_server class=md-nav__link> <span class=md-ellipsis> unpause_server </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.update_db class=md-nav__link> <span class=md-ellipsis> update_db </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.validate_project class=md-nav__link> <span class=md-ellipsis> validate_project </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=launch_hooks/pre_copy_last_published_workfile.html class=md-nav__link> <span class=md-ellipsis> launch_hooks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=plugins/publish/integrate_site_sync.html class=md-nav__link> <span class=md-ellipsis> plugins </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=providers/abstract_provider.html class=md-nav__link> <span class=md-ellipsis> providers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=sitesync.html class=md-nav__link> <span class=md-ellipsis> sitesync </span> </a> </li> <li class=md-nav__item> <a href=utils.html class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> <li class=md-nav__item> <a href=version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../server/settings/models.html class=md-nav__link> <span class=md-ellipsis> server </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon class=md-nav__link> <span class=md-ellipsis> addon </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon class=md-nav__link> <span class=md-ellipsis> SiteSyncAddon </span> </a> <nav class=md-nav aria-label=SiteSyncAddon> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.add_site class=md-nav__link> <span class=md-ellipsis> add_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.check_status class=md-nav__link> <span class=md-ellipsis> check_status </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.clear_project class=md-nav__link> <span class=md-ellipsis> clear_project </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.compute_resource_sync_sites class=md-nav__link> <span class=md-ellipsis> compute_resource_sync_sites </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_active_site class=md-nav__link> <span class=md-ellipsis> get_active_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_active_site_type class=md-nav__link> <span class=md-ellipsis> get_active_site_type </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_anatomy class=md-nav__link> <span class=md-ellipsis> get_anatomy </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_enabled_projects class=md-nav__link> <span class=md-ellipsis> get_enabled_projects </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_launch_hook_paths class=md-nav__link> <span class=md-ellipsis> get_launch_hook_paths </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_local_file_path class=md-nav__link> <span class=md-ellipsis> get_local_file_path </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_local_normalized_site class=md-nav__link> <span class=md-ellipsis> get_local_normalized_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_loop_delay class=md-nav__link> <span class=md-ellipsis> get_loop_delay </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_progress_for_repre class=md-nav__link> <span class=md-ellipsis> get_progress_for_repre </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_provider_for_site class=md-nav__link> <span class=md-ellipsis> get_provider_for_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_remote_site class=md-nav__link> <span class=md-ellipsis> get_remote_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_repre_info_for_versions class=md-nav__link> <span class=md-ellipsis> get_repre_info_for_versions </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_repre_sync_state class=md-nav__link> <span class=md-ellipsis> get_repre_sync_state </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_representations_sites_sync_state class=md-nav__link> <span class=md-ellipsis> get_representations_sites_sync_state </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_representations_sync_state class=md-nav__link> <span class=md-ellipsis> get_representations_sync_state </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_site_icons class=md-nav__link> <span class=md-ellipsis> get_site_icons </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_site_root_overrides class=md-nav__link> <span class=md-ellipsis> get_site_root_overrides </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_sync_project_setting class=md-nav__link> <span class=md-ellipsis> get_sync_project_setting </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_sync_representations class=md-nav__link> <span class=md-ellipsis> get_sync_representations </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.get_version_availability class=md-nav__link> <span class=md-ellipsis> get_version_availability </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.handle_alternate_site class=md-nav__link> <span class=md-ellipsis> handle_alternate_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.initialize class=md-nav__link> <span class=md-ellipsis> initialize </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_paused class=md-nav__link> <span class=md-ellipsis> is_paused </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_project_enabled class=md-nav__link> <span class=md-ellipsis> is_project_enabled </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_project_paused class=md-nav__link> <span class=md-ellipsis> is_project_paused </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_representation_on_site class=md-nav__link> <span class=md-ellipsis> is_representation_on_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.is_representation_paused class=md-nav__link> <span class=md-ellipsis> is_representation_paused </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.pause_project class=md-nav__link> <span class=md-ellipsis> pause_project </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.pause_representation class=md-nav__link> <span class=md-ellipsis> pause_representation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.pause_server class=md-nav__link> <span class=md-ellipsis> pause_server </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.remove_site class=md-nav__link> <span class=md-ellipsis> remove_site </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.reset_site_on_representation class=md-nav__link> <span class=md-ellipsis> reset_site_on_representation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.reset_timer class=md-nav__link> <span class=md-ellipsis> reset_timer </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.server_init class=md-nav__link> <span class=md-ellipsis> server_init </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.set_sync_project_settings class=md-nav__link> <span class=md-ellipsis> set_sync_project_settings </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.tray_exit class=md-nav__link> <span class=md-ellipsis> tray_exit </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.tray_init class=md-nav__link> <span class=md-ellipsis> tray_init </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.tray_start class=md-nav__link> <span class=md-ellipsis> tray_start </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.unpause_project class=md-nav__link> <span class=md-ellipsis> unpause_project </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.unpause_representation class=md-nav__link> <span class=md-ellipsis> unpause_representation </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.unpause_server class=md-nav__link> <span class=md-ellipsis> unpause_server </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.update_db class=md-nav__link> <span class=md-ellipsis> update_db </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_sitesync.addon.SiteSyncAddon.validate_project class=md-nav__link> <span class=md-ellipsis> validate_project </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>addon</h1> <div class="doc doc-object doc-module"> <a id=client.ayon_sitesync.addon></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=client.ayon_sitesync.addon.SiteSyncAddon class="doc doc-heading"> <code>SiteSyncAddon</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=ayon_core.addon.AYONAddon>AYONAddon</span></code>, <code><span title=ayon_core.addon.ITrayAddon>ITrayAddon</span></code>, <code><span title=ayon_core.addon.IPluginPaths>IPluginPaths</span></code></p> <p>Addon handling sync of representation files between sites.</p> <p>Synchronization server that is syncing published files from local to any of implemented providers (like GDrive, S3 etc.) Runs in the background and checks all representations, looks for files that are marked to be in different location than 'studio' (temporary), checks if 'created_dt' field is present denoting successful sync with provider destination. Sites structure is created during publish OR by calling 'add_site' method.</p> <p>State of synchronization is being persisted on the server in <code>sitesync_files_status</code> table.</p> <p>By default it will always contain 1 record with "name" == self.presets["active_site"] per representation_id with state of all its files</p> <p>Each Tray app has assigned its own self.presets["local_id"] used in sites as a name. Tray is searching only for records where name matches its self.presets["active_site"] + self.presets["remote_site"]. "active_site" could be storage in studio ('studio'), or specific "local_id" when user is working disconnected from home. If the local record has its "created_dt" filled, it is a source and process will try to upload the file to all defined remote sites.</p> <p>Remote files "id" is real id that could be used in appropriate API. Local files have "id" too, for conformity, contains just file name. It is expected that multiple providers will be implemented in separate classes and registered in 'providers.py'.</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  40</span>
<span class=normal>  41</span>
<span class=normal>  42</span>
<span class=normal>  43</span>
<span class=normal>  44</span>
<span class=normal>  45</span>
<span class=normal>  46</span>
<span class=normal>  47</span>
<span class=normal>  48</span>
<span class=normal>  49</span>
<span class=normal>  50</span>
<span class=normal>  51</span>
<span class=normal>  52</span>
<span class=normal>  53</span>
<span class=normal>  54</span>
<span class=normal>  55</span>
<span class=normal>  56</span>
<span class=normal>  57</span>
<span class=normal>  58</span>
<span class=normal>  59</span>
<span class=normal>  60</span>
<span class=normal>  61</span>
<span class=normal>  62</span>
<span class=normal>  63</span>
<span class=normal>  64</span>
<span class=normal>  65</span>
<span class=normal>  66</span>
<span class=normal>  67</span>
<span class=normal>  68</span>
<span class=normal>  69</span>
<span class=normal>  70</span>
<span class=normal>  71</span>
<span class=normal>  72</span>
<span class=normal>  73</span>
<span class=normal>  74</span>
<span class=normal>  75</span>
<span class=normal>  76</span>
<span class=normal>  77</span>
<span class=normal>  78</span>
<span class=normal>  79</span>
<span class=normal>  80</span>
<span class=normal>  81</span>
<span class=normal>  82</span>
<span class=normal>  83</span>
<span class=normal>  84</span>
<span class=normal>  85</span>
<span class=normal>  86</span>
<span class=normal>  87</span>
<span class=normal>  88</span>
<span class=normal>  89</span>
<span class=normal>  90</span>
<span class=normal>  91</span>
<span class=normal>  92</span>
<span class=normal>  93</span>
<span class=normal>  94</span>
<span class=normal>  95</span>
<span class=normal>  96</span>
<span class=normal>  97</span>
<span class=normal>  98</span>
<span class=normal>  99</span>
<span class=normal> 100</span>
<span class=normal> 101</span>
<span class=normal> 102</span>
<span class=normal> 103</span>
<span class=normal> 104</span>
<span class=normal> 105</span>
<span class=normal> 106</span>
<span class=normal> 107</span>
<span class=normal> 108</span>
<span class=normal> 109</span>
<span class=normal> 110</span>
<span class=normal> 111</span>
<span class=normal> 112</span>
<span class=normal> 113</span>
<span class=normal> 114</span>
<span class=normal> 115</span>
<span class=normal> 116</span>
<span class=normal> 117</span>
<span class=normal> 118</span>
<span class=normal> 119</span>
<span class=normal> 120</span>
<span class=normal> 121</span>
<span class=normal> 122</span>
<span class=normal> 123</span>
<span class=normal> 124</span>
<span class=normal> 125</span>
<span class=normal> 126</span>
<span class=normal> 127</span>
<span class=normal> 128</span>
<span class=normal> 129</span>
<span class=normal> 130</span>
<span class=normal> 131</span>
<span class=normal> 132</span>
<span class=normal> 133</span>
<span class=normal> 134</span>
<span class=normal> 135</span>
<span class=normal> 136</span>
<span class=normal> 137</span>
<span class=normal> 138</span>
<span class=normal> 139</span>
<span class=normal> 140</span>
<span class=normal> 141</span>
<span class=normal> 142</span>
<span class=normal> 143</span>
<span class=normal> 144</span>
<span class=normal> 145</span>
<span class=normal> 146</span>
<span class=normal> 147</span>
<span class=normal> 148</span>
<span class=normal> 149</span>
<span class=normal> 150</span>
<span class=normal> 151</span>
<span class=normal> 152</span>
<span class=normal> 153</span>
<span class=normal> 154</span>
<span class=normal> 155</span>
<span class=normal> 156</span>
<span class=normal> 157</span>
<span class=normal> 158</span>
<span class=normal> 159</span>
<span class=normal> 160</span>
<span class=normal> 161</span>
<span class=normal> 162</span>
<span class=normal> 163</span>
<span class=normal> 164</span>
<span class=normal> 165</span>
<span class=normal> 166</span>
<span class=normal> 167</span>
<span class=normal> 168</span>
<span class=normal> 169</span>
<span class=normal> 170</span>
<span class=normal> 171</span>
<span class=normal> 172</span>
<span class=normal> 173</span>
<span class=normal> 174</span>
<span class=normal> 175</span>
<span class=normal> 176</span>
<span class=normal> 177</span>
<span class=normal> 178</span>
<span class=normal> 179</span>
<span class=normal> 180</span>
<span class=normal> 181</span>
<span class=normal> 182</span>
<span class=normal> 183</span>
<span class=normal> 184</span>
<span class=normal> 185</span>
<span class=normal> 186</span>
<span class=normal> 187</span>
<span class=normal> 188</span>
<span class=normal> 189</span>
<span class=normal> 190</span>
<span class=normal> 191</span>
<span class=normal> 192</span>
<span class=normal> 193</span>
<span class=normal> 194</span>
<span class=normal> 195</span>
<span class=normal> 196</span>
<span class=normal> 197</span>
<span class=normal> 198</span>
<span class=normal> 199</span>
<span class=normal> 200</span>
<span class=normal> 201</span>
<span class=normal> 202</span>
<span class=normal> 203</span>
<span class=normal> 204</span>
<span class=normal> 205</span>
<span class=normal> 206</span>
<span class=normal> 207</span>
<span class=normal> 208</span>
<span class=normal> 209</span>
<span class=normal> 210</span>
<span class=normal> 211</span>
<span class=normal> 212</span>
<span class=normal> 213</span>
<span class=normal> 214</span>
<span class=normal> 215</span>
<span class=normal> 216</span>
<span class=normal> 217</span>
<span class=normal> 218</span>
<span class=normal> 219</span>
<span class=normal> 220</span>
<span class=normal> 221</span>
<span class=normal> 222</span>
<span class=normal> 223</span>
<span class=normal> 224</span>
<span class=normal> 225</span>
<span class=normal> 226</span>
<span class=normal> 227</span>
<span class=normal> 228</span>
<span class=normal> 229</span>
<span class=normal> 230</span>
<span class=normal> 231</span>
<span class=normal> 232</span>
<span class=normal> 233</span>
<span class=normal> 234</span>
<span class=normal> 235</span>
<span class=normal> 236</span>
<span class=normal> 237</span>
<span class=normal> 238</span>
<span class=normal> 239</span>
<span class=normal> 240</span>
<span class=normal> 241</span>
<span class=normal> 242</span>
<span class=normal> 243</span>
<span class=normal> 244</span>
<span class=normal> 245</span>
<span class=normal> 246</span>
<span class=normal> 247</span>
<span class=normal> 248</span>
<span class=normal> 249</span>
<span class=normal> 250</span>
<span class=normal> 251</span>
<span class=normal> 252</span>
<span class=normal> 253</span>
<span class=normal> 254</span>
<span class=normal> 255</span>
<span class=normal> 256</span>
<span class=normal> 257</span>
<span class=normal> 258</span>
<span class=normal> 259</span>
<span class=normal> 260</span>
<span class=normal> 261</span>
<span class=normal> 262</span>
<span class=normal> 263</span>
<span class=normal> 264</span>
<span class=normal> 265</span>
<span class=normal> 266</span>
<span class=normal> 267</span>
<span class=normal> 268</span>
<span class=normal> 269</span>
<span class=normal> 270</span>
<span class=normal> 271</span>
<span class=normal> 272</span>
<span class=normal> 273</span>
<span class=normal> 274</span>
<span class=normal> 275</span>
<span class=normal> 276</span>
<span class=normal> 277</span>
<span class=normal> 278</span>
<span class=normal> 279</span>
<span class=normal> 280</span>
<span class=normal> 281</span>
<span class=normal> 282</span>
<span class=normal> 283</span>
<span class=normal> 284</span>
<span class=normal> 285</span>
<span class=normal> 286</span>
<span class=normal> 287</span>
<span class=normal> 288</span>
<span class=normal> 289</span>
<span class=normal> 290</span>
<span class=normal> 291</span>
<span class=normal> 292</span>
<span class=normal> 293</span>
<span class=normal> 294</span>
<span class=normal> 295</span>
<span class=normal> 296</span>
<span class=normal> 297</span>
<span class=normal> 298</span>
<span class=normal> 299</span>
<span class=normal> 300</span>
<span class=normal> 301</span>
<span class=normal> 302</span>
<span class=normal> 303</span>
<span class=normal> 304</span>
<span class=normal> 305</span>
<span class=normal> 306</span>
<span class=normal> 307</span>
<span class=normal> 308</span>
<span class=normal> 309</span>
<span class=normal> 310</span>
<span class=normal> 311</span>
<span class=normal> 312</span>
<span class=normal> 313</span>
<span class=normal> 314</span>
<span class=normal> 315</span>
<span class=normal> 316</span>
<span class=normal> 317</span>
<span class=normal> 318</span>
<span class=normal> 319</span>
<span class=normal> 320</span>
<span class=normal> 321</span>
<span class=normal> 322</span>
<span class=normal> 323</span>
<span class=normal> 324</span>
<span class=normal> 325</span>
<span class=normal> 326</span>
<span class=normal> 327</span>
<span class=normal> 328</span>
<span class=normal> 329</span>
<span class=normal> 330</span>
<span class=normal> 331</span>
<span class=normal> 332</span>
<span class=normal> 333</span>
<span class=normal> 334</span>
<span class=normal> 335</span>
<span class=normal> 336</span>
<span class=normal> 337</span>
<span class=normal> 338</span>
<span class=normal> 339</span>
<span class=normal> 340</span>
<span class=normal> 341</span>
<span class=normal> 342</span>
<span class=normal> 343</span>
<span class=normal> 344</span>
<span class=normal> 345</span>
<span class=normal> 346</span>
<span class=normal> 347</span>
<span class=normal> 348</span>
<span class=normal> 349</span>
<span class=normal> 350</span>
<span class=normal> 351</span>
<span class=normal> 352</span>
<span class=normal> 353</span>
<span class=normal> 354</span>
<span class=normal> 355</span>
<span class=normal> 356</span>
<span class=normal> 357</span>
<span class=normal> 358</span>
<span class=normal> 359</span>
<span class=normal> 360</span>
<span class=normal> 361</span>
<span class=normal> 362</span>
<span class=normal> 363</span>
<span class=normal> 364</span>
<span class=normal> 365</span>
<span class=normal> 366</span>
<span class=normal> 367</span>
<span class=normal> 368</span>
<span class=normal> 369</span>
<span class=normal> 370</span>
<span class=normal> 371</span>
<span class=normal> 372</span>
<span class=normal> 373</span>
<span class=normal> 374</span>
<span class=normal> 375</span>
<span class=normal> 376</span>
<span class=normal> 377</span>
<span class=normal> 378</span>
<span class=normal> 379</span>
<span class=normal> 380</span>
<span class=normal> 381</span>
<span class=normal> 382</span>
<span class=normal> 383</span>
<span class=normal> 384</span>
<span class=normal> 385</span>
<span class=normal> 386</span>
<span class=normal> 387</span>
<span class=normal> 388</span>
<span class=normal> 389</span>
<span class=normal> 390</span>
<span class=normal> 391</span>
<span class=normal> 392</span>
<span class=normal> 393</span>
<span class=normal> 394</span>
<span class=normal> 395</span>
<span class=normal> 396</span>
<span class=normal> 397</span>
<span class=normal> 398</span>
<span class=normal> 399</span>
<span class=normal> 400</span>
<span class=normal> 401</span>
<span class=normal> 402</span>
<span class=normal> 403</span>
<span class=normal> 404</span>
<span class=normal> 405</span>
<span class=normal> 406</span>
<span class=normal> 407</span>
<span class=normal> 408</span>
<span class=normal> 409</span>
<span class=normal> 410</span>
<span class=normal> 411</span>
<span class=normal> 412</span>
<span class=normal> 413</span>
<span class=normal> 414</span>
<span class=normal> 415</span>
<span class=normal> 416</span>
<span class=normal> 417</span>
<span class=normal> 418</span>
<span class=normal> 419</span>
<span class=normal> 420</span>
<span class=normal> 421</span>
<span class=normal> 422</span>
<span class=normal> 423</span>
<span class=normal> 424</span>
<span class=normal> 425</span>
<span class=normal> 426</span>
<span class=normal> 427</span>
<span class=normal> 428</span>
<span class=normal> 429</span>
<span class=normal> 430</span>
<span class=normal> 431</span>
<span class=normal> 432</span>
<span class=normal> 433</span>
<span class=normal> 434</span>
<span class=normal> 435</span>
<span class=normal> 436</span>
<span class=normal> 437</span>
<span class=normal> 438</span>
<span class=normal> 439</span>
<span class=normal> 440</span>
<span class=normal> 441</span>
<span class=normal> 442</span>
<span class=normal> 443</span>
<span class=normal> 444</span>
<span class=normal> 445</span>
<span class=normal> 446</span>
<span class=normal> 447</span>
<span class=normal> 448</span>
<span class=normal> 449</span>
<span class=normal> 450</span>
<span class=normal> 451</span>
<span class=normal> 452</span>
<span class=normal> 453</span>
<span class=normal> 454</span>
<span class=normal> 455</span>
<span class=normal> 456</span>
<span class=normal> 457</span>
<span class=normal> 458</span>
<span class=normal> 459</span>
<span class=normal> 460</span>
<span class=normal> 461</span>
<span class=normal> 462</span>
<span class=normal> 463</span>
<span class=normal> 464</span>
<span class=normal> 465</span>
<span class=normal> 466</span>
<span class=normal> 467</span>
<span class=normal> 468</span>
<span class=normal> 469</span>
<span class=normal> 470</span>
<span class=normal> 471</span>
<span class=normal> 472</span>
<span class=normal> 473</span>
<span class=normal> 474</span>
<span class=normal> 475</span>
<span class=normal> 476</span>
<span class=normal> 477</span>
<span class=normal> 478</span>
<span class=normal> 479</span>
<span class=normal> 480</span>
<span class=normal> 481</span>
<span class=normal> 482</span>
<span class=normal> 483</span>
<span class=normal> 484</span>
<span class=normal> 485</span>
<span class=normal> 486</span>
<span class=normal> 487</span>
<span class=normal> 488</span>
<span class=normal> 489</span>
<span class=normal> 490</span>
<span class=normal> 491</span>
<span class=normal> 492</span>
<span class=normal> 493</span>
<span class=normal> 494</span>
<span class=normal> 495</span>
<span class=normal> 496</span>
<span class=normal> 497</span>
<span class=normal> 498</span>
<span class=normal> 499</span>
<span class=normal> 500</span>
<span class=normal> 501</span>
<span class=normal> 502</span>
<span class=normal> 503</span>
<span class=normal> 504</span>
<span class=normal> 505</span>
<span class=normal> 506</span>
<span class=normal> 507</span>
<span class=normal> 508</span>
<span class=normal> 509</span>
<span class=normal> 510</span>
<span class=normal> 511</span>
<span class=normal> 512</span>
<span class=normal> 513</span>
<span class=normal> 514</span>
<span class=normal> 515</span>
<span class=normal> 516</span>
<span class=normal> 517</span>
<span class=normal> 518</span>
<span class=normal> 519</span>
<span class=normal> 520</span>
<span class=normal> 521</span>
<span class=normal> 522</span>
<span class=normal> 523</span>
<span class=normal> 524</span>
<span class=normal> 525</span>
<span class=normal> 526</span>
<span class=normal> 527</span>
<span class=normal> 528</span>
<span class=normal> 529</span>
<span class=normal> 530</span>
<span class=normal> 531</span>
<span class=normal> 532</span>
<span class=normal> 533</span>
<span class=normal> 534</span>
<span class=normal> 535</span>
<span class=normal> 536</span>
<span class=normal> 537</span>
<span class=normal> 538</span>
<span class=normal> 539</span>
<span class=normal> 540</span>
<span class=normal> 541</span>
<span class=normal> 542</span>
<span class=normal> 543</span>
<span class=normal> 544</span>
<span class=normal> 545</span>
<span class=normal> 546</span>
<span class=normal> 547</span>
<span class=normal> 548</span>
<span class=normal> 549</span>
<span class=normal> 550</span>
<span class=normal> 551</span>
<span class=normal> 552</span>
<span class=normal> 553</span>
<span class=normal> 554</span>
<span class=normal> 555</span>
<span class=normal> 556</span>
<span class=normal> 557</span>
<span class=normal> 558</span>
<span class=normal> 559</span>
<span class=normal> 560</span>
<span class=normal> 561</span>
<span class=normal> 562</span>
<span class=normal> 563</span>
<span class=normal> 564</span>
<span class=normal> 565</span>
<span class=normal> 566</span>
<span class=normal> 567</span>
<span class=normal> 568</span>
<span class=normal> 569</span>
<span class=normal> 570</span>
<span class=normal> 571</span>
<span class=normal> 572</span>
<span class=normal> 573</span>
<span class=normal> 574</span>
<span class=normal> 575</span>
<span class=normal> 576</span>
<span class=normal> 577</span>
<span class=normal> 578</span>
<span class=normal> 579</span>
<span class=normal> 580</span>
<span class=normal> 581</span>
<span class=normal> 582</span>
<span class=normal> 583</span>
<span class=normal> 584</span>
<span class=normal> 585</span>
<span class=normal> 586</span>
<span class=normal> 587</span>
<span class=normal> 588</span>
<span class=normal> 589</span>
<span class=normal> 590</span>
<span class=normal> 591</span>
<span class=normal> 592</span>
<span class=normal> 593</span>
<span class=normal> 594</span>
<span class=normal> 595</span>
<span class=normal> 596</span>
<span class=normal> 597</span>
<span class=normal> 598</span>
<span class=normal> 599</span>
<span class=normal> 600</span>
<span class=normal> 601</span>
<span class=normal> 602</span>
<span class=normal> 603</span>
<span class=normal> 604</span>
<span class=normal> 605</span>
<span class=normal> 606</span>
<span class=normal> 607</span>
<span class=normal> 608</span>
<span class=normal> 609</span>
<span class=normal> 610</span>
<span class=normal> 611</span>
<span class=normal> 612</span>
<span class=normal> 613</span>
<span class=normal> 614</span>
<span class=normal> 615</span>
<span class=normal> 616</span>
<span class=normal> 617</span>
<span class=normal> 618</span>
<span class=normal> 619</span>
<span class=normal> 620</span>
<span class=normal> 621</span>
<span class=normal> 622</span>
<span class=normal> 623</span>
<span class=normal> 624</span>
<span class=normal> 625</span>
<span class=normal> 626</span>
<span class=normal> 627</span>
<span class=normal> 628</span>
<span class=normal> 629</span>
<span class=normal> 630</span>
<span class=normal> 631</span>
<span class=normal> 632</span>
<span class=normal> 633</span>
<span class=normal> 634</span>
<span class=normal> 635</span>
<span class=normal> 636</span>
<span class=normal> 637</span>
<span class=normal> 638</span>
<span class=normal> 639</span>
<span class=normal> 640</span>
<span class=normal> 641</span>
<span class=normal> 642</span>
<span class=normal> 643</span>
<span class=normal> 644</span>
<span class=normal> 645</span>
<span class=normal> 646</span>
<span class=normal> 647</span>
<span class=normal> 648</span>
<span class=normal> 649</span>
<span class=normal> 650</span>
<span class=normal> 651</span>
<span class=normal> 652</span>
<span class=normal> 653</span>
<span class=normal> 654</span>
<span class=normal> 655</span>
<span class=normal> 656</span>
<span class=normal> 657</span>
<span class=normal> 658</span>
<span class=normal> 659</span>
<span class=normal> 660</span>
<span class=normal> 661</span>
<span class=normal> 662</span>
<span class=normal> 663</span>
<span class=normal> 664</span>
<span class=normal> 665</span>
<span class=normal> 666</span>
<span class=normal> 667</span>
<span class=normal> 668</span>
<span class=normal> 669</span>
<span class=normal> 670</span>
<span class=normal> 671</span>
<span class=normal> 672</span>
<span class=normal> 673</span>
<span class=normal> 674</span>
<span class=normal> 675</span>
<span class=normal> 676</span>
<span class=normal> 677</span>
<span class=normal> 678</span>
<span class=normal> 679</span>
<span class=normal> 680</span>
<span class=normal> 681</span>
<span class=normal> 682</span>
<span class=normal> 683</span>
<span class=normal> 684</span>
<span class=normal> 685</span>
<span class=normal> 686</span>
<span class=normal> 687</span>
<span class=normal> 688</span>
<span class=normal> 689</span>
<span class=normal> 690</span>
<span class=normal> 691</span>
<span class=normal> 692</span>
<span class=normal> 693</span>
<span class=normal> 694</span>
<span class=normal> 695</span>
<span class=normal> 696</span>
<span class=normal> 697</span>
<span class=normal> 698</span>
<span class=normal> 699</span>
<span class=normal> 700</span>
<span class=normal> 701</span>
<span class=normal> 702</span>
<span class=normal> 703</span>
<span class=normal> 704</span>
<span class=normal> 705</span>
<span class=normal> 706</span>
<span class=normal> 707</span>
<span class=normal> 708</span>
<span class=normal> 709</span>
<span class=normal> 710</span>
<span class=normal> 711</span>
<span class=normal> 712</span>
<span class=normal> 713</span>
<span class=normal> 714</span>
<span class=normal> 715</span>
<span class=normal> 716</span>
<span class=normal> 717</span>
<span class=normal> 718</span>
<span class=normal> 719</span>
<span class=normal> 720</span>
<span class=normal> 721</span>
<span class=normal> 722</span>
<span class=normal> 723</span>
<span class=normal> 724</span>
<span class=normal> 725</span>
<span class=normal> 726</span>
<span class=normal> 727</span>
<span class=normal> 728</span>
<span class=normal> 729</span>
<span class=normal> 730</span>
<span class=normal> 731</span>
<span class=normal> 732</span>
<span class=normal> 733</span>
<span class=normal> 734</span>
<span class=normal> 735</span>
<span class=normal> 736</span>
<span class=normal> 737</span>
<span class=normal> 738</span>
<span class=normal> 739</span>
<span class=normal> 740</span>
<span class=normal> 741</span>
<span class=normal> 742</span>
<span class=normal> 743</span>
<span class=normal> 744</span>
<span class=normal> 745</span>
<span class=normal> 746</span>
<span class=normal> 747</span>
<span class=normal> 748</span>
<span class=normal> 749</span>
<span class=normal> 750</span>
<span class=normal> 751</span>
<span class=normal> 752</span>
<span class=normal> 753</span>
<span class=normal> 754</span>
<span class=normal> 755</span>
<span class=normal> 756</span>
<span class=normal> 757</span>
<span class=normal> 758</span>
<span class=normal> 759</span>
<span class=normal> 760</span>
<span class=normal> 761</span>
<span class=normal> 762</span>
<span class=normal> 763</span>
<span class=normal> 764</span>
<span class=normal> 765</span>
<span class=normal> 766</span>
<span class=normal> 767</span>
<span class=normal> 768</span>
<span class=normal> 769</span>
<span class=normal> 770</span>
<span class=normal> 771</span>
<span class=normal> 772</span>
<span class=normal> 773</span>
<span class=normal> 774</span>
<span class=normal> 775</span>
<span class=normal> 776</span>
<span class=normal> 777</span>
<span class=normal> 778</span>
<span class=normal> 779</span>
<span class=normal> 780</span>
<span class=normal> 781</span>
<span class=normal> 782</span>
<span class=normal> 783</span>
<span class=normal> 784</span>
<span class=normal> 785</span>
<span class=normal> 786</span>
<span class=normal> 787</span>
<span class=normal> 788</span>
<span class=normal> 789</span>
<span class=normal> 790</span>
<span class=normal> 791</span>
<span class=normal> 792</span>
<span class=normal> 793</span>
<span class=normal> 794</span>
<span class=normal> 795</span>
<span class=normal> 796</span>
<span class=normal> 797</span>
<span class=normal> 798</span>
<span class=normal> 799</span>
<span class=normal> 800</span>
<span class=normal> 801</span>
<span class=normal> 802</span>
<span class=normal> 803</span>
<span class=normal> 804</span>
<span class=normal> 805</span>
<span class=normal> 806</span>
<span class=normal> 807</span>
<span class=normal> 808</span>
<span class=normal> 809</span>
<span class=normal> 810</span>
<span class=normal> 811</span>
<span class=normal> 812</span>
<span class=normal> 813</span>
<span class=normal> 814</span>
<span class=normal> 815</span>
<span class=normal> 816</span>
<span class=normal> 817</span>
<span class=normal> 818</span>
<span class=normal> 819</span>
<span class=normal> 820</span>
<span class=normal> 821</span>
<span class=normal> 822</span>
<span class=normal> 823</span>
<span class=normal> 824</span>
<span class=normal> 825</span>
<span class=normal> 826</span>
<span class=normal> 827</span>
<span class=normal> 828</span>
<span class=normal> 829</span>
<span class=normal> 830</span>
<span class=normal> 831</span>
<span class=normal> 832</span>
<span class=normal> 833</span>
<span class=normal> 834</span>
<span class=normal> 835</span>
<span class=normal> 836</span>
<span class=normal> 837</span>
<span class=normal> 838</span>
<span class=normal> 839</span>
<span class=normal> 840</span>
<span class=normal> 841</span>
<span class=normal> 842</span>
<span class=normal> 843</span>
<span class=normal> 844</span>
<span class=normal> 845</span>
<span class=normal> 846</span>
<span class=normal> 847</span>
<span class=normal> 848</span>
<span class=normal> 849</span>
<span class=normal> 850</span>
<span class=normal> 851</span>
<span class=normal> 852</span>
<span class=normal> 853</span>
<span class=normal> 854</span>
<span class=normal> 855</span>
<span class=normal> 856</span>
<span class=normal> 857</span>
<span class=normal> 858</span>
<span class=normal> 859</span>
<span class=normal> 860</span>
<span class=normal> 861</span>
<span class=normal> 862</span>
<span class=normal> 863</span>
<span class=normal> 864</span>
<span class=normal> 865</span>
<span class=normal> 866</span>
<span class=normal> 867</span>
<span class=normal> 868</span>
<span class=normal> 869</span>
<span class=normal> 870</span>
<span class=normal> 871</span>
<span class=normal> 872</span>
<span class=normal> 873</span>
<span class=normal> 874</span>
<span class=normal> 875</span>
<span class=normal> 876</span>
<span class=normal> 877</span>
<span class=normal> 878</span>
<span class=normal> 879</span>
<span class=normal> 880</span>
<span class=normal> 881</span>
<span class=normal> 882</span>
<span class=normal> 883</span>
<span class=normal> 884</span>
<span class=normal> 885</span>
<span class=normal> 886</span>
<span class=normal> 887</span>
<span class=normal> 888</span>
<span class=normal> 889</span>
<span class=normal> 890</span>
<span class=normal> 891</span>
<span class=normal> 892</span>
<span class=normal> 893</span>
<span class=normal> 894</span>
<span class=normal> 895</span>
<span class=normal> 896</span>
<span class=normal> 897</span>
<span class=normal> 898</span>
<span class=normal> 899</span>
<span class=normal> 900</span>
<span class=normal> 901</span>
<span class=normal> 902</span>
<span class=normal> 903</span>
<span class=normal> 904</span>
<span class=normal> 905</span>
<span class=normal> 906</span>
<span class=normal> 907</span>
<span class=normal> 908</span>
<span class=normal> 909</span>
<span class=normal> 910</span>
<span class=normal> 911</span>
<span class=normal> 912</span>
<span class=normal> 913</span>
<span class=normal> 914</span>
<span class=normal> 915</span>
<span class=normal> 916</span>
<span class=normal> 917</span>
<span class=normal> 918</span>
<span class=normal> 919</span>
<span class=normal> 920</span>
<span class=normal> 921</span>
<span class=normal> 922</span>
<span class=normal> 923</span>
<span class=normal> 924</span>
<span class=normal> 925</span>
<span class=normal> 926</span>
<span class=normal> 927</span>
<span class=normal> 928</span>
<span class=normal> 929</span>
<span class=normal> 930</span>
<span class=normal> 931</span>
<span class=normal> 932</span>
<span class=normal> 933</span>
<span class=normal> 934</span>
<span class=normal> 935</span>
<span class=normal> 936</span>
<span class=normal> 937</span>
<span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span>
<span class=normal>1126</span>
<span class=normal>1127</span>
<span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span>
<span class=normal>1185</span>
<span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span>
<span class=normal>1230</span>
<span class=normal>1231</span>
<span class=normal>1232</span>
<span class=normal>1233</span>
<span class=normal>1234</span>
<span class=normal>1235</span>
<span class=normal>1236</span>
<span class=normal>1237</span>
<span class=normal>1238</span>
<span class=normal>1239</span>
<span class=normal>1240</span>
<span class=normal>1241</span>
<span class=normal>1242</span>
<span class=normal>1243</span>
<span class=normal>1244</span>
<span class=normal>1245</span>
<span class=normal>1246</span>
<span class=normal>1247</span>
<span class=normal>1248</span>
<span class=normal>1249</span>
<span class=normal>1250</span>
<span class=normal>1251</span>
<span class=normal>1252</span>
<span class=normal>1253</span>
<span class=normal>1254</span>
<span class=normal>1255</span>
<span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span>
<span class=normal>1264</span>
<span class=normal>1265</span>
<span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span>
<span class=normal>1290</span>
<span class=normal>1291</span>
<span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span>
<span class=normal>1307</span>
<span class=normal>1308</span>
<span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span>
<span class=normal>1327</span>
<span class=normal>1328</span>
<span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span>
<span class=normal>1340</span>
<span class=normal>1341</span>
<span class=normal>1342</span>
<span class=normal>1343</span>
<span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span>
<span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span>
<span class=normal>1475</span>
<span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span>
<span class=normal>1499</span>
<span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span>
<span class=normal>1511</span>
<span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span>
<span class=normal>1526</span>
<span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span>
<span class=normal>1566</span>
<span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span>
<span class=normal>1579</span>
<span class=normal>1580</span>
<span class=normal>1581</span>
<span class=normal>1582</span>
<span class=normal>1583</span>
<span class=normal>1584</span>
<span class=normal>1585</span>
<span class=normal>1586</span>
<span class=normal>1587</span>
<span class=normal>1588</span>
<span class=normal>1589</span>
<span class=normal>1590</span>
<span class=normal>1591</span>
<span class=normal>1592</span>
<span class=normal>1593</span>
<span class=normal>1594</span>
<span class=normal>1595</span>
<span class=normal>1596</span>
<span class=normal>1597</span>
<span class=normal>1598</span>
<span class=normal>1599</span>
<span class=normal>1600</span>
<span class=normal>1601</span>
<span class=normal>1602</span>
<span class=normal>1603</span>
<span class=normal>1604</span>
<span class=normal>1605</span>
<span class=normal>1606</span>
<span class=normal>1607</span>
<span class=normal>1608</span>
<span class=normal>1609</span>
<span class=normal>1610</span>
<span class=normal>1611</span>
<span class=normal>1612</span>
<span class=normal>1613</span>
<span class=normal>1614</span>
<span class=normal>1615</span>
<span class=normal>1616</span>
<span class=normal>1617</span>
<span class=normal>1618</span>
<span class=normal>1619</span>
<span class=normal>1620</span>
<span class=normal>1621</span>
<span class=normal>1622</span>
<span class=normal>1623</span>
<span class=normal>1624</span>
<span class=normal>1625</span>
<span class=normal>1626</span>
<span class=normal>1627</span>
<span class=normal>1628</span>
<span class=normal>1629</span>
<span class=normal>1630</span>
<span class=normal>1631</span>
<span class=normal>1632</span>
<span class=normal>1633</span>
<span class=normal>1634</span>
<span class=normal>1635</span>
<span class=normal>1636</span>
<span class=normal>1637</span>
<span class=normal>1638</span>
<span class=normal>1639</span>
<span class=normal>1640</span>
<span class=normal>1641</span>
<span class=normal>1642</span>
<span class=normal>1643</span>
<span class=normal>1644</span>
<span class=normal>1645</span>
<span class=normal>1646</span>
<span class=normal>1647</span>
<span class=normal>1648</span>
<span class=normal>1649</span>
<span class=normal>1650</span>
<span class=normal>1651</span>
<span class=normal>1652</span>
<span class=normal>1653</span>
<span class=normal>1654</span>
<span class=normal>1655</span>
<span class=normal>1656</span>
<span class=normal>1657</span>
<span class=normal>1658</span>
<span class=normal>1659</span>
<span class=normal>1660</span>
<span class=normal>1661</span>
<span class=normal>1662</span>
<span class=normal>1663</span>
<span class=normal>1664</span>
<span class=normal>1665</span>
<span class=normal>1666</span>
<span class=normal>1667</span>
<span class=normal>1668</span>
<span class=normal>1669</span>
<span class=normal>1670</span>
<span class=normal>1671</span>
<span class=normal>1672</span>
<span class=normal>1673</span>
<span class=normal>1674</span>
<span class=normal>1675</span>
<span class=normal>1676</span>
<span class=normal>1677</span>
<span class=normal>1678</span>
<span class=normal>1679</span>
<span class=normal>1680</span>
<span class=normal>1681</span>
<span class=normal>1682</span>
<span class=normal>1683</span>
<span class=normal>1684</span>
<span class=normal>1685</span>
<span class=normal>1686</span>
<span class=normal>1687</span>
<span class=normal>1688</span>
<span class=normal>1689</span>
<span class=normal>1690</span>
<span class=normal>1691</span>
<span class=normal>1692</span>
<span class=normal>1693</span>
<span class=normal>1694</span>
<span class=normal>1695</span>
<span class=normal>1696</span>
<span class=normal>1697</span>
<span class=normal>1698</span>
<span class=normal>1699</span>
<span class=normal>1700</span>
<span class=normal>1701</span>
<span class=normal>1702</span>
<span class=normal>1703</span>
<span class=normal>1704</span>
<span class=normal>1705</span>
<span class=normal>1706</span>
<span class=normal>1707</span>
<span class=normal>1708</span>
<span class=normal>1709</span>
<span class=normal>1710</span>
<span class=normal>1711</span>
<span class=normal>1712</span>
<span class=normal>1713</span>
<span class=normal>1714</span>
<span class=normal>1715</span>
<span class=normal>1716</span>
<span class=normal>1717</span>
<span class=normal>1718</span>
<span class=normal>1719</span>
<span class=normal>1720</span>
<span class=normal>1721</span>
<span class=normal>1722</span>
<span class=normal>1723</span>
<span class=normal>1724</span>
<span class=normal>1725</span>
<span class=normal>1726</span>
<span class=normal>1727</span>
<span class=normal>1728</span>
<span class=normal>1729</span>
<span class=normal>1730</span>
<span class=normal>1731</span>
<span class=normal>1732</span>
<span class=normal>1733</span>
<span class=normal>1734</span>
<span class=normal>1735</span>
<span class=normal>1736</span>
<span class=normal>1737</span>
<span class=normal>1738</span>
<span class=normal>1739</span>
<span class=normal>1740</span>
<span class=normal>1741</span>
<span class=normal>1742</span>
<span class=normal>1743</span>
<span class=normal>1744</span>
<span class=normal>1745</span>
<span class=normal>1746</span>
<span class=normal>1747</span>
<span class=normal>1748</span>
<span class=normal>1749</span>
<span class=normal>1750</span>
<span class=normal>1751</span>
<span class=normal>1752</span>
<span class=normal>1753</span>
<span class=normal>1754</span>
<span class=normal>1755</span>
<span class=normal>1756</span>
<span class=normal>1757</span>
<span class=normal>1758</span>
<span class=normal>1759</span>
<span class=normal>1760</span>
<span class=normal>1761</span>
<span class=normal>1762</span>
<span class=normal>1763</span>
<span class=normal>1764</span>
<span class=normal>1765</span>
<span class=normal>1766</span>
<span class=normal>1767</span>
<span class=normal>1768</span>
<span class=normal>1769</span>
<span class=normal>1770</span>
<span class=normal>1771</span>
<span class=normal>1772</span>
<span class=normal>1773</span>
<span class=normal>1774</span>
<span class=normal>1775</span>
<span class=normal>1776</span>
<span class=normal>1777</span>
<span class=normal>1778</span>
<span class=normal>1779</span>
<span class=normal>1780</span>
<span class=normal>1781</span>
<span class=normal>1782</span>
<span class=normal>1783</span>
<span class=normal>1784</span>
<span class=normal>1785</span>
<span class=normal>1786</span>
<span class=normal>1787</span>
<span class=normal>1788</span>
<span class=normal>1789</span>
<span class=normal>1790</span>
<span class=normal>1791</span>
<span class=normal>1792</span>
<span class=normal>1793</span>
<span class=normal>1794</span>
<span class=normal>1795</span>
<span class=normal>1796</span>
<span class=normal>1797</span>
<span class=normal>1798</span>
<span class=normal>1799</span>
<span class=normal>1800</span>
<span class=normal>1801</span>
<span class=normal>1802</span>
<span class=normal>1803</span>
<span class=normal>1804</span>
<span class=normal>1805</span>
<span class=normal>1806</span>
<span class=normal>1807</span>
<span class=normal>1808</span>
<span class=normal>1809</span>
<span class=normal>1810</span>
<span class=normal>1811</span>
<span class=normal>1812</span>
<span class=normal>1813</span>
<span class=normal>1814</span>
<span class=normal>1815</span>
<span class=normal>1816</span>
<span class=normal>1817</span>
<span class=normal>1818</span>
<span class=normal>1819</span>
<span class=normal>1820</span>
<span class=normal>1821</span>
<span class=normal>1822</span>
<span class=normal>1823</span>
<span class=normal>1824</span>
<span class=normal>1825</span>
<span class=normal>1826</span>
<span class=normal>1827</span>
<span class=normal>1828</span>
<span class=normal>1829</span>
<span class=normal>1830</span>
<span class=normal>1831</span>
<span class=normal>1832</span>
<span class=normal>1833</span>
<span class=normal>1834</span>
<span class=normal>1835</span>
<span class=normal>1836</span>
<span class=normal>1837</span>
<span class=normal>1838</span>
<span class=normal>1839</span>
<span class=normal>1840</span>
<span class=normal>1841</span>
<span class=normal>1842</span>
<span class=normal>1843</span>
<span class=normal>1844</span>
<span class=normal>1845</span>
<span class=normal>1846</span>
<span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span>
<span class=normal>1862</span>
<span class=normal>1863</span>
<span class=normal>1864</span>
<span class=normal>1865</span>
<span class=normal>1866</span>
<span class=normal>1867</span>
<span class=normal>1868</span>
<span class=normal>1869</span>
<span class=normal>1870</span>
<span class=normal>1871</span>
<span class=normal>1872</span>
<span class=normal>1873</span>
<span class=normal>1874</span>
<span class=normal>1875</span>
<span class=normal>1876</span>
<span class=normal>1877</span>
<span class=normal>1878</span>
<span class=normal>1879</span>
<span class=normal>1880</span>
<span class=normal>1881</span>
<span class=normal>1882</span>
<span class=normal>1883</span>
<span class=normal>1884</span>
<span class=normal>1885</span>
<span class=normal>1886</span>
<span class=normal>1887</span>
<span class=normal>1888</span>
<span class=normal>1889</span>
<span class=normal>1890</span>
<span class=normal>1891</span>
<span class=normal>1892</span>
<span class=normal>1893</span>
<span class=normal>1894</span>
<span class=normal>1895</span>
<span class=normal>1896</span>
<span class=normal>1897</span>
<span class=normal>1898</span>
<span class=normal>1899</span>
<span class=normal>1900</span>
<span class=normal>1901</span>
<span class=normal>1902</span>
<span class=normal>1903</span>
<span class=normal>1904</span>
<span class=normal>1905</span>
<span class=normal>1906</span>
<span class=normal>1907</span>
<span class=normal>1908</span>
<span class=normal>1909</span>
<span class=normal>1910</span>
<span class=normal>1911</span>
<span class=normal>1912</span>
<span class=normal>1913</span>
<span class=normal>1914</span>
<span class=normal>1915</span>
<span class=normal>1916</span>
<span class=normal>1917</span>
<span class=normal>1918</span>
<span class=normal>1919</span>
<span class=normal>1920</span>
<span class=normal>1921</span>
<span class=normal>1922</span>
<span class=normal>1923</span>
<span class=normal>1924</span>
<span class=normal>1925</span>
<span class=normal>1926</span>
<span class=normal>1927</span>
<span class=normal>1928</span>
<span class=normal>1929</span>
<span class=normal>1930</span>
<span class=normal>1931</span>
<span class=normal>1932</span>
<span class=normal>1933</span>
<span class=normal>1934</span>
<span class=normal>1935</span>
<span class=normal>1936</span>
<span class=normal>1937</span>
<span class=normal>1938</span>
<span class=normal>1939</span>
<span class=normal>1940</span>
<span class=normal>1941</span>
<span class=normal>1942</span>
<span class=normal>1943</span>
<span class=normal>1944</span>
<span class=normal>1945</span>
<span class=normal>1946</span>
<span class=normal>1947</span>
<span class=normal>1948</span>
<span class=normal>1949</span>
<span class=normal>1950</span>
<span class=normal>1951</span>
<span class=normal>1952</span>
<span class=normal>1953</span>
<span class=normal>1954</span>
<span class=normal>1955</span>
<span class=normal>1956</span>
<span class=normal>1957</span>
<span class=normal>1958</span>
<span class=normal>1959</span>
<span class=normal>1960</span>
<span class=normal>1961</span>
<span class=normal>1962</span>
<span class=normal>1963</span>
<span class=normal>1964</span>
<span class=normal>1965</span>
<span class=normal>1966</span>
<span class=normal>1967</span>
<span class=normal>1968</span>
<span class=normal>1969</span>
<span class=normal>1970</span>
<span class=normal>1971</span>
<span class=normal>1972</span>
<span class=normal>1973</span>
<span class=normal>1974</span>
<span class=normal>1975</span>
<span class=normal>1976</span>
<span class=normal>1977</span>
<span class=normal>1978</span>
<span class=normal>1979</span>
<span class=normal>1980</span>
<span class=normal>1981</span>
<span class=normal>1982</span>
<span class=normal>1983</span>
<span class=normal>1984</span>
<span class=normal>1985</span>
<span class=normal>1986</span>
<span class=normal>1987</span>
<span class=normal>1988</span>
<span class=normal>1989</span>
<span class=normal>1990</span>
<span class=normal>1991</span>
<span class=normal>1992</span>
<span class=normal>1993</span>
<span class=normal>1994</span>
<span class=normal>1995</span>
<span class=normal>1996</span>
<span class=normal>1997</span>
<span class=normal>1998</span>
<span class=normal>1999</span>
<span class=normal>2000</span>
<span class=normal>2001</span>
<span class=normal>2002</span>
<span class=normal>2003</span>
<span class=normal>2004</span>
<span class=normal>2005</span>
<span class=normal>2006</span>
<span class=normal>2007</span>
<span class=normal>2008</span>
<span class=normal>2009</span>
<span class=normal>2010</span>
<span class=normal>2011</span>
<span class=normal>2012</span>
<span class=normal>2013</span>
<span class=normal>2014</span>
<span class=normal>2015</span>
<span class=normal>2016</span>
<span class=normal>2017</span>
<span class=normal>2018</span>
<span class=normal>2019</span>
<span class=normal>2020</span>
<span class=normal>2021</span>
<span class=normal>2022</span>
<span class=normal>2023</span>
<span class=normal>2024</span>
<span class=normal>2025</span>
<span class=normal>2026</span>
<span class=normal>2027</span>
<span class=normal>2028</span>
<span class=normal>2029</span>
<span class=normal>2030</span>
<span class=normal>2031</span>
<span class=normal>2032</span>
<span class=normal>2033</span>
<span class=normal>2034</span>
<span class=normal>2035</span>
<span class=normal>2036</span>
<span class=normal>2037</span>
<span class=normal>2038</span>
<span class=normal>2039</span>
<span class=normal>2040</span>
<span class=normal>2041</span>
<span class=normal>2042</span>
<span class=normal>2043</span>
<span class=normal>2044</span>
<span class=normal>2045</span>
<span class=normal>2046</span>
<span class=normal>2047</span>
<span class=normal>2048</span>
<span class=normal>2049</span>
<span class=normal>2050</span>
<span class=normal>2051</span>
<span class=normal>2052</span>
<span class=normal>2053</span>
<span class=normal>2054</span>
<span class=normal>2055</span>
<span class=normal>2056</span>
<span class=normal>2057</span>
<span class=normal>2058</span>
<span class=normal>2059</span>
<span class=normal>2060</span>
<span class=normal>2061</span>
<span class=normal>2062</span>
<span class=normal>2063</span>
<span class=normal>2064</span>
<span class=normal>2065</span>
<span class=normal>2066</span>
<span class=normal>2067</span>
<span class=normal>2068</span>
<span class=normal>2069</span>
<span class=normal>2070</span>
<span class=normal>2071</span>
<span class=normal>2072</span>
<span class=normal>2073</span>
<span class=normal>2074</span>
<span class=normal>2075</span>
<span class=normal>2076</span>
<span class=normal>2077</span>
<span class=normal>2078</span>
<span class=normal>2079</span>
<span class=normal>2080</span>
<span class=normal>2081</span>
<span class=normal>2082</span>
<span class=normal>2083</span>
<span class=normal>2084</span>
<span class=normal>2085</span>
<span class=normal>2086</span>
<span class=normal>2087</span>
<span class=normal>2088</span>
<span class=normal>2089</span>
<span class=normal>2090</span>
<span class=normal>2091</span>
<span class=normal>2092</span>
<span class=normal>2093</span>
<span class=normal>2094</span>
<span class=normal>2095</span>
<span class=normal>2096</span>
<span class=normal>2097</span>
<span class=normal>2098</span>
<span class=normal>2099</span>
<span class=normal>2100</span>
<span class=normal>2101</span>
<span class=normal>2102</span>
<span class=normal>2103</span>
<span class=normal>2104</span>
<span class=normal>2105</span>
<span class=normal>2106</span>
<span class=normal>2107</span>
<span class=normal>2108</span>
<span class=normal>2109</span>
<span class=normal>2110</span>
<span class=normal>2111</span>
<span class=normal>2112</span>
<span class=normal>2113</span>
<span class=normal>2114</span>
<span class=normal>2115</span>
<span class=normal>2116</span>
<span class=normal>2117</span>
<span class=normal>2118</span>
<span class=normal>2119</span>
<span class=normal>2120</span>
<span class=normal>2121</span>
<span class=normal>2122</span>
<span class=normal>2123</span>
<span class=normal>2124</span>
<span class=normal>2125</span>
<span class=normal>2126</span>
<span class=normal>2127</span>
<span class=normal>2128</span>
<span class=normal>2129</span>
<span class=normal>2130</span>
<span class=normal>2131</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>SiteSyncAddon</span><span class=p>(</span><span class=n>AYONAddon</span><span class=p>,</span> <span class=n>ITrayAddon</span><span class=p>,</span> <span class=n>IPluginPaths</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Addon handling sync of representation files between sites.</span>

<span class=sd>    Synchronization server that is syncing published files from local to</span>
<span class=sd>    any of implemented providers (like GDrive, S3 etc.)</span>
<span class=sd>    Runs in the background and checks all representations, looks for files</span>
<span class=sd>    that are marked to be in different location than &#39;studio&#39; (temporary),</span>
<span class=sd>    checks if &#39;created_dt&#39; field is present denoting successful sync</span>
<span class=sd>    with provider destination.</span>
<span class=sd>    Sites structure is created during publish OR by calling &#39;add_site&#39;</span>
<span class=sd>    method.</span>

<span class=sd>    State of synchronization is being persisted on the server</span>
<span class=sd>    in `sitesync_files_status` table.</span>

<span class=sd>    By default it will always contain 1 record with</span>
<span class=sd>    &quot;name&quot; ==  self.presets[&quot;active_site&quot;] per representation_id with state</span>
<span class=sd>    of all its files</span>

<span class=sd>    Each Tray app has assigned its own  self.presets[&quot;local_id&quot;]</span>
<span class=sd>    used in sites as a name.</span>
<span class=sd>    Tray is searching only for records where name matches its</span>
<span class=sd>    self.presets[&quot;active_site&quot;] + self.presets[&quot;remote_site&quot;].</span>
<span class=sd>    &quot;active_site&quot; could be storage in studio (&#39;studio&#39;), or specific</span>
<span class=sd>    &quot;local_id&quot; when user is working disconnected from home.</span>
<span class=sd>    If the local record has its &quot;created_dt&quot; filled, it is a source and</span>
<span class=sd>    process will try to upload the file to all defined remote sites.</span>

<span class=sd>    Remote files &quot;id&quot; is real id that could be used in appropriate API.</span>
<span class=sd>    Local files have &quot;id&quot; too, for conformity, contains just file name.</span>
<span class=sd>    It is expected that multiple providers will be implemented in separate</span>
<span class=sd>    classes and registered in &#39;providers.py&#39;.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># limit querying DB to look for X number of representations that should</span>
    <span class=c1># be sync, we try to run more loops with less records</span>
    <span class=c1># actual number of files synced could be lower as providers can have</span>
    <span class=c1># different limits imposed by its API</span>
    <span class=c1># set 0 to no limit</span>
    <span class=n>REPRESENTATION_LIMIT</span> <span class=o>=</span> <span class=mi>100</span>
    <span class=n>DEFAULT_SITE</span> <span class=o>=</span> <span class=s2>&quot;studio&quot;</span>
    <span class=n>LOCAL_SITE</span> <span class=o>=</span> <span class=s2>&quot;local&quot;</span>
    <span class=n>LOG_PROGRESS_SEC</span> <span class=o>=</span> <span class=mi>5</span>  <span class=c1># how often log progress to DB</span>
    <span class=n>DEFAULT_PRIORITY</span> <span class=o>=</span> <span class=mi>50</span>  <span class=c1># higher is better, allowed range 1 - 1000</span>

    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;sitesync&quot;</span>
    <span class=n>version</span> <span class=o>=</span> <span class=n>__version__</span>

    <span class=k>def</span><span class=w> </span><span class=nf>initialize</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>addon_settings</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Called during Addon Manager creation.</span>

<span class=sd>        Collects needed data, checks asyncio presence.</span>
<span class=sd>        Sets &#39;enabled&#39; according to global settings for the addon.</span>
<span class=sd>        Shouldn&#39;t be doing any initialization, that&#39;s a job for &#39;tray_init&#39;</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=c1># some parts of code need to run sequentially, not in async</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_sync_studio_settings</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=c1># settings for all enabled projects for sync</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_sync_project_settings</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># asyncio requires new thread</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_paused</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_paused_projects</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_paused_representations</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_anatomies</span> <span class=o>=</span> <span class=p>{}</span>

        <span class=c1># list of long blocking tasks</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>long_running_tasks</span> <span class=o>=</span> <span class=n>deque</span><span class=p>()</span>
        <span class=c1># projects that long tasks are running on</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>projects_processed</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>endpoint_prefix</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;addons/</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>version</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_plugin_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=p>{</span>
            <span class=s2>&quot;publish&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>SYNC_ADDON_DIR</span><span class=p>,</span> <span class=s2>&quot;plugins&quot;</span><span class=p>,</span> <span class=s2>&quot;publish&quot;</span><span class=p>)</span>
        <span class=p>}</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_site_icons</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Icons for sites.</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict[str, str]: Path to icon by site.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>resource_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>SYNC_ADDON_DIR</span><span class=p>,</span> <span class=s2>&quot;providers&quot;</span><span class=p>,</span> <span class=s2>&quot;resources&quot;</span>
        <span class=p>)</span>
        <span class=n>icons</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>for</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>resource_path</span><span class=p>):</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>file_path</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.png&quot;</span><span class=p>):</span>
                <span class=k>continue</span>
            <span class=n>provider_name</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>))</span>
            <span class=n>icons</span><span class=p>[</span><span class=n>provider_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;path&quot;</span><span class=p>,</span>
                <span class=s2>&quot;path&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>resource_path</span><span class=p>,</span> <span class=n>file_path</span><span class=p>)</span>
            <span class=p>}</span>
        <span class=k>return</span> <span class=n>icons</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_launch_hook_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Implementation for applications launch hooks.</span>

<span class=sd>        Returns:</span>
<span class=sd>            str: full absolut path to directory with hooks for the addon</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)),</span>
            <span class=s2>&quot;launch_hooks&quot;</span>
        <span class=p>)</span>

    <span class=c1># --- Public API ---</span>
    <span class=k>def</span><span class=w> </span><span class=nf>add_site</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_id</span><span class=p>,</span>
        <span class=n>site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
        <span class=n>status</span><span class=o>=</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>QUEUED</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Adds new site to representation to be synced.</span>

<span class=sd>        &#39;project_name&#39; must have synchronization enabled (globally or</span>
<span class=sd>        project only)</span>

<span class=sd>        Used as a API endpoint from outside applications (Loader etc).</span>

<span class=sd>        Use &#39;force&#39; to reset existing site.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>
<span class=sd>            representation_id (str): Representation id.</span>
<span class=sd>            site_name (str): Site name of configured site.</span>
<span class=sd>            file_id (str): File id.</span>
<span class=sd>            force (bool): Reset site if exists.</span>
<span class=sd>            status (SiteSyncStatus): Current status,</span>
<span class=sd>                default SiteSyncStatus.QUEUED</span>

<span class=sd>        Raises:</span>
<span class=sd>            SiteAlreadyPresentError: If adding already existing site and</span>
<span class=sd>                not &#39;force&#39;</span>
<span class=sd>            ValueError: other errors (repre not found, misconfiguration)</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>):</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Project not configured&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>site_name</span><span class=p>:</span>
            <span class=n>site_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>DEFAULT_SITE</span>

        <span class=n>representation</span> <span class=o>=</span> <span class=n>get_representation_by_id</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span>
        <span class=p>)</span>

        <span class=n>files</span> <span class=o>=</span> <span class=n>representation</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[])</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>files</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;No files for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>representation_id</span><span class=p>))</span>
            <span class=k>return</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>force</span><span class=p>:</span>
            <span class=n>existing</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_repre_sync_state</span><span class=p>(</span>
                <span class=n>project_name</span><span class=p>,</span>
                <span class=n>representation_id</span><span class=p>,</span>
                <span class=n>site_name</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=n>existing</span><span class=p>:</span>
                <span class=n>failure</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=k>if</span> <span class=n>file_id</span><span class=p>:</span>
                    <span class=n>file_exists</span> <span class=o>=</span> <span class=n>existing</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>file_id</span><span class=p>)</span>
                    <span class=k>if</span> <span class=ow>not</span> <span class=n>file_exists</span><span class=p>:</span>
                        <span class=n>failure</span> <span class=o>=</span> <span class=kc>False</span>

                <span class=k>if</span> <span class=n>failure</span><span class=p>:</span>
                    <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Site </span><span class=si>{}</span><span class=s2> already present&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
                    <span class=k>raise</span> <span class=n>SiteAlreadyPresentError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>

        <span class=n>new_site_files</span> <span class=o>=</span> <span class=p>[</span>
            <span class=p>{</span>
                <span class=s2>&quot;size&quot;</span><span class=p>:</span> <span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;size&quot;</span><span class=p>],</span>
                <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=n>status</span><span class=p>,</span>
                <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>timestamp</span><span class=p>(),</span>
                <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                <span class=s2>&quot;fileHash&quot;</span><span class=p>:</span> <span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;hash&quot;</span><span class=p>]</span>
            <span class=p>}</span>
            <span class=k>for</span> <span class=n>repre_file</span> <span class=ow>in</span> <span class=n>files</span>
        <span class=p>]</span>

        <span class=n>payload_dict</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;files&quot;</span><span class=p>:</span> <span class=n>new_site_files</span><span class=p>}</span>
        <span class=n>representation_id</span> <span class=o>=</span> <span class=n>representation_id</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;-&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_set_state_sync_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>payload_dict</span><span class=p>,</span> <span class=n>force</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>remove_site</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_id</span><span class=p>,</span>
        <span class=n>site_name</span><span class=p>,</span>
        <span class=n>remove_local_files</span><span class=o>=</span><span class=kc>False</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Removes site for particular representation in project.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): project name (must match DB)</span>
<span class=sd>            representation_id (str): MongoDB _id value</span>
<span class=sd>            site_name (str): name of configured and active site</span>
<span class=sd>            remove_local_files (bool): remove only files for &#39;local_id&#39;</span>
<span class=sd>                site</span>

<span class=sd>        Raises:</span>
<span class=sd>            ValueError: Throws if any issue.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>):</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Project not configured&quot;</span><span class=p>)</span>

        <span class=n>sync_info</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_repre_sync_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>representation_id</span><span class=p>,</span>
            <span class=n>site_name</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>sync_info</span><span class=p>:</span>
            <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Site </span><span class=si>{}</span><span class=s2> not found&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
            <span class=k>return</span>

        <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state/</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>representation_id</span><span class=p>,</span>
            <span class=n>site_name</span>
        <span class=p>)</span>

        <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>endpoint</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>200</span><span class=p>,</span> <span class=mi>204</span><span class=p>]:</span>
            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Cannot update status&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>remove_local_files</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_remove_local_file</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>compute_resource_sync_sites</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get available resource sync sites state for publish process.</span>

<span class=sd>        Returns dict with prepared state of sync sites for &#39;project_name&#39;.</span>
<span class=sd>        It checks if Site Sync is enabled, handles alternative sites.</span>
<span class=sd>        Publish process stores this dictionary as a part of representation</span>
<span class=sd>        document in DB.</span>

<span class=sd>        Example:</span>
<span class=sd>        [</span>
<span class=sd>            {</span>
<span class=sd>                &#39;name&#39;: &#39;42abbc09-d62a-44a4-815c-a12cd679d2d7&#39;,</span>
<span class=sd>                &#39;status&#39;: SiteSyncStatus.OK</span>
<span class=sd>            },</span>
<span class=sd>            {&#39;name&#39;: &#39;studio&#39;, &#39;status&#39;: SiteSyncStatus.QUEUED},</span>
<span class=sd>            {&#39;name&#39;: &#39;SFTP&#39;, &#39;status&#39;: SiteSyncStatus.QUEUED}</span>
<span class=sd>        ] -- representation is published locally, artist or Settings have set</span>
<span class=sd>        remote site as &#39;studio&#39;. &#39;SFTP&#39; is alternate site to &#39;studio&#39;. Eg.</span>
<span class=sd>        whenever file is on &#39;studio&#39;, it is also on &#39;SFTP&#39;.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>def</span><span class=w> </span><span class=nf>create_metadata</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>created</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;Create sync site metadata for site with `name`&quot;&quot;&quot;</span>
            <span class=k>if</span> <span class=n>created</span><span class=p>:</span>
                <span class=n>status</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>status</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>QUEUED</span>
            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span> <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=n>status</span><span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span>
            <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_studio_settings</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]</span>
            <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span><span class=p>[</span><span class=n>project_name</span><span class=p>][</span><span class=s2>&quot;enabled&quot;</span><span class=p>]</span>
        <span class=p>):</span>
            <span class=k>return</span> <span class=p>[</span><span class=n>create_metadata</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>DEFAULT_SITE</span><span class=p>)]</span>

        <span class=n>local_site</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_active_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=n>remote_site</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_remote_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

        <span class=c1># Attached sites metadata by site name</span>
        <span class=c1># That is the local site, remote site, the always accesible sites</span>
        <span class=c1># and their alternate sites (alias of sites with different protocol)</span>
        <span class=n>attached_sites</span> <span class=o>=</span> <span class=p>{</span>
            <span class=n>local_site</span><span class=p>:</span> <span class=n>create_metadata</span><span class=p>(</span><span class=n>local_site</span><span class=p>)</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=n>remote_site</span> <span class=ow>and</span> <span class=n>remote_site</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>attached_sites</span><span class=p>:</span>
            <span class=n>attached_sites</span><span class=p>[</span><span class=n>remote_site</span><span class=p>]</span> <span class=o>=</span> <span class=n>create_metadata</span><span class=p>(</span>
                <span class=n>remote_site</span><span class=p>,</span> <span class=n>created</span><span class=o>=</span><span class=kc>False</span>
            <span class=p>)</span>

        <span class=n>attached_sites</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_add_alternative_sites</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>attached_sites</span><span class=p>)</span>
        <span class=c1># add skeleton for sites where it should be always synced to</span>
        <span class=c1># usually it would be a backup site which is handled by separate</span>
        <span class=c1># background process</span>
        <span class=k>for</span> <span class=n>site_name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_always_accessible_sites</span><span class=p>(</span><span class=n>project_name</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>site_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>attached_sites</span><span class=p>:</span>
                <span class=n>attached_sites</span><span class=p>[</span><span class=n>site_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>create_metadata</span><span class=p>(</span><span class=n>site_name</span><span class=p>,</span> <span class=n>created</span><span class=o>=</span><span class=kc>False</span><span class=p>))</span>
        <span class=n>unique_sites</span> <span class=o>=</span> <span class=p>{</span>
            <span class=n>site</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]:</span> <span class=n>site</span>
            <span class=k>for</span> <span class=n>site</span> <span class=ow>in</span> <span class=n>attached_sites</span><span class=o>.</span><span class=n>values</span><span class=p>()</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>unique_sites</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_always_accessible_sites</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Sites that synced to as a part of background process.</span>

<span class=sd>        Artist machine doesn&#39;t handle those, explicit Tray with that site name</span>
<span class=sd>        as a local id must be running.</span>
<span class=sd>        Example is dropbox site serving as a backup solution</span>

<span class=sd>        Returns:</span>
<span class=sd>            (list[str]): list of site names</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>sync_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=n>always_accessible_sites</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>sync_settings</span><span class=p>[</span><span class=s2>&quot;config&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;always_accessible_on&quot;</span><span class=p>,</span> <span class=p>[])</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=p>[</span><span class=n>site_name</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>site_name</span> <span class=ow>in</span> <span class=n>always_accessible_sites</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_add_alternative_sites</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>attached_sites</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Add skeleton document for alternative sites</span>

<span class=sd>        Each new configured site in System Setting could serve as a alternative</span>
<span class=sd>        site, it&#39;s a kind of alias. It means that files on &#39;a site&#39; are</span>
<span class=sd>        physically accessible also on &#39;a alternative&#39; site.</span>
<span class=sd>        Example is sftp site serving studio files via sftp protocol, physically</span>
<span class=sd>        file is only in studio, sftp server has this location mounted.</span>

<span class=sd>        Returns:</span>
<span class=sd>            (dict[str, dict])</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>sync_project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=n>all_sites</span> <span class=o>=</span> <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;sites&quot;</span><span class=p>]</span>

        <span class=n>alt_site_pairs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_alt_site_pairs</span><span class=p>(</span><span class=n>all_sites</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>site_name</span> <span class=ow>in</span> <span class=n>all_sites</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
            <span class=c1># Get alternate sites (stripped names) for this site name</span>
            <span class=n>alt_sites</span> <span class=o>=</span> <span class=p>{</span>
                <span class=n>site</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
                <span class=k>for</span> <span class=n>site</span> <span class=ow>in</span> <span class=n>alt_site_pairs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>
            <span class=p>}</span>

            <span class=c1># If no alternative sites we don&#39;t need to add</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>alt_sites</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=c1># Take a copy of data of the first alternate site that is already</span>
            <span class=c1># defined as an attached site to match the same state.</span>
            <span class=n>match_meta</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
                <span class=p>(</span>
                    <span class=n>attached_sites</span><span class=p>[</span><span class=n>site</span><span class=p>]</span>
                    <span class=k>for</span> <span class=n>site</span> <span class=ow>in</span> <span class=n>alt_sites</span>
                    <span class=k>if</span> <span class=n>site</span> <span class=ow>in</span> <span class=n>attached_sites</span>
                <span class=p>),</span>
                <span class=kc>None</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>match_meta</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=n>alt_site_meta</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>match_meta</span><span class=p>)</span>
            <span class=n>alt_site_meta</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>site_name</span>

            <span class=c1># Note: We change mutable `attached_site` dict in-place</span>
            <span class=n>attached_sites</span><span class=p>[</span><span class=n>site_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>alt_site_meta</span>

        <span class=k>return</span> <span class=n>attached_sites</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_alt_site_pairs</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>conf_sites</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns dict of site and its alternative sites.</span>

<span class=sd>        If `site` has alternative site, it means that alt_site has &#39;site&#39; as</span>
<span class=sd>        alternative site</span>

<span class=sd>        Args:</span>
<span class=sd>            conf_sites (dict)</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict[str, list[str]]: {&#39;site&#39;: [alternative sites]...}</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>alt_site_pairs</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>set</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>site_info</span> <span class=ow>in</span> <span class=n>conf_sites</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>alt_sites</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>site_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;alternative_sites&quot;</span><span class=p>,</span> <span class=p>[]))</span>
            <span class=n>alt_site_pairs</span><span class=p>[</span><span class=n>site_name</span><span class=p>]</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>alt_sites</span><span class=p>)</span>

            <span class=k>for</span> <span class=n>alt_site</span> <span class=ow>in</span> <span class=n>alt_sites</span><span class=p>:</span>
                <span class=n>alt_site_pairs</span><span class=p>[</span><span class=n>alt_site</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>alt_sites</span> <span class=ow>in</span> <span class=n>alt_site_pairs</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>sites_queue</span> <span class=o>=</span> <span class=n>deque</span><span class=p>(</span><span class=n>alt_sites</span><span class=p>)</span>
            <span class=k>while</span> <span class=n>sites_queue</span><span class=p>:</span>
                <span class=n>alt_site</span> <span class=o>=</span> <span class=n>sites_queue</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>

                <span class=c1># safety against wrong config</span>
                <span class=c1># {&quot;SFTP&quot;: {&quot;alternative_site&quot;: &quot;SFTP&quot;}</span>
                <span class=k>if</span> <span class=n>alt_site</span> <span class=o>==</span> <span class=n>site_name</span> <span class=ow>or</span> <span class=n>alt_site</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>alt_site_pairs</span><span class=p>:</span>
                    <span class=k>continue</span>

                <span class=k>for</span> <span class=n>alt_alt_site</span> <span class=ow>in</span> <span class=n>alt_site_pairs</span><span class=p>[</span><span class=n>alt_site</span><span class=p>]:</span>
                    <span class=k>if</span> <span class=p>(</span>
                        <span class=n>alt_alt_site</span> <span class=o>!=</span> <span class=n>site_name</span>
                        <span class=ow>and</span> <span class=n>alt_alt_site</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>alt_sites</span>
                    <span class=p>):</span>
                        <span class=n>alt_sites</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>alt_alt_site</span><span class=p>)</span>
                        <span class=n>sites_queue</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>alt_alt_site</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>alt_site_pairs</span>

    <span class=k>def</span><span class=w> </span><span class=nf>clear_project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Clear &#39;project_name&#39; of &#39;site_name&#39; and its local files</span>

<span class=sd>            Works only on real local sites, not on &#39;studio&#39;</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=c1># TODO implement</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Method &#39;clear_project&#39; is not implemented.&quot;</span><span class=p>)</span>

        <span class=c1># query = {</span>
        <span class=c1>#     &quot;type&quot;: &quot;representation&quot;,</span>
        <span class=c1>#     &quot;files.sites.name&quot;: site_name</span>
        <span class=c1># }</span>
        <span class=c1>#</span>
        <span class=c1># # TODO currently not possible to replace with get_representations</span>
        <span class=c1># representations = list(</span>
        <span class=c1>#     self.connection.database[project_name].find(query))</span>
        <span class=c1># if not representations:</span>
        <span class=c1>#     self.log.debug(&quot;No repre found&quot;)</span>
        <span class=c1>#     return</span>
        <span class=c1>#</span>
        <span class=c1># for repre in representations:</span>
        <span class=c1>#     self.remove_site(project_name, repre.get(&quot;_id&quot;), site_name, True)</span>

    <span class=c1># TODO hook to some trigger - no Sync Queue anymore</span>
    <span class=k>def</span><span class=w> </span><span class=nf>validate_project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>reset_missing</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Validate &#39;project_name&#39; of &#39;site_name&#39; and its local files</span>

<span class=sd>        If file present and not marked with a &#39;site_name&#39; in DB, DB is</span>
<span class=sd>        updated with site name and file modified date.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): project name</span>
<span class=sd>            site_name (str): active site name</span>
<span class=sd>            reset_missing (bool): if True reset site in DB if missing</span>
<span class=sd>                physically to be resynched</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Validation of </span><span class=si>{}</span><span class=s2> for </span><span class=si>{}</span><span class=s2> started&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span>
        <span class=p>))</span>
        <span class=n>repre_entities</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>get_representations</span><span class=p>(</span><span class=n>project_name</span><span class=p>))</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>repre_entities</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;No repre found&quot;</span><span class=p>)</span>
            <span class=k>return</span>

        <span class=n>sites_added</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>sites_reset</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>repre_ids</span> <span class=o>=</span> <span class=p>[</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>repre</span> <span class=ow>in</span> <span class=n>repre_entities</span><span class=p>]</span>
        <span class=n>repre_states</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_representations_sync_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>repre_ids</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>repre_entity</span> <span class=ow>in</span> <span class=n>repre_entities</span><span class=p>:</span>
            <span class=n>repre_id</span> <span class=o>=</span> <span class=n>repre_entity</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>
            <span class=n>is_on_site</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=n>repre_state</span> <span class=o>=</span> <span class=n>repre_states</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>repre_id</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>repre_state</span><span class=p>:</span>
                <span class=n>is_on_site</span> <span class=o>=</span> <span class=n>repre_state</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
            <span class=k>for</span> <span class=n>repre_file</span> <span class=ow>in</span> <span class=n>repre_entity</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[]):</span>
                <span class=n>file_path</span> <span class=o>=</span> <span class=n>repre_file</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
                <span class=n>local_file_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_local_file_path</span><span class=p>(</span>
                    <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>file_path</span>
                <span class=p>)</span>

                <span class=n>file_exists</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>local_file_path</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>local_file_path</span><span class=p>)</span>
                <span class=p>)</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>is_on_site</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>file_exists</span><span class=p>:</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                            <span class=sa>f</span><span class=s2>&quot;Adding presence on site &#39;</span><span class=si>{</span><span class=n>site_name</span><span class=si>}</span><span class=s2>&#39; for &quot;</span>
                            <span class=sa>f</span><span class=s2>&quot;&#39;</span><span class=si>{</span><span class=n>repre_id</span><span class=si>}</span><span class=s2>&#39;&quot;</span>
                        <span class=p>)</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>add_site</span><span class=p>(</span>
                            <span class=n>project_name</span><span class=p>,</span>
                            <span class=n>repre_id</span><span class=p>,</span>
                            <span class=n>site_name</span><span class=o>=</span><span class=n>site_name</span><span class=p>,</span>
                            <span class=n>file_id</span><span class=o>=</span><span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                            <span class=n>force</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                            <span class=n>status</span><span class=o>=</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
                        <span class=p>)</span>
                        <span class=n>sites_added</span> <span class=o>+=</span> <span class=mi>1</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=k>if</span> <span class=ow>not</span> <span class=n>file_exists</span> <span class=ow>and</span> <span class=n>reset_missing</span><span class=p>:</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                            <span class=s2>&quot;Resetting site </span><span class=si>{}</span><span class=s2> for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                                <span class=n>site_name</span><span class=p>,</span> <span class=n>repre_id</span>
                            <span class=p>))</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>reset_site_on_representation</span><span class=p>(</span>
                            <span class=n>project_name</span><span class=p>,</span>
                            <span class=n>repre_id</span><span class=p>,</span>
                            <span class=n>site_name</span><span class=o>=</span><span class=n>site_name</span><span class=p>,</span>
                            <span class=n>file_id</span><span class=o>=</span><span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;_id&quot;</span><span class=p>]</span>
                        <span class=p>)</span>
                        <span class=n>sites_reset</span> <span class=o>+=</span> <span class=mi>1</span>

        <span class=k>if</span> <span class=n>sites_added</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Sites added </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>sites_added</span><span class=p>))</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Validation of </span><span class=si>{}</span><span class=s2> for </span><span class=si>{}</span><span class=s2> ended&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span>
        <span class=p>))</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Sites added </span><span class=si>{}</span><span class=s2>, sites reset </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>sites_added</span><span class=p>,</span> <span class=n>reset_missing</span>
        <span class=p>))</span>

    <span class=c1># TODO hook to some trigger - no Sync Queue anymore</span>
    <span class=k>def</span><span class=w> </span><span class=nf>pause_representation</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Pause sync of representation entity on site.</span>

<span class=sd>        Sets &#39;representation_id&#39; as paused, eg. no syncing should be</span>
<span class=sd>            happening on it.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>
<span class=sd>            representation_id (str): Representation id.</span>
<span class=sd>            site_name (str): Site name &#39;gdrive&#39;, &#39;studio&#39; etc.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Pausing SiteSync for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>representation_id</span><span class=p>))</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_paused_representations</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>representation_id</span><span class=p>)</span>
        <span class=n>repre_entity</span> <span class=o>=</span> <span class=n>get_representation_by_id</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>update_db</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>repre_entity</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>pause</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=c1># TODO hook to some trigger - no Sync Queue anymore</span>
    <span class=k>def</span><span class=w> </span><span class=nf>unpause_representation</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Unpause sync of representation entity on site.</span>

<span class=sd>        Does not fail or warn if repre wasn&#39;t paused.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>
<span class=sd>            representation_id (str): Representation id.</span>
<span class=sd>            site_name (str): Site name &#39;gdrive&#39;, &#39;studio&#39; etc.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Unpausing SiteSync for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>representation_id</span><span class=p>))</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_paused_representations</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>representation_id</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
            <span class=k>pass</span>
        <span class=c1># self.paused_representations is not persistent</span>
        <span class=n>repre_entity</span> <span class=o>=</span> <span class=n>get_representation_by_id</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>update_db</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>repre_entity</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>pause</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>is_representation_paused</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>check_parents</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>project_name</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Is representation paused.</span>

<span class=sd>        Args:</span>
<span class=sd>            representation_id (str): Representation id.</span>
<span class=sd>            check_parents (bool): Check if parent project or server itself</span>
<span class=sd>                are not paused.</span>
<span class=sd>            project_name (str): Project to check if paused.</span>

<span class=sd>            if &#39;check_parents&#39;, &#39;project_name&#39; should be set too</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: Is representation paused now.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>is_paused</span> <span class=o>=</span> <span class=n>representation_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_paused_representations</span>
        <span class=k>if</span> <span class=n>check_parents</span> <span class=ow>and</span> <span class=n>project_name</span><span class=p>:</span>
            <span class=n>is_paused</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>is_paused</span>
                <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_project_paused</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
                <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_paused</span><span class=p>()</span>
            <span class=p>)</span>
        <span class=k>return</span> <span class=n>is_paused</span>

    <span class=c1># TODO hook to some trigger - no Sync Queue anymore</span>
    <span class=k>def</span><span class=w> </span><span class=nf>pause_project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Pause sync of whole project.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Pausing SiteSync for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>project_name</span><span class=p>))</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_paused_projects</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=c1># TODO hook to some trigger - no Sync Queue anymore</span>
    <span class=k>def</span><span class=w> </span><span class=nf>unpause_project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Unpause sync of whole project.</span>

<span class=sd>        Does not fail or warn if project wasn&#39;t paused.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Unpausing SiteSync for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>project_name</span><span class=p>))</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_paused_projects</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
            <span class=k>pass</span>

    <span class=k>def</span><span class=w> </span><span class=nf>is_project_paused</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>check_parents</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Is project sync paused.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str):</span>
<span class=sd>            check_parents (bool): check if server itself</span>
<span class=sd>                is not paused</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: Is project paused.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>is_paused</span> <span class=o>=</span> <span class=n>project_name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_paused_projects</span>
        <span class=k>if</span> <span class=n>check_parents</span><span class=p>:</span>
            <span class=n>is_paused</span> <span class=o>=</span> <span class=n>is_paused</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_paused</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>is_paused</span>

    <span class=c1># TODO hook to some trigger - no Sync Queue anymore</span>
    <span class=k>def</span><span class=w> </span><span class=nf>pause_server</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Pause sync server.</span>

<span class=sd>        It won&#39;t check anything, not uploading/downloading...</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Pausing SiteSync&quot;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_paused</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>def</span><span class=w> </span><span class=nf>unpause_server</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Unpause server sync.&quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Unpausing SiteSync&quot;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_paused</span> <span class=o>=</span> <span class=kc>False</span>

    <span class=k>def</span><span class=w> </span><span class=nf>is_paused</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot; Is server paused &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_paused</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_active_site_type</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>local_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Active site which is defined by artist.</span>

<span class=sd>        Unlike &#39;get_active_site&#39; is this method also checking local settings</span>
<span class=sd>        where might be different active site set by user. The output is limited</span>
<span class=sd>        to &quot;studio&quot; and &quot;local&quot;.</span>

<span class=sd>        This method is used by Anatomy.</span>

<span class=sd>        Todos:</span>
<span class=sd>            Check if sync server is enabled for the project.</span>
<span class=sd>            - To be able to do that the sync settings MUST NOT be cached for</span>
<span class=sd>                all projects at once. The sync settings preparation for all</span>
<span class=sd>                projects is reasonable only in sync server loop.</span>
<span class=sd>            `local_settings` is probably obsolete in AYON</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Name of project where to look for active site.</span>
<span class=sd>            local_settings (Optional[dict[str, Any]]): Prepared local settings.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Literal[&quot;studio&quot;, &quot;local&quot;]: Active site.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
            <span class=k>return</span> <span class=s2>&quot;studio&quot;</span>

        <span class=n>sync_project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]:</span>
            <span class=k>return</span> <span class=s2>&quot;studio&quot;</span>

        <span class=k>return</span> <span class=p>(</span>
            <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;local_setting&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;active_site&quot;</span><span class=p>)</span>
            <span class=ow>or</span> <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;config&quot;</span><span class=p>][</span><span class=s2>&quot;active_site&quot;</span><span class=p>]</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_active_site</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns active (mine) site for project from settings.</span>

<span class=sd>        Output logic:</span>
<span class=sd>            - &#39;studio&#39; if Site Sync is disabled</span>
<span class=sd>            - value from &#39;get_local_site_id&#39; if active site is &#39;local&#39;</span>
<span class=sd>            - any other site name from local settings</span>
<span class=sd>                or project settings (site could be forced from PS)</span>

<span class=sd>        Returns:</span>
<span class=sd>            str: Site name.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>active_site_type</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_active_site_type</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>active_site_type</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>LOCAL_SITE</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>get_local_site_id</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>active_site_type</span>

    <span class=c1># remote site</span>
    <span class=k>def</span><span class=w> </span><span class=nf>get_remote_site</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Remote (theirs) site for project from settings.&quot;&quot;&quot;</span>
        <span class=n>sync_project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=n>remote_site</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;local_setting&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;remote_site&quot;</span><span class=p>)</span>
            <span class=ow>or</span> <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;config&quot;</span><span class=p>][</span><span class=s2>&quot;remote_site&quot;</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>remote_site</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>LOCAL_SITE</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>get_local_site_id</span><span class=p>()</span>

        <span class=k>return</span> <span class=n>remote_site</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_site_root_overrides</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>local_settings</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get root overrides for project on a site.</span>

<span class=sd>        Implemented to be used in &#39;Anatomy&#39; for other than &#39;studio&#39; site.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project for which root overrides should be</span>
<span class=sd>                received.</span>
<span class=sd>            site_name (str): Name of site for which should be received roots.</span>
<span class=sd>            local_settings (Optional[dict[str, Any]]): Prepare local settigns</span>
<span class=sd>                values.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Union[dict[str, Any], None]: Root overrides for this machine.</span>

<span class=sd>            {&quot;work&quot;: &quot;c:/projects_local&quot;}</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=c1># Validate that site name is valid</span>
        <span class=k>if</span> <span class=n>site_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&quot;studio&quot;</span><span class=p>,</span> <span class=s2>&quot;local&quot;</span><span class=p>):</span>
            <span class=c1># Consider local site id as &#39;local&#39;</span>
            <span class=k>if</span> <span class=n>site_name</span> <span class=o>!=</span> <span class=n>get_local_site_id</span><span class=p>():</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>((</span>
                    <span class=s2>&quot;Root overrides are available only for&quot;</span>
                    <span class=s2>&quot; default sites not for </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>site_name</span><span class=p>))</span>
            <span class=n>site_name</span> <span class=o>=</span> <span class=s2>&quot;local&quot;</span>

        <span class=n>sitesync_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

        <span class=n>roots</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>sitesync_settings</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]:</span>
            <span class=k>return</span> <span class=n>roots</span>
        <span class=n>local_project_settings</span> <span class=o>=</span> <span class=n>sitesync_settings</span><span class=p>[</span><span class=s2>&quot;local_setting&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>site_name</span> <span class=o>==</span> <span class=s2>&quot;local&quot;</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>root_info</span> <span class=ow>in</span> <span class=n>local_project_settings</span><span class=p>[</span><span class=s2>&quot;local_roots&quot;</span><span class=p>]:</span>
                <span class=n>roots</span><span class=p>[</span><span class=n>root_info</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>root_info</span><span class=p>[</span><span class=s2>&quot;path&quot;</span><span class=p>]</span>

        <span class=k>return</span> <span class=n>roots</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_local_normalized_site</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>site_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Normlize local site name.</span>

<span class=sd>         Return &#39;local&#39; if &#39;site_name&#39; is local id.</span>

<span class=sd>        In some places Settings or Local Settings require &#39;local&#39; instead</span>
<span class=sd>        of real site name.</span>

<span class=sd>        Returns:</span>
<span class=sd>            str: Normalized site name.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>site_name</span> <span class=o>==</span> <span class=n>get_local_site_id</span><span class=p>():</span>
            <span class=n>site_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>LOCAL_SITE</span>

        <span class=k>return</span> <span class=n>site_name</span>

    <span class=k>def</span><span class=w> </span><span class=nf>is_representation_on_site</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>max_retries</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Check if representation has all files available on site.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str)</span>
<span class=sd>            representation_id (str)</span>
<span class=sd>            site_name (str)</span>
<span class=sd>            max_retries (int) (optional) - provide only if method used in while</span>
<span class=sd>                loop to bail out</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: True if representation has all files correctly on the site.</span>

<span class=sd>        Raises:</span>
<span class=sd>              ValueError  Only If &#39;max_retries&#39; provided if upload/download</span>
<span class=sd>                failed too many times to limit infinite loop check.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>representation_status</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_repre_sync_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>representation_status</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>False</span>

        <span class=k>if</span> <span class=n>site_name</span> <span class=o>==</span> <span class=n>get_local_site_id</span><span class=p>():</span>
            <span class=n>status</span> <span class=o>=</span> <span class=n>representation_status</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>]</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>status</span> <span class=o>=</span> <span class=n>representation_status</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>]</span>

        <span class=k>if</span> <span class=n>max_retries</span><span class=p>:</span>
            <span class=n>tries</span> <span class=o>=</span> <span class=n>status</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;retries&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>tries</span> <span class=o>&gt;=</span> <span class=n>max_retries</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Failed too many times&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>status</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_reset_timer_with_rest_api</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># POST to webserver sites to add to representations</span>
        <span class=n>webserver_url</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;AYON_WEBSERVER_URL&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>webserver_url</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Couldn&#39;t find webserver url&quot;</span><span class=p>)</span>
            <span class=k>return</span>

        <span class=n>rest_api_url</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/sitesync/reset_timer&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>webserver_url</span>
        <span class=p>)</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=s2>&quot;Couldn&#39;t add sites to representations &quot;</span>
                <span class=s2>&quot;(&#39;requests&#39; is not available)&quot;</span>
            <span class=p>)</span>
            <span class=k>return</span>

        <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>rest_api_url</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_enabled_projects</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns list of projects which have SiteSync enabled.&quot;&quot;&quot;</span>
        <span class=n>enabled_projects</span> <span class=o>=</span> <span class=p>[]</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>project_name</span> <span class=ow>in</span> <span class=n>get_project_names</span><span class=p>():</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_project_enabled</span><span class=p>(</span><span class=n>project_name</span><span class=p>):</span>
                    <span class=n>enabled_projects</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>enabled_projects</span>

    <span class=k>def</span><span class=w> </span><span class=nf>is_project_enabled</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>single</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Checks if &#39;project_name&#39; is enabled for syncing.</span>
<span class=sd>        &#39;get_sync_project_setting&#39; is potentially expensive operation (pulls</span>
<span class=sd>        settings for all projects if cached version is not available), using</span>
<span class=sd>        project_settings for specific project should be faster.</span>
<span class=sd>        Args:</span>
<span class=sd>            project_name (str)</span>
<span class=sd>            single (bool): use &#39;get_addon_project_settings&#39; method</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>single</span><span class=p>:</span>
                <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_addon_project_settings</span><span class=p>(</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>version</span><span class=p>,</span> <span class=n>project_name</span>
                <span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>project_settings</span> <span class=ow>and</span> <span class=n>project_settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enabled&quot;</span><span class=p>):</span>
                <span class=k>return</span> <span class=kc>True</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=k>def</span><span class=w> </span><span class=nf>handle_alternate_site</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>processed_site</span><span class=p>,</span> <span class=n>file_id</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        For special use cases where one site vendors another.</span>

<span class=sd>        Current use case is sftp site vendoring (exposing) same data as</span>
<span class=sd>        regular site (studio). Each site is accessible for different</span>
<span class=sd>        audience. &#39;studio&#39; for artists in a studio, &#39;sftp&#39; for externals.</span>

<span class=sd>        Change of file status on one site actually means same change on</span>
<span class=sd>        &#39;alternate&#39; site. (eg. artists publish to &#39;studio&#39;, &#39;sftp&#39; is using</span>
<span class=sd>        same location &gt;&gt; file is accessible on &#39;sftp&#39; site right away.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>
<span class=sd>            representation_id (str): Representation id.</span>
<span class=sd>            processed_site (str): Real site_name of published/uploaded file</span>
<span class=sd>            file_id (str): File id of file handled.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>sites</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_transform_sites_from_settings</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>sync_studio_settings</span><span class=p>)</span>
        <span class=n>sites</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>DEFAULT_SITE</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;provider&quot;</span><span class=p>:</span> <span class=s2>&quot;local_drive&quot;</span><span class=p>,</span>
            <span class=s2>&quot;alternative_sites&quot;</span><span class=p>:</span> <span class=p>[]</span>
        <span class=p>}</span>

        <span class=n>alternate_sites</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>site_info</span> <span class=ow>in</span> <span class=n>sites</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>conf_alternative_sites</span> <span class=o>=</span> <span class=n>site_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;alternative_sites&quot;</span><span class=p>,</span> <span class=p>[])</span>
            <span class=k>if</span> <span class=n>processed_site</span> <span class=ow>in</span> <span class=n>conf_alternative_sites</span><span class=p>:</span>
                <span class=n>alternate_sites</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>
                <span class=k>continue</span>
            <span class=k>if</span> <span class=n>processed_site</span> <span class=o>==</span> <span class=n>site_name</span> <span class=ow>and</span> <span class=n>conf_alternative_sites</span><span class=p>:</span>
                <span class=n>alternate_sites</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>conf_alternative_sites</span><span class=p>)</span>
                <span class=k>continue</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>alternate_sites</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>sync_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_repre_sync_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>representation_id</span><span class=p>,</span>
            <span class=n>processed_site</span>
        <span class=p>)</span>
        <span class=c1># not yet available on processed_site, wont update alternate site yet</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>sync_state</span><span class=p>:</span>
            <span class=k>return</span>
        <span class=k>for</span> <span class=n>file_info</span> <span class=ow>in</span> <span class=n>sync_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]:</span>
            <span class=c1># expose status of remote site, it is expected on the server</span>
            <span class=n>file_info</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>file_info</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>

        <span class=n>payload_dict</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;files&quot;</span><span class=p>:</span> <span class=n>sync_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]}</span>

        <span class=n>alternate_sites</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>alternate_sites</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>alt_site</span> <span class=ow>in</span> <span class=n>alternate_sites</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Adding alternate </span><span class=si>{}</span><span class=s2> to </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>alt_site</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>))</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>_set_state_sync_state</span><span class=p>(</span>
                <span class=n>project_name</span><span class=p>,</span>
                <span class=n>representation_id</span><span class=p>,</span>
                <span class=n>alt_site</span><span class=p>,</span>
                <span class=n>payload_dict</span>
            <span class=p>)</span>

    <span class=c1># TODO - for Loaders</span>
    <span class=k>def</span><span class=w> </span><span class=nf>get_repre_info_for_versions</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>version_ids</span><span class=p>,</span> <span class=n>active_site</span><span class=p>,</span> <span class=n>remote_site</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns representation for versions and sites combi</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name</span>
<span class=sd>            version_ids (Iterable[str]): Version ids.</span>
<span class=sd>            active_site (str): &#39;local&#39;, &#39;studio&#39; etc</span>
<span class=sd>            remote_site (str): dtto</span>

<span class=sd>        Returns:</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>version_ids</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>version_ids</span><span class=p>)</span>
        <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/projects/</span><span class=si>{}</span><span class=s2>/sitesync/state&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span>
        <span class=p>)</span>

        <span class=c1># get to upload</span>
        <span class=n>kwargs</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;localSite&quot;</span><span class=p>:</span> <span class=n>active_site</span><span class=p>,</span>
            <span class=s2>&quot;remoteSite&quot;</span><span class=p>:</span> <span class=n>remote_site</span><span class=p>,</span>
            <span class=s2>&quot;versionIdFilter&quot;</span><span class=p>:</span> <span class=nb>list</span><span class=p>(</span><span class=n>version_ids</span><span class=p>)</span>
        <span class=p>}</span>

        <span class=c1># kwargs[&quot;representationId&quot;] = &quot;94dca33a-7705-11ed-8c0a-34e12d91d510&quot;</span>

        <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=n>repre_states</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;representations&quot;</span><span class=p>,</span> <span class=p>[])</span>
        <span class=n>repre_info_by_version_id</span> <span class=o>=</span> <span class=p>{</span>
            <span class=n>version_id</span><span class=p>:</span> <span class=p>{</span>
                <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>version_id</span><span class=p>,</span>
                <span class=s2>&quot;repre_count&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
                <span class=s2>&quot;avail_repre_local&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
                <span class=s2>&quot;avail_repre_remote&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
            <span class=p>}</span>
            <span class=k>for</span> <span class=n>version_id</span> <span class=ow>in</span> <span class=n>version_ids</span>
        <span class=p>}</span>
        <span class=n>repre_states_by_version_id</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>repre_state</span> <span class=ow>in</span> <span class=n>repre_states</span><span class=p>:</span>
            <span class=n>version_id</span> <span class=o>=</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;versionId&quot;</span><span class=p>]</span>
            <span class=n>repre_states_by_version_id</span><span class=p>[</span><span class=n>version_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>repre_state</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>version_id</span><span class=p>,</span> <span class=n>repre_states</span> <span class=ow>in</span> <span class=n>repre_states_by_version_id</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>repre_info</span> <span class=o>=</span> <span class=n>repre_info_by_version_id</span><span class=p>[</span><span class=n>version_id</span><span class=p>]</span>
            <span class=n>repre_info</span><span class=p>[</span><span class=s2>&quot;repre_count&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>repre_states</span><span class=p>)</span>
            <span class=n>repre_info</span><span class=p>[</span><span class=s2>&quot;avail_repre_local&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_is_available</span><span class=p>(</span><span class=n>repre_state</span><span class=p>,</span> <span class=s2>&quot;localStatus&quot;</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>repre_state</span> <span class=ow>in</span> <span class=n>repre_states</span>
            <span class=p>)</span>
            <span class=n>repre_info</span><span class=p>[</span><span class=s2>&quot;avail_repre_remote&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_is_available</span><span class=p>(</span><span class=n>repre_state</span><span class=p>,</span> <span class=s2>&quot;remoteStatus&quot;</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>repre_state</span> <span class=ow>in</span> <span class=n>repre_states</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>repre_info_by_version_id</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
    <span class=c1># --- End of Public API ---</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_is_available</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>repre</span><span class=p>,</span> <span class=n>status</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Helper to decide if repre is download/uploaded on site.</span>

<span class=sd>        Returns:</span>
<span class=sd>            int: 1 if available, 0 if not.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>repre</span><span class=p>[</span><span class=n>status</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_local_file_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>file_path</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Externalized for app.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>
<span class=sd>            site_name (str): Site name.</span>
<span class=sd>            file_path (str): File path from other site.</span>

<span class=sd>        Returns:</span>
<span class=sd>            str: Resolved local path.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>handler</span> <span class=o>=</span> <span class=n>LocalDriveHandler</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span>
        <span class=n>local_file_path</span> <span class=o>=</span> <span class=n>handler</span><span class=o>.</span><span class=n>resolve_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>local_file_path</span>

    <span class=k>def</span><span class=w> </span><span class=nf>tray_init</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Initialization of Site Sync Server for Tray.</span>

<span class=sd>        Called when tray is initialized, it checks if addon should be</span>
<span class=sd>        enabled. If not, no initialization necessary.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>server_init</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>server_init</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Actual initialization of Sync Server.&quot;&quot;&quot;</span>
        <span class=c1># import only in tray or Python3, because of Python2 hosts</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=kn>from</span><span class=w> </span><span class=nn>.sitesync</span><span class=w> </span><span class=kn>import</span> <span class=n>SiteSyncThread</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span> <span class=o>=</span> <span class=n>SiteSyncThread</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>tray_start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Triggered when Tray is started.</span>

<span class=sd>        Checks if configuration presets are available and if there is</span>
<span class=sd>        any provider (&#39;gdrive&#39;, &#39;S3&#39;) that is activated</span>
<span class=sd>        (eg. has valid credentials).</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>server_start</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>server_start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
                <span class=s2>&quot;SiteSync is not enabled. Site Sync server was not started.&quot;</span>
            <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>tray_exit</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Stops sync thread if running.</span>

<span class=sd>        Called from Addon Manager</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>server_exit</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>server_exit</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span><span class=p>:</span>
            <span class=k>return</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Stopping sync server server&quot;</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span><span class=o>.</span><span class=n>is_running</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Sync server stopped&quot;</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=s2>&quot;Error has happened during Killing sync server&quot;</span><span class=p>,</span>
                <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>tray_menu</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>parent_menu</span><span class=p>):</span>
        <span class=k>pass</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>is_running</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span><span class=o>.</span><span class=n>is_running</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_anatomy</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get already created or newly created anatomy for project</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>

<span class=sd>        Return:</span>
<span class=sd>            Anatomy: Project anatomy object.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>ayon_core.pipeline</span><span class=w> </span><span class=kn>import</span> <span class=n>Anatomy</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_anatomies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span> <span class=ow>or</span> <span class=n>Anatomy</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>sync_studio_settings</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_sync_studio_settings</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_sync_studio_settings</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>get_studio_settings</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_sync_studio_settings</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>sync_project_settings</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_sync_project_settings</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>set_sync_project_settings</span><span class=p>()</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_sync_project_settings</span>

    <span class=k>def</span><span class=w> </span><span class=nf>set_sync_project_settings</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exclude_locals</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Set sync_project_settings for all projects (caching)</span>
<span class=sd>            Args:</span>
<span class=sd>                exclude_locals (bool): ignore overrides from Local Settings</span>
<span class=sd>            For performance</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>sync_project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_sync_project_settings</span><span class=p>(</span>
            <span class=n>exclude_locals</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_sync_project_settings</span> <span class=o>=</span> <span class=n>sync_project_settings</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_prepare_sync_project_settings</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exclude_locals</span><span class=p>):</span>
        <span class=n>sync_project_settings</span> <span class=o>=</span> <span class=p>{}</span>

        <span class=n>sites</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_transform_sites_from_settings</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sync_studio_settings</span><span class=p>)</span>

        <span class=n>project_names</span> <span class=o>=</span> <span class=n>get_project_names</span><span class=p>()</span>
        <span class=k>for</span> <span class=n>project_name</span> <span class=ow>in</span> <span class=n>project_names</span><span class=p>:</span>
            <span class=n>project_sites</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>sites</span><span class=p>)</span>
            <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_addon_project_settings</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>version</span><span class=p>,</span> <span class=n>project_name</span><span class=p>)</span>

            <span class=n>project_sites</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_get_default_site_configs</span><span class=p>(</span>
                <span class=n>project_settings</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>],</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>project_settings</span>
            <span class=p>))</span>

            <span class=n>project_sites</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_transform_sites_from_settings</span><span class=p>(</span><span class=n>project_settings</span><span class=p>))</span>

            <span class=n>project_settings</span><span class=p>[</span><span class=s2>&quot;sites&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>project_sites</span>

            <span class=n>sync_project_settings</span><span class=p>[</span><span class=n>project_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>project_settings</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>sync_project_settings</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;No enabled and configured projects for sync.&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>sync_project_settings</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_sync_project_setting</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>exclude_locals</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>cached</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot; Handles pulling sitesync&#39;s settings for enabled &#39;project_name&#39;</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): used in project settings</span>
<span class=sd>            exclude_locals (bool): ignore overrides from Local Settings</span>
<span class=sd>            cached (bool): use pre-cached values, or return fresh ones</span>
<span class=sd>                cached values needed for single loop (with all overrides)</span>
<span class=sd>                fresh values needed for Local settings (without overrides)</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict: settings dictionary for the enabled project,</span>
<span class=sd>                empty if no settings or sync is disabled</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># presets set already, do not call again and again</span>
        <span class=c1># self.log.debug(&quot;project preset {}&quot;.format(self.presets))</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>cached</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_sync_project_settings</span><span class=p>(</span><span class=n>exclude_locals</span><span class=p>)</span>\
                <span class=p>[</span><span class=n>project_name</span><span class=p>]</span>

        <span class=k>if</span> <span class=p>(</span>
            <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span>
            <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>set_sync_project_settings</span><span class=p>(</span><span class=n>exclude_locals</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_transform_sites_from_settings</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>settings</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Transforms list of &#39;sites&#39; from Setting to dict.</span>

<span class=sd>        It processes both System and Project Settings as they have same format.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>sites</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>sites</span>

        <span class=k>for</span> <span class=n>whole_site_info</span> <span class=ow>in</span> <span class=n>settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;sites&quot;</span><span class=p>,</span> <span class=p>[]):</span>
            <span class=n>site_name</span> <span class=o>=</span> <span class=n>whole_site_info</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
            <span class=n>provider_specific</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span>
                <span class=n>whole_site_info</span><span class=p>[</span><span class=n>whole_site_info</span><span class=p>[</span><span class=s2>&quot;provider&quot;</span><span class=p>]]</span>
            <span class=p>)</span>
            <span class=n>configured_site</span> <span class=o>=</span> <span class=p>{</span>
                <span class=s2>&quot;enabled&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
                <span class=s2>&quot;alternative_sites&quot;</span><span class=p>:</span> <span class=n>whole_site_info</span><span class=p>[</span><span class=s2>&quot;alternative_sites&quot;</span><span class=p>],</span>
                <span class=s2>&quot;root&quot;</span><span class=p>:</span> <span class=n>provider_specific</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;roots&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
            <span class=p>}</span>
            <span class=n>configured_site</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>provider_specific</span><span class=p>)</span>

            <span class=n>sites</span><span class=p>[</span><span class=n>site_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>configured_site</span>
        <span class=k>return</span> <span class=n>sites</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_project_root_overrides_by_site_id</span><span class=p>(</span>
            <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns projects roots and their overrides.&quot;&quot;&quot;</span>
        <span class=c1># overrides for Studio site for particular user</span>
        <span class=c1># TODO temporary to get roots without overrides</span>
        <span class=c1># ayon_api.get_project_roots_by_site returns only overrides.</span>
        <span class=c1># Should be replaced when ayon_api implements `siteRoots` method</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>site_name</span><span class=p>:</span>
            <span class=n>site_name</span> <span class=o>=</span> <span class=n>get_local_site_id</span><span class=p>()</span>
        <span class=n>platform_name</span> <span class=o>=</span> <span class=n>platform</span><span class=o>.</span><span class=n>system</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=n>roots</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;projects/</span><span class=si>{</span><span class=n>project_name</span><span class=si>}</span><span class=s2>/siteRoots&quot;</span><span class=p>,</span>
            <span class=n>platform</span><span class=o>=</span><span class=n>platform_name</span>
        <span class=p>)</span><span class=o>.</span><span class=n>data</span>
        <span class=n>root_overrides</span> <span class=o>=</span> <span class=n>get_project_root_overrides_by_site_id</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span>
        <span class=p>)</span>
        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>roots</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>override</span> <span class=o>=</span> <span class=n>root_overrides</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>override</span><span class=p>:</span>
                <span class=n>roots</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>override</span>

        <span class=k>return</span> <span class=n>roots</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_default_site_configs</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>sync_enabled</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>project_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>project_settings</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Settings for &#39;studio&#39; and user&#39;s local site</span>

<span class=sd>        Returns base values from setting, not overridden by Local Settings,</span>
<span class=sd>        eg. value used to push TO LS not to get actual value for syncing.</span>

<span class=sd>        Args:</span>
<span class=sd>            sync_enabled (Optional[bool]): Is sync enabled.</span>
<span class=sd>            project_name (Optional[str]): Project name.</span>
<span class=sd>            project_settings (Optional[dict]): Project settings.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>local_site_id</span> <span class=o>=</span> <span class=n>get_local_site_id</span><span class=p>()</span>
        <span class=n>roots</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_project_root_overrides_by_site_id</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>local_site_id</span>
        <span class=p>)</span>
        <span class=n>studio_config</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;enabled&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
            <span class=s2>&quot;provider&quot;</span><span class=p>:</span> <span class=s2>&quot;local_drive&quot;</span><span class=p>,</span>
            <span class=s2>&quot;root&quot;</span><span class=p>:</span> <span class=n>roots</span>
        <span class=p>}</span>
        <span class=n>all_sites</span> <span class=o>=</span> <span class=p>{</span><span class=bp>self</span><span class=o>.</span><span class=n>DEFAULT_SITE</span><span class=p>:</span> <span class=n>studio_config</span><span class=p>}</span>
        <span class=k>if</span> <span class=n>sync_enabled</span><span class=p>:</span>
            <span class=n>roots</span> <span class=o>=</span> <span class=n>project_settings</span><span class=p>[</span><span class=s2>&quot;local_setting&quot;</span><span class=p>][</span><span class=s2>&quot;local_roots&quot;</span><span class=p>]</span>
            <span class=n>local_site_dict</span> <span class=o>=</span> <span class=p>{</span>
                <span class=s2>&quot;enabled&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
                <span class=s2>&quot;provider&quot;</span><span class=p>:</span> <span class=s2>&quot;local_drive&quot;</span><span class=p>,</span>
                <span class=s2>&quot;root&quot;</span><span class=p>:</span> <span class=n>roots</span>
            <span class=p>}</span>
            <span class=n>all_sites</span><span class=p>[</span><span class=n>local_site_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>local_site_dict</span>
            <span class=c1># duplicate values for normalized local name</span>
            <span class=n>all_sites</span><span class=p>[</span><span class=s2>&quot;local&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>local_site_dict</span>
        <span class=k>return</span> <span class=n>all_sites</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_provider_for_site</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>site</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get provider name for site (unique name across all projects).&quot;&quot;&quot;</span>
        <span class=n>sites</span> <span class=o>=</span> <span class=p>{</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>DEFAULT_SITE</span><span class=p>:</span> <span class=s2>&quot;local_drive&quot;</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>LOCAL_SITE</span><span class=p>:</span> <span class=s2>&quot;local_drive&quot;</span><span class=p>,</span>
            <span class=n>get_local_site_id</span><span class=p>():</span> <span class=s2>&quot;local_drive&quot;</span>
        <span class=p>}</span>

        <span class=k>if</span> <span class=n>site</span> <span class=ow>in</span> <span class=n>sites</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
            <span class=k>return</span> <span class=n>sites</span><span class=p>[</span><span class=n>site</span><span class=p>]</span>

        <span class=c1># backward compatibility</span>
        <span class=k>if</span> <span class=n>project_name</span><span class=p>:</span>
            <span class=n>proj_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
            <span class=n>provider</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>proj_settings</span>
                <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;sites&quot;</span><span class=p>,</span> <span class=p>{})</span>
                <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>site</span><span class=p>,</span> <span class=p>{})</span>
                <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;provider&quot;</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=n>provider</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>provider</span>

        <span class=n>sync_sett</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_studio_settings</span>
        <span class=k>for</span> <span class=n>site_config</span> <span class=ow>in</span> <span class=n>sync_sett</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;sites&quot;</span><span class=p>):</span>
            <span class=n>sites</span><span class=p>[</span><span class=n>site_config</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>site_config</span><span class=p>[</span><span class=s2>&quot;provider&quot;</span><span class=p>]</span>

        <span class=k>return</span> <span class=n>sites</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>site</span><span class=p>,</span> <span class=s2>&quot;N/A&quot;</span><span class=p>)</span>

    <span class=nd>@time_function</span>
    <span class=k>def</span><span class=w> </span><span class=nf>get_sync_representations</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>active_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=mi>10</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Get representations that should be synced, these could be</span>
<span class=sd>            recognised by presence of document in &#39;files.sites&#39;, where key is</span>
<span class=sd>            a provider (GDrive, S3) and value is empty document or document</span>
<span class=sd>            without &#39;created_dt&#39; field. (Don&#39;t put null to &#39;created_dt&#39;!).</span>

<span class=sd>            Querying of &#39;to-be-synched&#39; files is offloaded to Mongod for</span>
<span class=sd>            better performance. Goal is to get as few representations as</span>
<span class=sd>            possible.</span>
<span class=sd>        Args:</span>
<span class=sd>            project_name (str):</span>
<span class=sd>            active_site (str): identifier of current active site (could be</span>
<span class=sd>                &#39;local_0&#39; when working from home, &#39;studio&#39; when working in the</span>
<span class=sd>                studio (default)</span>
<span class=sd>            remote_site (str): identifier of remote site I want to sync to</span>

<span class=sd>        Returns:</span>
<span class=sd>            list[dict]: Representation states.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Check representations for: </span><span class=si>{}</span><span class=s2>-</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>active_site</span><span class=p>,</span> <span class=n>remote_site</span>
        <span class=p>))</span>

        <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span>
        <span class=p>)</span>

        <span class=c1># get to upload</span>
        <span class=n>kwargs</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;localSite&quot;</span><span class=p>:</span> <span class=n>active_site</span><span class=p>,</span>
            <span class=s2>&quot;remoteSite&quot;</span><span class=p>:</span> <span class=n>remote_site</span><span class=p>,</span>
            <span class=s2>&quot;localStatusFilter&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>],</span>
            <span class=s2>&quot;remoteStatusFilter&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>QUEUED</span><span class=p>],</span>
        <span class=p>}</span>

        <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>200</span><span class=p>,</span> <span class=mi>204</span><span class=p>]:</span>
            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
                <span class=s2>&quot;Cannot get representations for sync with code </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>response</span><span class=o>.</span><span class=n>status_code</span>
                <span class=p>)</span>
            <span class=p>)</span>

        <span class=n>repre_states</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]</span>

        <span class=c1># get to download</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>repre_states</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>limit</span><span class=p>:</span>
            <span class=n>kwargs</span><span class=p>[</span><span class=s2>&quot;localStatusFilter&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>QUEUED</span><span class=p>]</span>
            <span class=n>kwargs</span><span class=p>[</span><span class=s2>&quot;remoteStatusFilter&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>]</span>

            <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
            <span class=n>repre_states</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>])</span>

        <span class=k>return</span> <span class=n>repre_states</span>

    <span class=k>def</span><span class=w> </span><span class=nf>check_status</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_state</span><span class=p>,</span> <span class=n>local_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>,</span> <span class=n>config_preset</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Check synchronization status of a file.</span>

<span class=sd>        The file is on representation status is checked for single &#39;provider&#39;.</span>
<span class=sd>            (Eg. check if &#39;scene.ma&#39; of lookdev.v10 should be synced to GDrive</span>

<span class=sd>        Always is comparing local record, eg. site with</span>
<span class=sd>            &#39;name&#39; == self.presets[PROJECT_NAME][&quot;config&quot;][&quot;active_site&quot;]</span>

<span class=sd>        This leads to trigger actual upload or download, there is</span>
<span class=sd>            a use case &#39;studio&#39; &lt;&gt; &#39;remote&#39; where user should publish</span>
<span class=sd>            to &#39;studio&#39;, see progress in Tray GUI, but do not do</span>
<span class=sd>            physical upload/download</span>
<span class=sd>            (as multiple user would be doing that).</span>

<span class=sd>            Do physical U/D only when any of the sites is user&#39;s local, in that</span>
<span class=sd>            case only user has the data and must U/D.</span>

<span class=sd>        Args:</span>
<span class=sd>            file_state (dict): File info from site sync database.</span>
<span class=sd>            local_site (str): Local site of compare (usually &#39;studio&#39;).</span>
<span class=sd>            remote_site (str): Remote site (gdrive etc).</span>
<span class=sd>            config_preset (dict): Config about active site, retries.</span>

<span class=sd>        Returns:</span>
<span class=sd>            int: Sync status value of representation.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>get_local_site_id</span><span class=p>()</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>(</span><span class=n>local_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>):</span>
            <span class=c1># don&#39;t do upload/download for studio sites</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                <span class=s2>&quot;No local site </span><span class=si>{}</span><span class=s2> - </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>local_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=n>SyncStatus</span><span class=o>.</span><span class=n>DO_NOTHING</span>

        <span class=n>local_status</span> <span class=o>=</span> <span class=n>file_state</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>
        <span class=n>remote_status</span> <span class=o>=</span> <span class=n>file_state</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>

        <span class=k>if</span> <span class=p>(</span>
            <span class=n>local_status</span> <span class=o>!=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
            <span class=ow>and</span> <span class=n>remote_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
        <span class=p>):</span>
            <span class=n>retries</span> <span class=o>=</span> <span class=n>file_state</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;retries&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>retries</span> <span class=o>&lt;</span> <span class=nb>int</span><span class=p>(</span><span class=n>config_preset</span><span class=p>[</span><span class=s2>&quot;retry_cnt&quot;</span><span class=p>]):</span>
                <span class=k>return</span> <span class=n>SyncStatus</span><span class=o>.</span><span class=n>DO_DOWNLOAD</span>

        <span class=k>if</span> <span class=p>(</span>
            <span class=n>remote_status</span> <span class=o>!=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
            <span class=ow>and</span> <span class=n>local_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
        <span class=p>):</span>
            <span class=n>retries</span> <span class=o>=</span> <span class=n>file_state</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;retries&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>retries</span> <span class=o>&lt;</span> <span class=nb>int</span><span class=p>(</span><span class=n>config_preset</span><span class=p>[</span><span class=s2>&quot;retry_cnt&quot;</span><span class=p>]):</span>
                <span class=k>return</span> <span class=n>SyncStatus</span><span class=o>.</span><span class=n>DO_UPLOAD</span>

        <span class=k>return</span> <span class=n>SyncStatus</span><span class=o>.</span><span class=n>DO_NOTHING</span>

    <span class=k>def</span><span class=w> </span><span class=nf>update_db</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>repre_status</span><span class=p>,</span>
        <span class=n>site_name</span><span class=p>,</span>
        <span class=n>new_file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>file</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>side</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>error</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>progress</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>priority</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>pause</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Update &#39;provider&#39; portion of records in DB.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name. Force to db connection as</span>
<span class=sd>                each file might come from different collection.</span>
<span class=sd>            repre_status (dict): Representation status from sitesync database.</span>
<span class=sd>            site_name (str): Site name.</span>
<span class=sd>            new_file_id (Optional[str]): File id of new file.</span>
<span class=sd>            file (dict[str, Any]): info about processed file (pulled from DB)</span>
<span class=sd>            side (str): &#39;local&#39; | &#39;remote&#39;</span>
<span class=sd>            error (str): exception message</span>
<span class=sd>            progress (float): 0-1 of progress of upload/download</span>
<span class=sd>            priority (int): 0-100 set priority</span>
<span class=sd>            pause (bool): stop synchronizing (only before starting of download,</span>
<span class=sd>                upload)</span>

<span class=sd>        Returns:</span>
<span class=sd>            None</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>files_status</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>file_status</span> <span class=ow>in</span> <span class=n>repre_status</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]:</span>
            <span class=n>status_entity</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span>
                <span class=n>file_status</span><span class=p>[</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2>Status&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>side</span><span class=p>)]</span>
            <span class=p>)</span>
            <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;fileHash&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>file_status</span><span class=p>[</span><span class=s2>&quot;fileHash&quot;</span><span class=p>]</span>
            <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>file_status</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>file_status</span><span class=p>[</span><span class=s2>&quot;fileHash&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>file</span><span class=p>[</span><span class=s2>&quot;fileHash&quot;</span><span class=p>]:</span>
                <span class=k>if</span> <span class=n>new_file_id</span><span class=p>:</span>
                    <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
                    <span class=n>status_entity</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;message&quot;</span><span class=p>)</span>
                    <span class=n>status_entity</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;retries&quot;</span><span class=p>)</span>
                <span class=k>elif</span> <span class=n>progress</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                    <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>IN_PROGRESS</span>
                    <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;progress&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>progress</span>
                <span class=k>elif</span> <span class=n>error</span><span class=p>:</span>
                    <span class=n>max_retries</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span>
                        <span class=p>[</span><span class=n>project_name</span><span class=p>]</span>
                        <span class=p>[</span><span class=s2>&quot;config&quot;</span><span class=p>]</span>
                        <span class=p>[</span><span class=s2>&quot;retry_cnt&quot;</span><span class=p>]</span>
                    <span class=p>)</span>
                    <span class=n>tries</span> <span class=o>=</span> <span class=n>status_entity</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;retries&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
                    <span class=n>tries</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;retries&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>tries</span>
                    <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>error</span>
                    <span class=k>if</span> <span class=n>tries</span> <span class=o>&gt;=</span> <span class=n>max_retries</span><span class=p>:</span>
                        <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>FAILED</span>
                <span class=k>elif</span> <span class=n>pause</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>pause</span><span class=p>:</span>
                        <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;pause&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
                    <span class=k>else</span><span class=p>:</span>
                        <span class=n>status_entity</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s2>&quot;pause&quot;</span><span class=p>)</span>
                <span class=n>files_status</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>status_entity</span><span class=p>)</span>

        <span class=n>representation_id</span> <span class=o>=</span> <span class=n>repre_status</span><span class=p>[</span><span class=s2>&quot;representationId&quot;</span><span class=p>]</span>

        <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state/</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>representation_id</span><span class=p>,</span>
            <span class=n>site_name</span><span class=p>)</span>

        <span class=c1># get to upload</span>
        <span class=n>kwargs</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;files&quot;</span><span class=p>:</span> <span class=n>files_status</span>
        <span class=p>}</span>

        <span class=k>if</span> <span class=n>priority</span><span class=p>:</span>
            <span class=n>kwargs</span><span class=p>[</span><span class=s2>&quot;priority&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>priority</span>

        <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>200</span><span class=p>,</span> <span class=mi>204</span><span class=p>]:</span>
            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Cannot update status&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>progress</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>priority</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>status</span> <span class=o>=</span> <span class=s2>&quot;failed&quot;</span>
        <span class=n>error_str</span> <span class=o>=</span> <span class=s2>&quot;with error </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>new_file_id</span><span class=p>:</span>
            <span class=n>status</span> <span class=o>=</span> <span class=s2>&quot;succeeded with id </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>new_file_id</span><span class=p>)</span>
            <span class=n>error_str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>

        <span class=n>source_file</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
            <span class=s2>&quot;File for </span><span class=si>{}</span><span class=s2> - </span><span class=si>{source_file}</span><span class=s2> process </span><span class=si>{status}</span><span class=s2> </span><span class=si>{error_str}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>representation_id</span><span class=p>,</span>
                <span class=n>status</span><span class=o>=</span><span class=n>status</span><span class=p>,</span>
                <span class=n>source_file</span><span class=o>=</span><span class=n>source_file</span><span class=p>,</span>
                <span class=n>error_str</span><span class=o>=</span><span class=n>error_str</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>reset_site_on_representation</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_id</span><span class=p>,</span>
        <span class=n>side</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>site_name</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Reset information about synchronization for particular &#39;file_id&#39;</span>
<span class=sd>            and provider.</span>
<span class=sd>            Useful for testing or forcing file to be reuploaded.</span>

<span class=sd>            &#39;side&#39; and &#39;site_name&#39; are disjunctive.</span>

<span class=sd>            &#39;side&#39; is used for resetting local or remote side for</span>
<span class=sd>            current user for repre.</span>

<span class=sd>            &#39;site_name&#39; is used to set synchronization for particular site.</span>
<span class=sd>            Should be used when repre should be synced to new site.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): name of project (eg. collection) in DB</span>
<span class=sd>            representation_id (str): Representation id.</span>
<span class=sd>            file_id (str): File id in representation.</span>
<span class=sd>            side (str): Local or remote side.</span>
<span class=sd>            site_name (str): for adding new site</span>

<span class=sd>        Raises:</span>
<span class=sd>            SiteAlreadyPresentError - if adding already existing site and</span>
<span class=sd>                not &#39;force&#39;</span>
<span class=sd>            ValueError - other errors (repre not found, misconfiguration)</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>representation</span> <span class=o>=</span> <span class=n>get_representation_by_id</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>representation</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;Representation </span><span class=si>{}</span><span class=s2> not found in </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>representation_id</span><span class=p>,</span> <span class=n>project_name</span>
                <span class=p>)</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>side</span> <span class=ow>and</span> <span class=n>site_name</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;Misconfiguration, only one of side and&quot;</span>
                <span class=s2>&quot; site_name arguments should be passed.&quot;</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>side</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>side</span> <span class=o>==</span> <span class=s2>&quot;local&quot;</span><span class=p>:</span>
                <span class=n>site_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_active_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>site_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_remote_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>add_site</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>file_id</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_progress_for_repre_new</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation</span><span class=p>,</span>
        <span class=n>local_site_name</span><span class=p>,</span>
        <span class=n>remote_site_name</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
        <span class=n>representation_id</span> <span class=o>=</span> <span class=n>representation</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>
        <span class=n>sync_status</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_repre_sync_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>representation_id</span><span class=p>,</span>
            <span class=n>local_site_name</span><span class=p>,</span>
            <span class=n>remote_site_name</span>
        <span class=p>)</span>

        <span class=n>progress</span> <span class=o>=</span> <span class=p>{</span>
            <span class=n>local_site_name</span><span class=p>:</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span>
            <span class=n>remote_site_name</span><span class=p>:</span> <span class=o>-</span><span class=mi>1</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>sync_status</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>progress</span>

        <span class=n>mapping</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;localStatus&quot;</span><span class=p>:</span> <span class=n>local_site_name</span><span class=p>,</span>
            <span class=s2>&quot;remoteStatus&quot;</span><span class=p>:</span> <span class=n>remote_site_name</span>
        <span class=p>}</span>
        <span class=n>files</span> <span class=o>=</span> <span class=p>{</span><span class=n>local_site_name</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>remote_site_name</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
        <span class=n>file_states</span> <span class=o>=</span> <span class=n>sync_status</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>file_state</span> <span class=ow>in</span> <span class=n>file_states</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>status</span> <span class=ow>in</span> <span class=n>mapping</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
                <span class=n>status_info</span> <span class=o>=</span> <span class=n>file_state</span><span class=p>[</span><span class=n>status</span><span class=p>]</span>
                <span class=n>site_name</span> <span class=o>=</span> <span class=n>mapping</span><span class=p>[</span><span class=n>status</span><span class=p>]</span>
                <span class=n>files</span><span class=p>[</span><span class=n>site_name</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
                <span class=n>norm_progress</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>progress</span><span class=p>[</span><span class=n>site_name</span><span class=p>],</span> <span class=mi>0</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>status_info</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>:</span>
                    <span class=n>progress</span><span class=p>[</span><span class=n>site_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>norm_progress</span> <span class=o>+</span> <span class=mi>1</span>
                <span class=k>elif</span> <span class=n>status_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;progress&quot;</span><span class=p>):</span>
                    <span class=n>progress</span><span class=p>[</span><span class=n>site_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>norm_progress</span> <span class=o>+</span> <span class=n>status_info</span><span class=p>[</span>
                        <span class=s2>&quot;progress&quot;</span><span class=p>]</span>
                <span class=k>else</span><span class=p>:</span>  <span class=c1># site exists, might be failed, do not add again</span>
                    <span class=n>progress</span><span class=p>[</span><span class=n>site_name</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>

        <span class=c1># for example 13 fully avail. files out of 26 &gt;&gt; 13/26 = 0.5</span>
        <span class=k>return</span> <span class=p>{</span>
            <span class=n>local_site_name</span><span class=p>:</span> <span class=p>(</span>
                <span class=n>progress</span><span class=p>[</span><span class=n>local_site_name</span><span class=p>]</span> <span class=o>/</span> <span class=nb>max</span><span class=p>(</span><span class=n>files</span><span class=p>[</span><span class=n>local_site_name</span><span class=p>],</span> <span class=mi>1</span><span class=p>)</span>
            <span class=p>),</span>
            <span class=n>remote_site_name</span><span class=p>:</span> <span class=p>(</span>
                <span class=n>progress</span><span class=p>[</span><span class=n>remote_site_name</span><span class=p>]</span> <span class=o>/</span> <span class=nb>max</span><span class=p>(</span><span class=n>files</span><span class=p>[</span><span class=n>remote_site_name</span><span class=p>],</span> <span class=mi>1</span><span class=p>)</span>
            <span class=p>)</span>
        <span class=p>}</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_progress_for_repre_old</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>representation</span><span class=p>,</span>
        <span class=n>local_site_name</span><span class=p>,</span>
        <span class=n>remote_site_name</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_new</span><span class=p>(</span>
            <span class=n>representation</span><span class=p>[</span><span class=s2>&quot;context&quot;</span><span class=p>][</span><span class=s2>&quot;project&quot;</span><span class=p>][</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
            <span class=n>representation</span><span class=p>,</span>
            <span class=n>local_site_name</span><span class=p>,</span>
            <span class=n>remote_site_name</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_progress_for_repre</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculates average progress for representation.</span>

<span class=sd>        If site has created_dt &gt;&gt; fully available &gt;&gt; progress == 1</span>

<span class=sd>        Could be calculated in aggregate if it would be too slow</span>

<span class=sd>        Returns:</span>
<span class=sd>            (dict) with active and remote sites progress</span>
<span class=sd>            {&#39;studio&#39;: 1.0, &#39;gdrive&#39;: -1} - gdrive site is not present</span>
<span class=sd>                -1 is used to highlight the site should be added</span>
<span class=sd>            {&#39;studio&#39;: 1.0, &#39;gdrive&#39;: 0.0} - gdrive site is present, not</span>
<span class=sd>                uploaded yet</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>sig_new</span> <span class=o>=</span> <span class=n>inspect</span><span class=o>.</span><span class=n>signature</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_new</span><span class=p>)</span>
        <span class=n>sig_old</span> <span class=o>=</span> <span class=n>inspect</span><span class=o>.</span><span class=n>signature</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_old</span><span class=p>)</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>sig_new</span><span class=o>.</span><span class=n>bind</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_new</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>TypeError</span><span class=p>:</span>
            <span class=k>pass</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>sig_old</span><span class=o>.</span><span class=n>bind</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
            <span class=nb>print</span><span class=p>(</span>
                <span class=s2>&quot;Using old signature of &#39;get_progress_for_repre&#39;&quot;</span>
                <span class=s2>&quot; please add project name as first argument.&quot;</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_old</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>TypeError</span><span class=p>:</span>
            <span class=k>pass</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_new</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_set_state_sync_state</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_id</span><span class=p>,</span>
        <span class=n>site_name</span><span class=p>,</span>
        <span class=n>payload_dict</span><span class=p>,</span>
        <span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calls server endpoint to store sync info for &#39;representation_id&#39;.&quot;&quot;&quot;</span>
        <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state/</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>force</span><span class=p>:</span>
            <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>endpoint</span><span class=si>}</span><span class=s2>?reset=true&quot;</span>

        <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>payload_dict</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>200</span><span class=p>,</span> <span class=mi>204</span><span class=p>]:</span>
            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Cannot update status&quot;</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_repre_sync_state</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_id</span><span class=p>,</span>
        <span class=n>local_site_name</span><span class=p>,</span>
        <span class=n>remote_site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=o>**</span><span class=n>kwargs</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Use server endpoint to get synchronization info for representation.</span>

<span class=sd>        Warning:</span>
<span class=sd>            Logic of this</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>
<span class=sd>            representation_id (str): Representation id.</span>
<span class=sd>            local_site_name (str)</span>
<span class=sd>            remote_site_name (str)</span>
<span class=sd>            all other parameters for `Get Site Sync State` endpoint if</span>
<span class=sd>                necessary</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>repre_states</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_repres_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=p>{</span><span class=n>representation_id</span><span class=p>},</span>
            <span class=n>local_site_name</span><span class=p>,</span>
            <span class=n>remote_site_name</span><span class=p>,</span>
            <span class=o>**</span><span class=n>kwargs</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>repre_states</span><span class=p>:</span>
            <span class=n>repre_state</span> <span class=o>=</span> <span class=n>repre_states</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>repre_state</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_representations_sites_sync_state</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_ids</span><span class=p>,</span>
        <span class=n>site_names</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot; Returns all site states for representation ids.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str):</span>
<span class=sd>            representation_ids (list[str]): even single repre should be in []</span>
<span class=sd>            site_names (list[str]): sub-selection of states</span>

<span class=sd>        Returns:</span>
<span class=sd>            list[dict]: dicts follow RepresentationSiteStateModel</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state/representations&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span>
        <span class=p>)</span>

        <span class=n>payload_dict</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;representationIds&quot;</span><span class=p>:</span> <span class=n>representation_ids</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=n>site_names</span><span class=p>:</span>
            <span class=n>payload_dict</span><span class=p>[</span><span class=s2>&quot;siteNames&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>site_names</span>

        <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>payload_dict</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
                <span class=s2>&quot;Can&#39;t get all sites sync state for representations </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>representation_ids</span>
                <span class=p>)</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_representations_sync_state</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_ids</span><span class=p>,</span>
        <span class=n>local_site_name</span><span class=p>,</span>
        <span class=n>remote_site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=o>**</span><span class=n>kwargs</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Use server endpoint to get synchronization info for representations.</span>

<span class=sd>        Calculates float progress based on progress of all files for repre.</span>
<span class=sd>        If repre is fully synchronized it returns 1, 0 for any other state.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str):</span>
<span class=sd>            representation_ids (list): even single repre should be in []</span>
<span class=sd>            local_site_name (str)</span>
<span class=sd>            remote_site_name (str)</span>
<span class=sd>            all other parameters for `Get Site Sync State` endpoint if</span>
<span class=sd>                necessary.</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict[str, tuple[float, float]]: Progress by representation id.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>repre_states</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_repres_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>representation_ids</span><span class=p>,</span>
            <span class=n>local_site_name</span><span class=p>,</span>
            <span class=n>remote_site_name</span><span class=p>,</span>
            <span class=o>**</span><span class=n>kwargs</span>
        <span class=p>)</span>
        <span class=n>states</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>for</span> <span class=n>repre_state</span> <span class=ow>in</span> <span class=n>repre_states</span><span class=p>:</span>
            <span class=n>repre_files_count</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>])</span>

            <span class=n>repre_local_status</span> <span class=o>=</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>
            <span class=n>repre_local_progress</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>if</span> <span class=n>repre_local_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>:</span>
                <span class=n>repre_local_progress</span> <span class=o>=</span> <span class=mi>1</span>
            <span class=k>elif</span> <span class=n>repre_local_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>IN_PROGRESS</span><span class=p>:</span>
                <span class=n>local_sum</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
                    <span class=n>file_info</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;progress&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
                    <span class=k>for</span> <span class=n>file_info</span> <span class=ow>in</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span>
                <span class=p>)</span>
                <span class=n>repre_local_progress</span> <span class=o>=</span> <span class=n>local_sum</span> <span class=o>/</span> <span class=n>repre_files_count</span>

            <span class=n>repre_remote_status</span> <span class=o>=</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>
            <span class=n>repre_remote_progress</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>if</span> <span class=n>repre_remote_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>:</span>
                <span class=n>repre_remote_progress</span> <span class=o>=</span> <span class=mi>1</span>
            <span class=k>elif</span> <span class=n>repre_remote_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>IN_PROGRESS</span><span class=p>:</span>
                <span class=n>remote_sum</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
                    <span class=n>file_info</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;progress&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
                    <span class=k>for</span> <span class=n>file_info</span> <span class=ow>in</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span>
                <span class=p>)</span>
                <span class=n>repre_remote_progress</span> <span class=o>=</span> <span class=n>remote_sum</span> <span class=o>/</span> <span class=n>repre_files_count</span>

            <span class=n>states</span><span class=p>[</span><span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;representationId&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>repre_local_progress</span><span class=p>,</span>
                <span class=n>repre_remote_progress</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=n>states</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_repres_state</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_ids</span><span class=p>,</span>
        <span class=n>local_site_name</span><span class=p>,</span>
        <span class=n>remote_site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=o>**</span><span class=n>kwargs</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Use server endpoint to get sync info for representations.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>
<span class=sd>            representation_ids (Iterable[str]): Representation ids.</span>
<span class=sd>            local_site_name (str): Local site name.</span>
<span class=sd>            remote_site_name (str): Remote site name.</span>
<span class=sd>            kwargs: All other parameters for `Get Site Sync State` endpoint if</span>
<span class=sd>                necessary</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>remote_site_name</span><span class=p>:</span>
            <span class=n>remote_site_name</span> <span class=o>=</span> <span class=n>local_site_name</span>
        <span class=n>payload_dict</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;localSite&quot;</span><span class=p>:</span> <span class=n>local_site_name</span><span class=p>,</span>
            <span class=s2>&quot;remoteSite&quot;</span><span class=p>:</span> <span class=n>remote_site_name</span><span class=p>,</span>
            <span class=s2>&quot;representationIds&quot;</span><span class=p>:</span> <span class=n>representation_ids</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=n>kwargs</span><span class=p>:</span>
            <span class=n>payload_dict</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>

        <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span>
        <span class=p>)</span>

        <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>payload_dict</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
                <span class=s2>&quot;Cannot get sync state for representations </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>representation_ids</span>
                <span class=p>)</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_version_availability</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>version_ids</span><span class=p>,</span>
        <span class=n>local_site_name</span><span class=p>,</span>
        <span class=n>remote_site_name</span><span class=p>,</span>
        <span class=o>**</span><span class=n>kwargs</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns aggregated state for version ids.</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>
<span class=sd>            version_ids (Iterable[str]): Version ids.</span>
<span class=sd>            local_site_name (str): Local site name.</span>
<span class=sd>            remote_site_name (str): Remote site name.</span>
<span class=sd>            kwargs: All other parameters for `Get Site Sync State` endpoint if</span>
<span class=sd>                necessary.</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict[str, tuple[float, float]]: Status by version id.</span>
<span class=sd>                Example: {version_id: (local_status, remote_status)}</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>version_ids</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>version_ids</span><span class=p>)</span>
        <span class=n>payload_dict</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;localSite&quot;</span><span class=p>:</span> <span class=n>local_site_name</span><span class=p>,</span>
            <span class=s2>&quot;remoteSite&quot;</span><span class=p>:</span> <span class=n>remote_site_name</span><span class=p>,</span>
            <span class=s2>&quot;versionIdsFilter&quot;</span><span class=p>:</span> <span class=n>version_ids</span>
        <span class=p>}</span>
        <span class=n>payload_dict</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>

        <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span>
        <span class=p>)</span>

        <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>payload_dict</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
                <span class=s2>&quot;Cannot get sync state for versions </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>version_ids</span>
                <span class=p>)</span>
            <span class=p>)</span>

        <span class=n>version_statuses</span> <span class=o>=</span> <span class=p>{</span>
            <span class=n>version_id</span><span class=p>:</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
            <span class=k>for</span> <span class=n>version_id</span> <span class=ow>in</span> <span class=n>version_ids</span>
        <span class=p>}</span>

        <span class=n>repre_avail_by_version_id</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>repre_avail</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]:</span>
            <span class=n>version_id</span> <span class=o>=</span> <span class=n>repre_avail</span><span class=p>[</span><span class=s2>&quot;versionId&quot;</span><span class=p>]</span>
            <span class=n>repre_avail_by_version_id</span><span class=p>[</span><span class=n>version_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>repre_avail</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>version_id</span><span class=p>,</span> <span class=n>repre_avails</span> <span class=ow>in</span> <span class=n>repre_avail_by_version_id</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>avail_local</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
                <span class=nb>int</span><span class=p>(</span>
                    <span class=n>repre_avail</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
                <span class=p>)</span>
                <span class=k>for</span> <span class=n>repre_avail</span> <span class=ow>in</span> <span class=n>repre_avails</span>
            <span class=p>)</span>
            <span class=n>avail_remote</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
                <span class=nb>int</span><span class=p>(</span>
                    <span class=n>repre_avail</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
                <span class=p>)</span>
                <span class=k>for</span> <span class=n>repre_avail</span> <span class=ow>in</span> <span class=n>repre_avails</span>
            <span class=p>)</span>
            <span class=n>version_statuses</span><span class=p>[</span><span class=n>version_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>avail_local</span><span class=p>,</span> <span class=n>avail_remote</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>version_statuses</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_remove_local_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Removes all local files for &#39;site_name&#39; of &#39;representation_id&#39;</span>

<span class=sd>        Args:</span>
<span class=sd>            project_name (str): Project name.</span>
<span class=sd>            representation_id (str): Representation id.</span>
<span class=sd>            site_name (str): name of configured and active site</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>my_local_site</span> <span class=o>=</span> <span class=n>get_local_site_id</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>my_local_site</span> <span class=o>!=</span> <span class=n>site_name</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=s2>&quot;Cannot remove non local file for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=k>return</span>

        <span class=n>provider_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_provider_for_site</span><span class=p>(</span><span class=n>site</span><span class=o>=</span><span class=n>site_name</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>provider_name</span> <span class=o>!=</span> <span class=s2>&quot;local_drive&quot;</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>representation</span> <span class=o>=</span> <span class=n>get_representation_by_id</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>representation</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                <span class=s2>&quot;Representation with id </span><span class=si>{}</span><span class=s2> was not found&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>representation_id</span>
                <span class=p>)</span>
            <span class=p>)</span>
            <span class=k>return</span>

        <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>representation</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]:</span>
            <span class=n>local_file_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_local_file_path</span><span class=p>(</span>
                <span class=n>project_name</span><span class=p>,</span>
                <span class=n>site_name</span><span class=p>,</span>
                <span class=n>file</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=n>local_file_path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Missing local file path&quot;</span><span class=p>)</span>

            <span class=k>try</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Removing </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>local_file_path</span><span class=p>))</span>
                <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>local_file_path</span><span class=p>)</span>
            <span class=k>except</span> <span class=ne>IndexError</span><span class=p>:</span>
                <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;No file set for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>representation_id</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
            <span class=k>except</span> <span class=ne>OSError</span><span class=p>:</span>
                <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;File </span><span class=si>{}</span><span class=s2> cannot be removed&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>file</span><span class=p>[</span><span class=s2>&quot;path&quot;</span><span class=p>])</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>

            <span class=n>folder</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>local_file_path</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>folder</span><span class=p>):</span>  <span class=c1># folder is not empty</span>
                <span class=k>continue</span>

            <span class=k>try</span><span class=p>:</span>
                <span class=n>os</span><span class=o>.</span><span class=n>rmdir</span><span class=p>(</span><span class=n>folder</span><span class=p>)</span>
            <span class=k>except</span> <span class=ne>OSError</span><span class=p>:</span>
                <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;folder </span><span class=si>{}</span><span class=s2> cannot be removed&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>folder</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>reset_timer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Called when waiting for next loop should be skipped.</span>

<span class=sd>            In case of user&#39;s involvement (reset site), start that right away.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_reset_timer_with_rest_api</span><span class=p>()</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span><span class=o>.</span><span class=n>reset_timer</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_loop_delay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            Return count of seconds before next synchronization loop starts</span>
<span class=sd>            after finish of previous loop.</span>

<span class=sd>        Returns:</span>
<span class=sd>            (int): in seconds</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>project_name</span><span class=p>:</span>
            <span class=k>return</span> <span class=mi>60</span>

        <span class=c1># TODO this is used in global loop it should not be based on</span>
        <span class=c1>#   project settings.</span>
        <span class=n>ld</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span><span class=p>[</span><span class=n>project_name</span><span class=p>][</span><span class=s2>&quot;config&quot;</span><span class=p>][</span><span class=s2>&quot;loop_delay&quot;</span><span class=p>]</span>
        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>ld</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>cli</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>click_group</span><span class=p>):</span>
        <span class=n>main</span> <span class=o>=</span> <span class=n>click_wrap</span><span class=o>.</span><span class=n>group</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_cli_main</span><span class=p>,</span>
            <span class=n>name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
            <span class=n>help</span><span class=o>=</span><span class=s2>&quot;SiteSync addon related commands.&quot;</span>
        <span class=p>)</span>

        <span class=n>main</span><span class=o>.</span><span class=n>command</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_cli_command_syncservice</span><span class=p>,</span>
            <span class=n>name</span><span class=o>=</span><span class=s2>&quot;syncservice&quot;</span><span class=p>,</span>
            <span class=n>help</span><span class=o>=</span><span class=s2>&quot;Launch Site Sync under entered site.&quot;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>option</span><span class=p>(</span>
            <span class=s2>&quot;-a&quot;</span><span class=p>,</span>
            <span class=s2>&quot;--active_site&quot;</span><span class=p>,</span>
            <span class=n>help</span><span class=o>=</span><span class=s2>&quot;Name of active site&quot;</span><span class=p>,</span>
            <span class=n>required</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span>
        <span class=n>click_group</span><span class=o>.</span><span class=n>add_command</span><span class=p>(</span><span class=n>main</span><span class=o>.</span><span class=n>to_click_obj</span><span class=p>())</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_cli_main</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>pass</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_cli_command_syncservice</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>active_site</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Launch sync server under entered site.</span>

<span class=sd>        This should be ideally used by system service (such us systemd or upstart</span>
<span class=sd>        on linux and window service).</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;AYON_SITE_ID&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>active_site</span>

        <span class=k>def</span><span class=w> </span><span class=nf>signal_handler</span><span class=p>(</span><span class=n>sig</span><span class=p>,</span> <span class=n>frame</span><span class=p>):</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;You pressed Ctrl+C. Process ended.&quot;</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>server_exit</span><span class=p>()</span>
            <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>

        <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGINT</span><span class=p>,</span> <span class=n>signal_handler</span><span class=p>)</span>
        <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGTERM</span><span class=p>,</span> <span class=n>signal_handler</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>server_init</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>server_start</span><span class=p>()</span>

        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>1.0</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.add_site class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>QUEUED</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Adds new site to representation to be synced.</p> <p>'project_name' must have synchronization enabled (globally or project only)</p> <p>Used as a API endpoint from outside applications (Loader etc).</p> <p>Use 'force' to reset existing site.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Representation id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Site name of configured site.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>file_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>File id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>force</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Reset site if exists.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>status</code> </td> <td> <code><span title=client.ayon_sitesync.utils.SiteSyncStatus>SiteSyncStatus</span></code> </td> <td> <div class=doc-md-description> <p>Current status, default SiteSyncStatus.QUEUED</p> </div> </td> <td> <code><span title=client.ayon_sitesync.utils.SiteSyncStatus.QUEUED>QUEUED</span></code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="SiteAlreadyPresentError (client.ayon_sitesync.utils.SiteAlreadyPresentError)" href=utils.html#client.ayon_sitesync.utils.SiteAlreadyPresentError>SiteAlreadyPresentError</a></code> </td> <td> <div class=doc-md-description> <p>If adding already existing site and not 'force'</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>other errors (repre not found, misconfiguration)</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>add_site</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>representation_id</span><span class=p>,</span>
    <span class=n>site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>status</span><span class=o>=</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>QUEUED</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Adds new site to representation to be synced.</span>

<span class=sd>    &#39;project_name&#39; must have synchronization enabled (globally or</span>
<span class=sd>    project only)</span>

<span class=sd>    Used as a API endpoint from outside applications (Loader etc).</span>

<span class=sd>    Use &#39;force&#39; to reset existing site.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>
<span class=sd>        representation_id (str): Representation id.</span>
<span class=sd>        site_name (str): Site name of configured site.</span>
<span class=sd>        file_id (str): File id.</span>
<span class=sd>        force (bool): Reset site if exists.</span>
<span class=sd>        status (SiteSyncStatus): Current status,</span>
<span class=sd>            default SiteSyncStatus.QUEUED</span>

<span class=sd>    Raises:</span>
<span class=sd>        SiteAlreadyPresentError: If adding already existing site and</span>
<span class=sd>            not &#39;force&#39;</span>
<span class=sd>        ValueError: other errors (repre not found, misconfiguration)</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Project not configured&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>site_name</span><span class=p>:</span>
        <span class=n>site_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>DEFAULT_SITE</span>

    <span class=n>representation</span> <span class=o>=</span> <span class=n>get_representation_by_id</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span>
    <span class=p>)</span>

    <span class=n>files</span> <span class=o>=</span> <span class=n>representation</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[])</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>files</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;No files for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>representation_id</span><span class=p>))</span>
        <span class=k>return</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>force</span><span class=p>:</span>
        <span class=n>existing</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_repre_sync_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>representation_id</span><span class=p>,</span>
            <span class=n>site_name</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>existing</span><span class=p>:</span>
            <span class=n>failure</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=k>if</span> <span class=n>file_id</span><span class=p>:</span>
                <span class=n>file_exists</span> <span class=o>=</span> <span class=n>existing</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>file_id</span><span class=p>)</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>file_exists</span><span class=p>:</span>
                    <span class=n>failure</span> <span class=o>=</span> <span class=kc>False</span>

            <span class=k>if</span> <span class=n>failure</span><span class=p>:</span>
                <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Site </span><span class=si>{}</span><span class=s2> already present&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
                <span class=k>raise</span> <span class=n>SiteAlreadyPresentError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>

    <span class=n>new_site_files</span> <span class=o>=</span> <span class=p>[</span>
        <span class=p>{</span>
            <span class=s2>&quot;size&quot;</span><span class=p>:</span> <span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;size&quot;</span><span class=p>],</span>
            <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=n>status</span><span class=p>,</span>
            <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>timestamp</span><span class=p>(),</span>
            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
            <span class=s2>&quot;fileHash&quot;</span><span class=p>:</span> <span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;hash&quot;</span><span class=p>]</span>
        <span class=p>}</span>
        <span class=k>for</span> <span class=n>repre_file</span> <span class=ow>in</span> <span class=n>files</span>
    <span class=p>]</span>

    <span class=n>payload_dict</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;files&quot;</span><span class=p>:</span> <span class=n>new_site_files</span><span class=p>}</span>
    <span class=n>representation_id</span> <span class=o>=</span> <span class=n>representation_id</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;-&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_set_state_sync_state</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>payload_dict</span><span class=p>,</span> <span class=n>force</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.check_status class="doc doc-heading"> <code class="highlight language-python"><span class=n>check_status</span><span class=p>(</span><span class=n>file_state</span><span class=p>,</span> <span class=n>local_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>,</span> <span class=n>config_preset</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Check synchronization status of a file.</p> <p>The file is on representation status is checked for single 'provider'. (Eg. check if 'scene.ma' of lookdev.v10 should be synced to GDrive</p> <p>Always is comparing local record, eg. site with 'name' == self.presets[PROJECT_NAME]["config"]["active_site"]</p> <p>This leads to trigger actual upload or download, there is a use case 'studio' &lt;&gt; 'remote' where user should publish to 'studio', see progress in Tray GUI, but do not do physical upload/download (as multiple user would be doing that).</p> <pre><code>Do physical U/D only when any of the sites is user's local, in that
case only user has the data and must U/D.
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>file_state</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>File info from site sync database.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>local_site</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Local site of compare (usually 'studio').</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>remote_site</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Remote site (gdrive etc).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>config_preset</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Config about active site, retries.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>int</code></td> <td> </td> <td> <div class=doc-md-description> <p>Sync status value of representation.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span>
<span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>check_status</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_state</span><span class=p>,</span> <span class=n>local_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>,</span> <span class=n>config_preset</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Check synchronization status of a file.</span>

<span class=sd>    The file is on representation status is checked for single &#39;provider&#39;.</span>
<span class=sd>        (Eg. check if &#39;scene.ma&#39; of lookdev.v10 should be synced to GDrive</span>

<span class=sd>    Always is comparing local record, eg. site with</span>
<span class=sd>        &#39;name&#39; == self.presets[PROJECT_NAME][&quot;config&quot;][&quot;active_site&quot;]</span>

<span class=sd>    This leads to trigger actual upload or download, there is</span>
<span class=sd>        a use case &#39;studio&#39; &lt;&gt; &#39;remote&#39; where user should publish</span>
<span class=sd>        to &#39;studio&#39;, see progress in Tray GUI, but do not do</span>
<span class=sd>        physical upload/download</span>
<span class=sd>        (as multiple user would be doing that).</span>

<span class=sd>        Do physical U/D only when any of the sites is user&#39;s local, in that</span>
<span class=sd>        case only user has the data and must U/D.</span>

<span class=sd>    Args:</span>
<span class=sd>        file_state (dict): File info from site sync database.</span>
<span class=sd>        local_site (str): Local site of compare (usually &#39;studio&#39;).</span>
<span class=sd>        remote_site (str): Remote site (gdrive etc).</span>
<span class=sd>        config_preset (dict): Config about active site, retries.</span>

<span class=sd>    Returns:</span>
<span class=sd>        int: Sync status value of representation.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>get_local_site_id</span><span class=p>()</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>(</span><span class=n>local_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>):</span>
        <span class=c1># don&#39;t do upload/download for studio sites</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
            <span class=s2>&quot;No local site </span><span class=si>{}</span><span class=s2> - </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>local_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=n>SyncStatus</span><span class=o>.</span><span class=n>DO_NOTHING</span>

    <span class=n>local_status</span> <span class=o>=</span> <span class=n>file_state</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>
    <span class=n>remote_status</span> <span class=o>=</span> <span class=n>file_state</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>

    <span class=k>if</span> <span class=p>(</span>
        <span class=n>local_status</span> <span class=o>!=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
        <span class=ow>and</span> <span class=n>remote_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
    <span class=p>):</span>
        <span class=n>retries</span> <span class=o>=</span> <span class=n>file_state</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;retries&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>retries</span> <span class=o>&lt;</span> <span class=nb>int</span><span class=p>(</span><span class=n>config_preset</span><span class=p>[</span><span class=s2>&quot;retry_cnt&quot;</span><span class=p>]):</span>
            <span class=k>return</span> <span class=n>SyncStatus</span><span class=o>.</span><span class=n>DO_DOWNLOAD</span>

    <span class=k>if</span> <span class=p>(</span>
        <span class=n>remote_status</span> <span class=o>!=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
        <span class=ow>and</span> <span class=n>local_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
    <span class=p>):</span>
        <span class=n>retries</span> <span class=o>=</span> <span class=n>file_state</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;retries&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>retries</span> <span class=o>&lt;</span> <span class=nb>int</span><span class=p>(</span><span class=n>config_preset</span><span class=p>[</span><span class=s2>&quot;retry_cnt&quot;</span><span class=p>]):</span>
            <span class=k>return</span> <span class=n>SyncStatus</span><span class=o>.</span><span class=n>DO_UPLOAD</span>

    <span class=k>return</span> <span class=n>SyncStatus</span><span class=o>.</span><span class=n>DO_NOTHING</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.clear_project class="doc doc-heading"> <code class="highlight language-python"><span class=n>clear_project</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Clear 'project_name' of 'site_name' and its local files</p> <p>Works only on real local sites, not on 'studio'</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>clear_project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Clear &#39;project_name&#39; of &#39;site_name&#39; and its local files</span>

<span class=sd>        Works only on real local sites, not on &#39;studio&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># TODO implement</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Method &#39;clear_project&#39; is not implemented.&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.compute_resource_sync_sites class="doc doc-heading"> <code class="highlight language-python"><span class=n>compute_resource_sync_sites</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Get available resource sync sites state for publish process.</p> <p>Returns dict with prepared state of sync sites for 'project_name'. It checks if Site Sync is enabled, handles alternative sites. Publish process stores this dictionary as a part of representation document in DB.</p> <p>Example: [ { 'name': '42abbc09-d62a-44a4-815c-a12cd679d2d7', 'status': SiteSyncStatus.OK }, {'name': 'studio', 'status': SiteSyncStatus.QUEUED}, {'name': 'SFTP', 'status': SiteSyncStatus.QUEUED} ] -- representation is published locally, artist or Settings have set remote site as 'studio'. 'SFTP' is alternate site to 'studio'. Eg. whenever file is on 'studio', it is also on 'SFTP'.</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>compute_resource_sync_sites</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get available resource sync sites state for publish process.</span>

<span class=sd>    Returns dict with prepared state of sync sites for &#39;project_name&#39;.</span>
<span class=sd>    It checks if Site Sync is enabled, handles alternative sites.</span>
<span class=sd>    Publish process stores this dictionary as a part of representation</span>
<span class=sd>    document in DB.</span>

<span class=sd>    Example:</span>
<span class=sd>    [</span>
<span class=sd>        {</span>
<span class=sd>            &#39;name&#39;: &#39;42abbc09-d62a-44a4-815c-a12cd679d2d7&#39;,</span>
<span class=sd>            &#39;status&#39;: SiteSyncStatus.OK</span>
<span class=sd>        },</span>
<span class=sd>        {&#39;name&#39;: &#39;studio&#39;, &#39;status&#39;: SiteSyncStatus.QUEUED},</span>
<span class=sd>        {&#39;name&#39;: &#39;SFTP&#39;, &#39;status&#39;: SiteSyncStatus.QUEUED}</span>
<span class=sd>    ] -- representation is published locally, artist or Settings have set</span>
<span class=sd>    remote site as &#39;studio&#39;. &#39;SFTP&#39; is alternate site to &#39;studio&#39;. Eg.</span>
<span class=sd>    whenever file is on &#39;studio&#39;, it is also on &#39;SFTP&#39;.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=nf>create_metadata</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>created</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Create sync site metadata for site with `name`&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>created</span><span class=p>:</span>
            <span class=n>status</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>status</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>QUEUED</span>
        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span> <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=n>status</span><span class=p>}</span>

    <span class=k>if</span> <span class=p>(</span>
        <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_studio_settings</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]</span>
        <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span><span class=p>[</span><span class=n>project_name</span><span class=p>][</span><span class=s2>&quot;enabled&quot;</span><span class=p>]</span>
    <span class=p>):</span>
        <span class=k>return</span> <span class=p>[</span><span class=n>create_metadata</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>DEFAULT_SITE</span><span class=p>)]</span>

    <span class=n>local_site</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_active_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
    <span class=n>remote_site</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_remote_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=c1># Attached sites metadata by site name</span>
    <span class=c1># That is the local site, remote site, the always accesible sites</span>
    <span class=c1># and their alternate sites (alias of sites with different protocol)</span>
    <span class=n>attached_sites</span> <span class=o>=</span> <span class=p>{</span>
        <span class=n>local_site</span><span class=p>:</span> <span class=n>create_metadata</span><span class=p>(</span><span class=n>local_site</span><span class=p>)</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=n>remote_site</span> <span class=ow>and</span> <span class=n>remote_site</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>attached_sites</span><span class=p>:</span>
        <span class=n>attached_sites</span><span class=p>[</span><span class=n>remote_site</span><span class=p>]</span> <span class=o>=</span> <span class=n>create_metadata</span><span class=p>(</span>
            <span class=n>remote_site</span><span class=p>,</span> <span class=n>created</span><span class=o>=</span><span class=kc>False</span>
        <span class=p>)</span>

    <span class=n>attached_sites</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_add_alternative_sites</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>attached_sites</span><span class=p>)</span>
    <span class=c1># add skeleton for sites where it should be always synced to</span>
    <span class=c1># usually it would be a backup site which is handled by separate</span>
    <span class=c1># background process</span>
    <span class=k>for</span> <span class=n>site_name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_always_accessible_sites</span><span class=p>(</span><span class=n>project_name</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>site_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>attached_sites</span><span class=p>:</span>
            <span class=n>attached_sites</span><span class=p>[</span><span class=n>site_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>create_metadata</span><span class=p>(</span><span class=n>site_name</span><span class=p>,</span> <span class=n>created</span><span class=o>=</span><span class=kc>False</span><span class=p>))</span>
    <span class=n>unique_sites</span> <span class=o>=</span> <span class=p>{</span>
        <span class=n>site</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]:</span> <span class=n>site</span>
        <span class=k>for</span> <span class=n>site</span> <span class=ow>in</span> <span class=n>attached_sites</span><span class=o>.</span><span class=n>values</span><span class=p>()</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>unique_sites</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_active_site class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_active_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Returns active (mine) site for project from settings.</p> <details class=output-logic open> <summary>Output logic</summary> <ul> <li>'studio' if Site Sync is disabled</li> <li>value from 'get_local_site_id' if active site is 'local'</li> <li>any other site name from local settings or project settings (site could be forced from PS)</li> </ul> </details> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>Site name.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span>
<span class=normal>744</span>
<span class=normal>745</span>
<span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span>
<span class=normal>749</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_active_site</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns active (mine) site for project from settings.</span>

<span class=sd>    Output logic:</span>
<span class=sd>        - &#39;studio&#39; if Site Sync is disabled</span>
<span class=sd>        - value from &#39;get_local_site_id&#39; if active site is &#39;local&#39;</span>
<span class=sd>        - any other site name from local settings</span>
<span class=sd>            or project settings (site could be forced from PS)</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Site name.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>active_site_type</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_active_site_type</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>active_site_type</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>LOCAL_SITE</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>get_local_site_id</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>active_site_type</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_active_site_type class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_active_site_type</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>local_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Active site which is defined by artist.</p> <p>Unlike 'get_active_site' is this method also checking local settings where might be different active site set by user. The output is limited to "studio" and "local".</p> <p>This method is used by Anatomy.</p> <details class=todos open> <summary>Todos</summary> <p>Check if sync server is enabled for the project. - To be able to do that the sync settings MUST NOT be cached for all projects at once. The sync settings preparation for all projects is reasonable only in sync server loop. <code>local_settings</code> is probably obsolete in AYON</p> </details> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of project where to look for active site.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>local_settings</code> </td> <td> <code><span title=Optional>Optional</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Prepared local settings.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>Literal["studio", "local"]: Active site.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_active_site_type</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>local_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Active site which is defined by artist.</span>

<span class=sd>    Unlike &#39;get_active_site&#39; is this method also checking local settings</span>
<span class=sd>    where might be different active site set by user. The output is limited</span>
<span class=sd>    to &quot;studio&quot; and &quot;local&quot;.</span>

<span class=sd>    This method is used by Anatomy.</span>

<span class=sd>    Todos:</span>
<span class=sd>        Check if sync server is enabled for the project.</span>
<span class=sd>        - To be able to do that the sync settings MUST NOT be cached for</span>
<span class=sd>            all projects at once. The sync settings preparation for all</span>
<span class=sd>            projects is reasonable only in sync server loop.</span>
<span class=sd>        `local_settings` is probably obsolete in AYON</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Name of project where to look for active site.</span>
<span class=sd>        local_settings (Optional[dict[str, Any]]): Prepared local settings.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Literal[&quot;studio&quot;, &quot;local&quot;]: Active site.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
        <span class=k>return</span> <span class=s2>&quot;studio&quot;</span>

    <span class=n>sync_project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]:</span>
        <span class=k>return</span> <span class=s2>&quot;studio&quot;</span>

    <span class=k>return</span> <span class=p>(</span>
        <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;local_setting&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;active_site&quot;</span><span class=p>)</span>
        <span class=ow>or</span> <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;config&quot;</span><span class=p>][</span><span class=s2>&quot;active_site&quot;</span><span class=p>]</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_anatomy class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_anatomy</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Get already created or newly created anatomy for project</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=return open> <summary>Return</summary> <p>Anatomy: Project anatomy object.</p> </details> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_anatomy</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get already created or newly created anatomy for project</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>

<span class=sd>    Return:</span>
<span class=sd>        Anatomy: Project anatomy object.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>ayon_core.pipeline</span><span class=w> </span><span class=kn>import</span> <span class=n>Anatomy</span>

    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_anatomies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span> <span class=ow>or</span> <span class=n>Anatomy</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_enabled_projects class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_enabled_projects</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Returns list of projects which have SiteSync enabled.</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>882</span>
<span class=normal>883</span>
<span class=normal>884</span>
<span class=normal>885</span>
<span class=normal>886</span>
<span class=normal>887</span>
<span class=normal>888</span>
<span class=normal>889</span>
<span class=normal>890</span>
<span class=normal>891</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_enabled_projects</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns list of projects which have SiteSync enabled.&quot;&quot;&quot;</span>
    <span class=n>enabled_projects</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>project_name</span> <span class=ow>in</span> <span class=n>get_project_names</span><span class=p>():</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_project_enabled</span><span class=p>(</span><span class=n>project_name</span><span class=p>):</span>
                <span class=n>enabled_projects</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>enabled_projects</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_launch_hook_paths class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_launch_hook_paths</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Implementation for applications launch hooks.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>full absolut path to directory with hooks for the addon</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_launch_hook_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Implementation for applications launch hooks.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: full absolut path to directory with hooks for the addon</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)),</span>
        <span class=s2>&quot;launch_hooks&quot;</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_local_file_path class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_local_file_path</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>file_path</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Externalized for app.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Site name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>file_path</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>File path from other site.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>Resolved local path.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_local_file_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>file_path</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Externalized for app.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>
<span class=sd>        site_name (str): Site name.</span>
<span class=sd>        file_path (str): File path from other site.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Resolved local path.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>handler</span> <span class=o>=</span> <span class=n>LocalDriveHandler</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span>
    <span class=n>local_file_path</span> <span class=o>=</span> <span class=n>handler</span><span class=o>.</span><span class=n>resolve_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>local_file_path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_local_normalized_site class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_local_normalized_site</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Normlize local site name.</p> <p>Return 'local' if 'site_name' is local id.</p> <p>In some places Settings or Local Settings require 'local' instead of real site name.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>Normalized site name.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>806</span>
<span class=normal>807</span>
<span class=normal>808</span>
<span class=normal>809</span>
<span class=normal>810</span>
<span class=normal>811</span>
<span class=normal>812</span>
<span class=normal>813</span>
<span class=normal>814</span>
<span class=normal>815</span>
<span class=normal>816</span>
<span class=normal>817</span>
<span class=normal>818</span>
<span class=normal>819</span>
<span class=normal>820</span>
<span class=normal>821</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_local_normalized_site</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>site_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Normlize local site name.</span>

<span class=sd>     Return &#39;local&#39; if &#39;site_name&#39; is local id.</span>

<span class=sd>    In some places Settings or Local Settings require &#39;local&#39; instead</span>
<span class=sd>    of real site name.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Normalized site name.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>site_name</span> <span class=o>==</span> <span class=n>get_local_site_id</span><span class=p>():</span>
        <span class=n>site_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>LOCAL_SITE</span>

    <span class=k>return</span> <span class=n>site_name</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_loop_delay class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_loop_delay</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Return count of seconds before next synchronization loop starts
after finish of previous loop.
</code></pre> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>in seconds</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2072</span>
<span class=normal>2073</span>
<span class=normal>2074</span>
<span class=normal>2075</span>
<span class=normal>2076</span>
<span class=normal>2077</span>
<span class=normal>2078</span>
<span class=normal>2079</span>
<span class=normal>2080</span>
<span class=normal>2081</span>
<span class=normal>2082</span>
<span class=normal>2083</span>
<span class=normal>2084</span>
<span class=normal>2085</span>
<span class=normal>2086</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_loop_delay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Return count of seconds before next synchronization loop starts</span>
<span class=sd>        after finish of previous loop.</span>

<span class=sd>    Returns:</span>
<span class=sd>        (int): in seconds</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>project_name</span><span class=p>:</span>
        <span class=k>return</span> <span class=mi>60</span>

    <span class=c1># TODO this is used in global loop it should not be based on</span>
    <span class=c1>#   project settings.</span>
    <span class=n>ld</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span><span class=p>[</span><span class=n>project_name</span><span class=p>][</span><span class=s2>&quot;config&quot;</span><span class=p>][</span><span class=s2>&quot;loop_delay&quot;</span><span class=p>]</span>
    <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>ld</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_progress_for_repre class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_progress_for_repre</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Calculates average progress for representation.</p> <p>If site has created_dt &gt;&gt; fully available &gt;&gt; progress == 1</p> <p>Could be calculated in aggregate if it would be too slow</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>(dict) with active and remote sites progress</p> </div> </td> </tr> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>{'studio': 1.0, 'gdrive': -1} - gdrive site is not present -1 is used to highlight the site should be added</p> </div> </td> </tr> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>{'studio': 1.0, 'gdrive': 0.0} - gdrive site is present, not uploaded yet</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1691</span>
<span class=normal>1692</span>
<span class=normal>1693</span>
<span class=normal>1694</span>
<span class=normal>1695</span>
<span class=normal>1696</span>
<span class=normal>1697</span>
<span class=normal>1698</span>
<span class=normal>1699</span>
<span class=normal>1700</span>
<span class=normal>1701</span>
<span class=normal>1702</span>
<span class=normal>1703</span>
<span class=normal>1704</span>
<span class=normal>1705</span>
<span class=normal>1706</span>
<span class=normal>1707</span>
<span class=normal>1708</span>
<span class=normal>1709</span>
<span class=normal>1710</span>
<span class=normal>1711</span>
<span class=normal>1712</span>
<span class=normal>1713</span>
<span class=normal>1714</span>
<span class=normal>1715</span>
<span class=normal>1716</span>
<span class=normal>1717</span>
<span class=normal>1718</span>
<span class=normal>1719</span>
<span class=normal>1720</span>
<span class=normal>1721</span>
<span class=normal>1722</span>
<span class=normal>1723</span>
<span class=normal>1724</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_progress_for_repre</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculates average progress for representation.</span>

<span class=sd>    If site has created_dt &gt;&gt; fully available &gt;&gt; progress == 1</span>

<span class=sd>    Could be calculated in aggregate if it would be too slow</span>

<span class=sd>    Returns:</span>
<span class=sd>        (dict) with active and remote sites progress</span>
<span class=sd>        {&#39;studio&#39;: 1.0, &#39;gdrive&#39;: -1} - gdrive site is not present</span>
<span class=sd>            -1 is used to highlight the site should be added</span>
<span class=sd>        {&#39;studio&#39;: 1.0, &#39;gdrive&#39;: 0.0} - gdrive site is present, not</span>
<span class=sd>            uploaded yet</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sig_new</span> <span class=o>=</span> <span class=n>inspect</span><span class=o>.</span><span class=n>signature</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_new</span><span class=p>)</span>
    <span class=n>sig_old</span> <span class=o>=</span> <span class=n>inspect</span><span class=o>.</span><span class=n>signature</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_old</span><span class=p>)</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>sig_new</span><span class=o>.</span><span class=n>bind</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_new</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
    <span class=k>except</span> <span class=ne>TypeError</span><span class=p>:</span>
        <span class=k>pass</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=n>sig_old</span><span class=o>.</span><span class=n>bind</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=nb>print</span><span class=p>(</span>
            <span class=s2>&quot;Using old signature of &#39;get_progress_for_repre&#39;&quot;</span>
            <span class=s2>&quot; please add project name as first argument.&quot;</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_old</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
    <span class=k>except</span> <span class=ne>TypeError</span><span class=p>:</span>
        <span class=k>pass</span>

    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_progress_for_repre_new</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_provider_for_site class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_provider_for_site</span><span class=p>(</span><span class=n>project_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>site</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Get provider name for site (unique name across all projects).</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span>
<span class=normal>1327</span>
<span class=normal>1328</span>
<span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span>
<span class=normal>1340</span>
<span class=normal>1341</span>
<span class=normal>1342</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_provider_for_site</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>site</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get provider name for site (unique name across all projects).&quot;&quot;&quot;</span>
    <span class=n>sites</span> <span class=o>=</span> <span class=p>{</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>DEFAULT_SITE</span><span class=p>:</span> <span class=s2>&quot;local_drive&quot;</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>LOCAL_SITE</span><span class=p>:</span> <span class=s2>&quot;local_drive&quot;</span><span class=p>,</span>
        <span class=n>get_local_site_id</span><span class=p>():</span> <span class=s2>&quot;local_drive&quot;</span>
    <span class=p>}</span>

    <span class=k>if</span> <span class=n>site</span> <span class=ow>in</span> <span class=n>sites</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
        <span class=k>return</span> <span class=n>sites</span><span class=p>[</span><span class=n>site</span><span class=p>]</span>

    <span class=c1># backward compatibility</span>
    <span class=k>if</span> <span class=n>project_name</span><span class=p>:</span>
        <span class=n>proj_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=n>provider</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>proj_settings</span>
            <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;sites&quot;</span><span class=p>,</span> <span class=p>{})</span>
            <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>site</span><span class=p>,</span> <span class=p>{})</span>
            <span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;provider&quot;</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>provider</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>provider</span>

    <span class=n>sync_sett</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_studio_settings</span>
    <span class=k>for</span> <span class=n>site_config</span> <span class=ow>in</span> <span class=n>sync_sett</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;sites&quot;</span><span class=p>):</span>
        <span class=n>sites</span><span class=p>[</span><span class=n>site_config</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>site_config</span><span class=p>[</span><span class=s2>&quot;provider&quot;</span><span class=p>]</span>

    <span class=k>return</span> <span class=n>sites</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>site</span><span class=p>,</span> <span class=s2>&quot;N/A&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_remote_site class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_remote_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Remote (theirs) site for project from settings.</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span>
<span class=normal>756</span>
<span class=normal>757</span>
<span class=normal>758</span>
<span class=normal>759</span>
<span class=normal>760</span>
<span class=normal>761</span>
<span class=normal>762</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_remote_site</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Remote (theirs) site for project from settings.&quot;&quot;&quot;</span>
    <span class=n>sync_project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
    <span class=n>remote_site</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;local_setting&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;remote_site&quot;</span><span class=p>)</span>
        <span class=ow>or</span> <span class=n>sync_project_settings</span><span class=p>[</span><span class=s2>&quot;config&quot;</span><span class=p>][</span><span class=s2>&quot;remote_site&quot;</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=n>remote_site</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>LOCAL_SITE</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>get_local_site_id</span><span class=p>()</span>

    <span class=k>return</span> <span class=n>remote_site</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_repre_info_for_versions class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_repre_info_for_versions</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>version_ids</span><span class=p>,</span> <span class=n>active_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Returns representation for versions and sites combi</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>version_ids</code> </td> <td> <code><span title=Iterable>Iterable</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Version ids.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>active_site</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>'local', 'studio' etc</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>remote_site</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>dtto</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p>Returns:</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_repre_info_for_versions</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>version_ids</span><span class=p>,</span> <span class=n>active_site</span><span class=p>,</span> <span class=n>remote_site</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns representation for versions and sites combi</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name</span>
<span class=sd>        version_ids (Iterable[str]): Version ids.</span>
<span class=sd>        active_site (str): &#39;local&#39;, &#39;studio&#39; etc</span>
<span class=sd>        remote_site (str): dtto</span>

<span class=sd>    Returns:</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>version_ids</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>version_ids</span><span class=p>)</span>
    <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/projects/</span><span class=si>{}</span><span class=s2>/sitesync/state&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span>
    <span class=p>)</span>

    <span class=c1># get to upload</span>
    <span class=n>kwargs</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;localSite&quot;</span><span class=p>:</span> <span class=n>active_site</span><span class=p>,</span>
        <span class=s2>&quot;remoteSite&quot;</span><span class=p>:</span> <span class=n>remote_site</span><span class=p>,</span>
        <span class=s2>&quot;versionIdFilter&quot;</span><span class=p>:</span> <span class=nb>list</span><span class=p>(</span><span class=n>version_ids</span><span class=p>)</span>
    <span class=p>}</span>

    <span class=c1># kwargs[&quot;representationId&quot;] = &quot;94dca33a-7705-11ed-8c0a-34e12d91d510&quot;</span>

    <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
    <span class=n>repre_states</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;representations&quot;</span><span class=p>,</span> <span class=p>[])</span>
    <span class=n>repre_info_by_version_id</span> <span class=o>=</span> <span class=p>{</span>
        <span class=n>version_id</span><span class=p>:</span> <span class=p>{</span>
            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>version_id</span><span class=p>,</span>
            <span class=s2>&quot;repre_count&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
            <span class=s2>&quot;avail_repre_local&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
            <span class=s2>&quot;avail_repre_remote&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
        <span class=p>}</span>
        <span class=k>for</span> <span class=n>version_id</span> <span class=ow>in</span> <span class=n>version_ids</span>
    <span class=p>}</span>
    <span class=n>repre_states_by_version_id</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>repre_state</span> <span class=ow>in</span> <span class=n>repre_states</span><span class=p>:</span>
        <span class=n>version_id</span> <span class=o>=</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;versionId&quot;</span><span class=p>]</span>
        <span class=n>repre_states_by_version_id</span><span class=p>[</span><span class=n>version_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>repre_state</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>version_id</span><span class=p>,</span> <span class=n>repre_states</span> <span class=ow>in</span> <span class=n>repre_states_by_version_id</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=n>repre_info</span> <span class=o>=</span> <span class=n>repre_info_by_version_id</span><span class=p>[</span><span class=n>version_id</span><span class=p>]</span>
        <span class=n>repre_info</span><span class=p>[</span><span class=s2>&quot;repre_count&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>repre_states</span><span class=p>)</span>
        <span class=n>repre_info</span><span class=p>[</span><span class=s2>&quot;avail_repre_local&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_is_available</span><span class=p>(</span><span class=n>repre_state</span><span class=p>,</span> <span class=s2>&quot;localStatus&quot;</span><span class=p>)</span>
            <span class=k>for</span> <span class=n>repre_state</span> <span class=ow>in</span> <span class=n>repre_states</span>
        <span class=p>)</span>
        <span class=n>repre_info</span><span class=p>[</span><span class=s2>&quot;avail_repre_remote&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_is_available</span><span class=p>(</span><span class=n>repre_state</span><span class=p>,</span> <span class=s2>&quot;remoteStatus&quot;</span><span class=p>)</span>
            <span class=k>for</span> <span class=n>repre_state</span> <span class=ow>in</span> <span class=n>repre_states</span>
        <span class=p>)</span>

    <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>repre_info_by_version_id</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_repre_sync_state class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_repre_sync_state</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>local_site_name</span><span class=p>,</span> <span class=n>remote_site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Use server endpoint to get synchronization info for representation.</p> <details class=warning open> <summary>Warning</summary> <p>Logic of this</p> </details> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Representation id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1745</span>
<span class=normal>1746</span>
<span class=normal>1747</span>
<span class=normal>1748</span>
<span class=normal>1749</span>
<span class=normal>1750</span>
<span class=normal>1751</span>
<span class=normal>1752</span>
<span class=normal>1753</span>
<span class=normal>1754</span>
<span class=normal>1755</span>
<span class=normal>1756</span>
<span class=normal>1757</span>
<span class=normal>1758</span>
<span class=normal>1759</span>
<span class=normal>1760</span>
<span class=normal>1761</span>
<span class=normal>1762</span>
<span class=normal>1763</span>
<span class=normal>1764</span>
<span class=normal>1765</span>
<span class=normal>1766</span>
<span class=normal>1767</span>
<span class=normal>1768</span>
<span class=normal>1769</span>
<span class=normal>1770</span>
<span class=normal>1771</span>
<span class=normal>1772</span>
<span class=normal>1773</span>
<span class=normal>1774</span>
<span class=normal>1775</span>
<span class=normal>1776</span>
<span class=normal>1777</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_repre_sync_state</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>representation_id</span><span class=p>,</span>
    <span class=n>local_site_name</span><span class=p>,</span>
    <span class=n>remote_site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=o>**</span><span class=n>kwargs</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Use server endpoint to get synchronization info for representation.</span>

<span class=sd>    Warning:</span>
<span class=sd>        Logic of this</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>
<span class=sd>        representation_id (str): Representation id.</span>
<span class=sd>        local_site_name (str)</span>
<span class=sd>        remote_site_name (str)</span>
<span class=sd>        all other parameters for `Get Site Sync State` endpoint if</span>
<span class=sd>            necessary</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>repre_states</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_repres_state</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=p>{</span><span class=n>representation_id</span><span class=p>},</span>
        <span class=n>local_site_name</span><span class=p>,</span>
        <span class=n>remote_site_name</span><span class=p>,</span>
        <span class=o>**</span><span class=n>kwargs</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=n>repre_states</span><span class=p>:</span>
        <span class=n>repre_state</span> <span class=o>=</span> <span class=n>repre_states</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>repre_state</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_representations_sites_sync_state class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_representations_sites_sync_state</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_ids</span><span class=p>,</span> <span class=n>site_names</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Returns all site states for representation ids.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_ids</code> </td> <td> <code><span title=list>list</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>even single repre should be in []</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_names</code> </td> <td> <code><span title=list>list</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>sub-selection of states</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>list[dict]: dicts follow RepresentationSiteStateModel</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1779</span>
<span class=normal>1780</span>
<span class=normal>1781</span>
<span class=normal>1782</span>
<span class=normal>1783</span>
<span class=normal>1784</span>
<span class=normal>1785</span>
<span class=normal>1786</span>
<span class=normal>1787</span>
<span class=normal>1788</span>
<span class=normal>1789</span>
<span class=normal>1790</span>
<span class=normal>1791</span>
<span class=normal>1792</span>
<span class=normal>1793</span>
<span class=normal>1794</span>
<span class=normal>1795</span>
<span class=normal>1796</span>
<span class=normal>1797</span>
<span class=normal>1798</span>
<span class=normal>1799</span>
<span class=normal>1800</span>
<span class=normal>1801</span>
<span class=normal>1802</span>
<span class=normal>1803</span>
<span class=normal>1804</span>
<span class=normal>1805</span>
<span class=normal>1806</span>
<span class=normal>1807</span>
<span class=normal>1808</span>
<span class=normal>1809</span>
<span class=normal>1810</span>
<span class=normal>1811</span>
<span class=normal>1812</span>
<span class=normal>1813</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_representations_sites_sync_state</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>representation_ids</span><span class=p>,</span>
    <span class=n>site_names</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot; Returns all site states for representation ids.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str):</span>
<span class=sd>        representation_ids (list[str]): even single repre should be in []</span>
<span class=sd>        site_names (list[str]): sub-selection of states</span>

<span class=sd>    Returns:</span>
<span class=sd>        list[dict]: dicts follow RepresentationSiteStateModel</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state/representations&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span>
    <span class=p>)</span>

    <span class=n>payload_dict</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;representationIds&quot;</span><span class=p>:</span> <span class=n>representation_ids</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=n>site_names</span><span class=p>:</span>
        <span class=n>payload_dict</span><span class=p>[</span><span class=s2>&quot;siteNames&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>site_names</span>

    <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>payload_dict</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
            <span class=s2>&quot;Can&#39;t get all sites sync state for representations </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>representation_ids</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_representations_sync_state class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_representations_sync_state</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_ids</span><span class=p>,</span> <span class=n>local_site_name</span><span class=p>,</span> <span class=n>remote_site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Use server endpoint to get synchronization info for representations.</p> <p>Calculates float progress based on progress of all files for repre. If repre is fully synchronized it returns 1, 0 for any other state.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_ids</code> </td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>even single repre should be in []</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>dict[str, tuple[float, float]]: Progress by representation id.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1815</span>
<span class=normal>1816</span>
<span class=normal>1817</span>
<span class=normal>1818</span>
<span class=normal>1819</span>
<span class=normal>1820</span>
<span class=normal>1821</span>
<span class=normal>1822</span>
<span class=normal>1823</span>
<span class=normal>1824</span>
<span class=normal>1825</span>
<span class=normal>1826</span>
<span class=normal>1827</span>
<span class=normal>1828</span>
<span class=normal>1829</span>
<span class=normal>1830</span>
<span class=normal>1831</span>
<span class=normal>1832</span>
<span class=normal>1833</span>
<span class=normal>1834</span>
<span class=normal>1835</span>
<span class=normal>1836</span>
<span class=normal>1837</span>
<span class=normal>1838</span>
<span class=normal>1839</span>
<span class=normal>1840</span>
<span class=normal>1841</span>
<span class=normal>1842</span>
<span class=normal>1843</span>
<span class=normal>1844</span>
<span class=normal>1845</span>
<span class=normal>1846</span>
<span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span>
<span class=normal>1862</span>
<span class=normal>1863</span>
<span class=normal>1864</span>
<span class=normal>1865</span>
<span class=normal>1866</span>
<span class=normal>1867</span>
<span class=normal>1868</span>
<span class=normal>1869</span>
<span class=normal>1870</span>
<span class=normal>1871</span>
<span class=normal>1872</span>
<span class=normal>1873</span>
<span class=normal>1874</span>
<span class=normal>1875</span>
<span class=normal>1876</span>
<span class=normal>1877</span>
<span class=normal>1878</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_representations_sync_state</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>representation_ids</span><span class=p>,</span>
    <span class=n>local_site_name</span><span class=p>,</span>
    <span class=n>remote_site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=o>**</span><span class=n>kwargs</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Use server endpoint to get synchronization info for representations.</span>

<span class=sd>    Calculates float progress based on progress of all files for repre.</span>
<span class=sd>    If repre is fully synchronized it returns 1, 0 for any other state.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str):</span>
<span class=sd>        representation_ids (list): even single repre should be in []</span>
<span class=sd>        local_site_name (str)</span>
<span class=sd>        remote_site_name (str)</span>
<span class=sd>        all other parameters for `Get Site Sync State` endpoint if</span>
<span class=sd>            necessary.</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict[str, tuple[float, float]]: Progress by representation id.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>repre_states</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_repres_state</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_ids</span><span class=p>,</span>
        <span class=n>local_site_name</span><span class=p>,</span>
        <span class=n>remote_site_name</span><span class=p>,</span>
        <span class=o>**</span><span class=n>kwargs</span>
    <span class=p>)</span>
    <span class=n>states</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>repre_state</span> <span class=ow>in</span> <span class=n>repre_states</span><span class=p>:</span>
        <span class=n>repre_files_count</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>])</span>

        <span class=n>repre_local_status</span> <span class=o>=</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>
        <span class=n>repre_local_progress</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>if</span> <span class=n>repre_local_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>:</span>
            <span class=n>repre_local_progress</span> <span class=o>=</span> <span class=mi>1</span>
        <span class=k>elif</span> <span class=n>repre_local_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>IN_PROGRESS</span><span class=p>:</span>
            <span class=n>local_sum</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
                <span class=n>file_info</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;progress&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>file_info</span> <span class=ow>in</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span>
            <span class=p>)</span>
            <span class=n>repre_local_progress</span> <span class=o>=</span> <span class=n>local_sum</span> <span class=o>/</span> <span class=n>repre_files_count</span>

        <span class=n>repre_remote_status</span> <span class=o>=</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>
        <span class=n>repre_remote_progress</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>if</span> <span class=n>repre_remote_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>:</span>
            <span class=n>repre_remote_progress</span> <span class=o>=</span> <span class=mi>1</span>
        <span class=k>elif</span> <span class=n>repre_remote_status</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>IN_PROGRESS</span><span class=p>:</span>
            <span class=n>remote_sum</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
                <span class=n>file_info</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;progress&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>file_info</span> <span class=ow>in</span> <span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span>
            <span class=p>)</span>
            <span class=n>repre_remote_progress</span> <span class=o>=</span> <span class=n>remote_sum</span> <span class=o>/</span> <span class=n>repre_files_count</span>

        <span class=n>states</span><span class=p>[</span><span class=n>repre_state</span><span class=p>[</span><span class=s2>&quot;representationId&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>repre_local_progress</span><span class=p>,</span>
            <span class=n>repre_remote_progress</span>
        <span class=p>)</span>

    <span class=k>return</span> <span class=n>states</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_site_icons class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_site_icons</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Icons for sites.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>dict[str, str]: Path to icon by site.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_site_icons</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Icons for sites.</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict[str, str]: Path to icon by site.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>resource_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
        <span class=n>SYNC_ADDON_DIR</span><span class=p>,</span> <span class=s2>&quot;providers&quot;</span><span class=p>,</span> <span class=s2>&quot;resources&quot;</span>
    <span class=p>)</span>
    <span class=n>icons</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>resource_path</span><span class=p>):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>file_path</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.png&quot;</span><span class=p>):</span>
            <span class=k>continue</span>
        <span class=n>provider_name</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>))</span>
        <span class=n>icons</span><span class=p>[</span><span class=n>provider_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;path&quot;</span><span class=p>,</span>
            <span class=s2>&quot;path&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>resource_path</span><span class=p>,</span> <span class=n>file_path</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=k>return</span> <span class=n>icons</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_site_root_overrides class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_site_root_overrides</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>local_settings</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Get root overrides for project on a site.</p> <p>Implemented to be used in 'Anatomy' for other than 'studio' site.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project for which root overrides should be received.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of site for which should be received roots.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>local_settings</code> </td> <td> <code><span title=Optional>Optional</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Prepare local settigns values.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>Union[dict[str, Any], None]: Root overrides for this machine.</p> </div> </td> </tr> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>{"work": "c:/projects_local"}</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>764</span>
<span class=normal>765</span>
<span class=normal>766</span>
<span class=normal>767</span>
<span class=normal>768</span>
<span class=normal>769</span>
<span class=normal>770</span>
<span class=normal>771</span>
<span class=normal>772</span>
<span class=normal>773</span>
<span class=normal>774</span>
<span class=normal>775</span>
<span class=normal>776</span>
<span class=normal>777</span>
<span class=normal>778</span>
<span class=normal>779</span>
<span class=normal>780</span>
<span class=normal>781</span>
<span class=normal>782</span>
<span class=normal>783</span>
<span class=normal>784</span>
<span class=normal>785</span>
<span class=normal>786</span>
<span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_site_root_overrides</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>local_settings</span><span class=o>=</span><span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get root overrides for project on a site.</span>

<span class=sd>    Implemented to be used in &#39;Anatomy&#39; for other than &#39;studio&#39; site.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project for which root overrides should be</span>
<span class=sd>            received.</span>
<span class=sd>        site_name (str): Name of site for which should be received roots.</span>
<span class=sd>        local_settings (Optional[dict[str, Any]]): Prepare local settigns</span>
<span class=sd>            values.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Union[dict[str, Any], None]: Root overrides for this machine.</span>

<span class=sd>        {&quot;work&quot;: &quot;c:/projects_local&quot;}</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># Validate that site name is valid</span>
    <span class=k>if</span> <span class=n>site_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&quot;studio&quot;</span><span class=p>,</span> <span class=s2>&quot;local&quot;</span><span class=p>):</span>
        <span class=c1># Consider local site id as &#39;local&#39;</span>
        <span class=k>if</span> <span class=n>site_name</span> <span class=o>!=</span> <span class=n>get_local_site_id</span><span class=p>():</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>((</span>
                <span class=s2>&quot;Root overrides are available only for&quot;</span>
                <span class=s2>&quot; default sites not for </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>site_name</span><span class=p>))</span>
        <span class=n>site_name</span> <span class=o>=</span> <span class=s2>&quot;local&quot;</span>

    <span class=n>sitesync_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=n>roots</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>sitesync_settings</span><span class=p>[</span><span class=s2>&quot;enabled&quot;</span><span class=p>]:</span>
        <span class=k>return</span> <span class=n>roots</span>
    <span class=n>local_project_settings</span> <span class=o>=</span> <span class=n>sitesync_settings</span><span class=p>[</span><span class=s2>&quot;local_setting&quot;</span><span class=p>]</span>
    <span class=k>if</span> <span class=n>site_name</span> <span class=o>==</span> <span class=s2>&quot;local&quot;</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>root_info</span> <span class=ow>in</span> <span class=n>local_project_settings</span><span class=p>[</span><span class=s2>&quot;local_roots&quot;</span><span class=p>]:</span>
            <span class=n>roots</span><span class=p>[</span><span class=n>root_info</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>root_info</span><span class=p>[</span><span class=s2>&quot;path&quot;</span><span class=p>]</span>

    <span class=k>return</span> <span class=n>roots</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_sync_project_setting class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>exclude_locals</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>cached</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Handles pulling sitesync's settings for enabled 'project_name'</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>used in project settings</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>exclude_locals</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>ignore overrides from Local Settings</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>cached</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>use pre-cached values, or return fresh ones cached values needed for single loop (with all overrides) fresh values needed for Local settings (without overrides)</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>dict</code></td> <td> </td> <td> <div class=doc-md-description> <p>settings dictionary for the enabled project, empty if no settings or sync is disabled</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_sync_project_setting</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>exclude_locals</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>cached</span><span class=o>=</span><span class=kc>True</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot; Handles pulling sitesync&#39;s settings for enabled &#39;project_name&#39;</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): used in project settings</span>
<span class=sd>        exclude_locals (bool): ignore overrides from Local Settings</span>
<span class=sd>        cached (bool): use pre-cached values, or return fresh ones</span>
<span class=sd>            cached values needed for single loop (with all overrides)</span>
<span class=sd>            fresh values needed for Local settings (without overrides)</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict: settings dictionary for the enabled project,</span>
<span class=sd>            empty if no settings or sync is disabled</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># presets set already, do not call again and again</span>
    <span class=c1># self.log.debug(&quot;project preset {}&quot;.format(self.presets))</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>cached</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_sync_project_settings</span><span class=p>(</span><span class=n>exclude_locals</span><span class=p>)</span>\
            <span class=p>[</span><span class=n>project_name</span><span class=p>]</span>

    <span class=k>if</span> <span class=p>(</span>
        <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span>
        <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
    <span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>set_sync_project_settings</span><span class=p>(</span><span class=n>exclude_locals</span><span class=p>)</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_sync_representations class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_sync_representations</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>active_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Get representations that should be synced, these could be
recognised by presence of document in 'files.sites', where key is
a provider (GDrive, S3) and value is empty document or document
without 'created_dt' field. (Don't put null to 'created_dt'!).

Querying of 'to-be-synched' files is offloaded to Mongod for
better performance. Goal is to get as few representations as
possible.
</code></pre> <p>Args: project_name (str): active_site (str): identifier of current active site (could be 'local_0' when working from home, 'studio' when working in the studio (default) remote_site (str): identifier of remote site I want to sync to</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>list[dict]: Representation states.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@time_function</span>
<span class=k>def</span><span class=w> </span><span class=nf>get_sync_representations</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>active_site</span><span class=p>,</span> <span class=n>remote_site</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=mi>10</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Get representations that should be synced, these could be</span>
<span class=sd>        recognised by presence of document in &#39;files.sites&#39;, where key is</span>
<span class=sd>        a provider (GDrive, S3) and value is empty document or document</span>
<span class=sd>        without &#39;created_dt&#39; field. (Don&#39;t put null to &#39;created_dt&#39;!).</span>

<span class=sd>        Querying of &#39;to-be-synched&#39; files is offloaded to Mongod for</span>
<span class=sd>        better performance. Goal is to get as few representations as</span>
<span class=sd>        possible.</span>
<span class=sd>    Args:</span>
<span class=sd>        project_name (str):</span>
<span class=sd>        active_site (str): identifier of current active site (could be</span>
<span class=sd>            &#39;local_0&#39; when working from home, &#39;studio&#39; when working in the</span>
<span class=sd>            studio (default)</span>
<span class=sd>        remote_site (str): identifier of remote site I want to sync to</span>

<span class=sd>    Returns:</span>
<span class=sd>        list[dict]: Representation states.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Check representations for: </span><span class=si>{}</span><span class=s2>-</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=n>active_site</span><span class=p>,</span> <span class=n>remote_site</span>
    <span class=p>))</span>

    <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span>
    <span class=p>)</span>

    <span class=c1># get to upload</span>
    <span class=n>kwargs</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;localSite&quot;</span><span class=p>:</span> <span class=n>active_site</span><span class=p>,</span>
        <span class=s2>&quot;remoteSite&quot;</span><span class=p>:</span> <span class=n>remote_site</span><span class=p>,</span>
        <span class=s2>&quot;localStatusFilter&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>],</span>
        <span class=s2>&quot;remoteStatusFilter&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>QUEUED</span><span class=p>],</span>
    <span class=p>}</span>

    <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>200</span><span class=p>,</span> <span class=mi>204</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
            <span class=s2>&quot;Cannot get representations for sync with code </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>response</span><span class=o>.</span><span class=n>status_code</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=n>repre_states</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]</span>

    <span class=c1># get to download</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>repre_states</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>limit</span><span class=p>:</span>
        <span class=n>kwargs</span><span class=p>[</span><span class=s2>&quot;localStatusFilter&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>QUEUED</span><span class=p>]</span>
        <span class=n>kwargs</span><span class=p>[</span><span class=s2>&quot;remoteStatusFilter&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span><span class=p>]</span>

        <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=n>repre_states</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>])</span>

    <span class=k>return</span> <span class=n>repre_states</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.get_version_availability class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_version_availability</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>version_ids</span><span class=p>,</span> <span class=n>local_site_name</span><span class=p>,</span> <span class=n>remote_site_name</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Returns aggregated state for version ids.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>version_ids</code> </td> <td> <code><span title=Iterable>Iterable</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Version ids.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>local_site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Local site name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>remote_site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Remote site name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>kwargs</code> </td> <td> </td> <td> <div class=doc-md-description> <p>All other parameters for <code>Get Site Sync State</code> endpoint if necessary.</p> </div> </td> <td> <code>{}</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>dict[str, tuple[float, float]]: Status by version id. Example: {version_id: (local_status, remote_status)}</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1923</span>
<span class=normal>1924</span>
<span class=normal>1925</span>
<span class=normal>1926</span>
<span class=normal>1927</span>
<span class=normal>1928</span>
<span class=normal>1929</span>
<span class=normal>1930</span>
<span class=normal>1931</span>
<span class=normal>1932</span>
<span class=normal>1933</span>
<span class=normal>1934</span>
<span class=normal>1935</span>
<span class=normal>1936</span>
<span class=normal>1937</span>
<span class=normal>1938</span>
<span class=normal>1939</span>
<span class=normal>1940</span>
<span class=normal>1941</span>
<span class=normal>1942</span>
<span class=normal>1943</span>
<span class=normal>1944</span>
<span class=normal>1945</span>
<span class=normal>1946</span>
<span class=normal>1947</span>
<span class=normal>1948</span>
<span class=normal>1949</span>
<span class=normal>1950</span>
<span class=normal>1951</span>
<span class=normal>1952</span>
<span class=normal>1953</span>
<span class=normal>1954</span>
<span class=normal>1955</span>
<span class=normal>1956</span>
<span class=normal>1957</span>
<span class=normal>1958</span>
<span class=normal>1959</span>
<span class=normal>1960</span>
<span class=normal>1961</span>
<span class=normal>1962</span>
<span class=normal>1963</span>
<span class=normal>1964</span>
<span class=normal>1965</span>
<span class=normal>1966</span>
<span class=normal>1967</span>
<span class=normal>1968</span>
<span class=normal>1969</span>
<span class=normal>1970</span>
<span class=normal>1971</span>
<span class=normal>1972</span>
<span class=normal>1973</span>
<span class=normal>1974</span>
<span class=normal>1975</span>
<span class=normal>1976</span>
<span class=normal>1977</span>
<span class=normal>1978</span>
<span class=normal>1979</span>
<span class=normal>1980</span>
<span class=normal>1981</span>
<span class=normal>1982</span>
<span class=normal>1983</span>
<span class=normal>1984</span>
<span class=normal>1985</span>
<span class=normal>1986</span>
<span class=normal>1987</span>
<span class=normal>1988</span>
<span class=normal>1989</span>
<span class=normal>1990</span>
<span class=normal>1991</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_version_availability</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>version_ids</span><span class=p>,</span>
    <span class=n>local_site_name</span><span class=p>,</span>
    <span class=n>remote_site_name</span><span class=p>,</span>
    <span class=o>**</span><span class=n>kwargs</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns aggregated state for version ids.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>
<span class=sd>        version_ids (Iterable[str]): Version ids.</span>
<span class=sd>        local_site_name (str): Local site name.</span>
<span class=sd>        remote_site_name (str): Remote site name.</span>
<span class=sd>        kwargs: All other parameters for `Get Site Sync State` endpoint if</span>
<span class=sd>            necessary.</span>

<span class=sd>    Returns:</span>
<span class=sd>        dict[str, tuple[float, float]]: Status by version id.</span>
<span class=sd>            Example: {version_id: (local_status, remote_status)}</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>version_ids</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>version_ids</span><span class=p>)</span>
    <span class=n>payload_dict</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;localSite&quot;</span><span class=p>:</span> <span class=n>local_site_name</span><span class=p>,</span>
        <span class=s2>&quot;remoteSite&quot;</span><span class=p>:</span> <span class=n>remote_site_name</span><span class=p>,</span>
        <span class=s2>&quot;versionIdsFilter&quot;</span><span class=p>:</span> <span class=n>version_ids</span>
    <span class=p>}</span>
    <span class=n>payload_dict</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>

    <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span> <span class=n>project_name</span>
    <span class=p>)</span>

    <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>payload_dict</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
            <span class=s2>&quot;Cannot get sync state for versions </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>version_ids</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=n>version_statuses</span> <span class=o>=</span> <span class=p>{</span>
        <span class=n>version_id</span><span class=p>:</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>version_id</span> <span class=ow>in</span> <span class=n>version_ids</span>
    <span class=p>}</span>

    <span class=n>repre_avail_by_version_id</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>repre_avail</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;representations&quot;</span><span class=p>]:</span>
        <span class=n>version_id</span> <span class=o>=</span> <span class=n>repre_avail</span><span class=p>[</span><span class=s2>&quot;versionId&quot;</span><span class=p>]</span>
        <span class=n>repre_avail_by_version_id</span><span class=p>[</span><span class=n>version_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>repre_avail</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>version_id</span><span class=p>,</span> <span class=n>repre_avails</span> <span class=ow>in</span> <span class=n>repre_avail_by_version_id</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=n>avail_local</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
            <span class=nb>int</span><span class=p>(</span>
                <span class=n>repre_avail</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
            <span class=p>)</span>
            <span class=k>for</span> <span class=n>repre_avail</span> <span class=ow>in</span> <span class=n>repre_avails</span>
        <span class=p>)</span>
        <span class=n>avail_remote</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span>
            <span class=nb>int</span><span class=p>(</span>
                <span class=n>repre_avail</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
            <span class=p>)</span>
            <span class=k>for</span> <span class=n>repre_avail</span> <span class=ow>in</span> <span class=n>repre_avails</span>
        <span class=p>)</span>
        <span class=n>version_statuses</span><span class=p>[</span><span class=n>version_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>avail_local</span><span class=p>,</span> <span class=n>avail_remote</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>version_statuses</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.handle_alternate_site class="doc doc-heading"> <code class="highlight language-python"><span class=n>handle_alternate_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>processed_site</span><span class=p>,</span> <span class=n>file_id</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>For special use cases where one site vendors another.</p> <p>Current use case is sftp site vendoring (exposing) same data as regular site (studio). Each site is accessible for different audience. 'studio' for artists in a studio, 'sftp' for externals.</p> <p>Change of file status on one site actually means same change on 'alternate' site. (eg. artists publish to 'studio', 'sftp' is using same location &gt;&gt; file is accessible on 'sftp' site right away.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Representation id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>processed_site</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Real site_name of published/uploaded file</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>file_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>File id of file handled.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>913</span>
<span class=normal>914</span>
<span class=normal>915</span>
<span class=normal>916</span>
<span class=normal>917</span>
<span class=normal>918</span>
<span class=normal>919</span>
<span class=normal>920</span>
<span class=normal>921</span>
<span class=normal>922</span>
<span class=normal>923</span>
<span class=normal>924</span>
<span class=normal>925</span>
<span class=normal>926</span>
<span class=normal>927</span>
<span class=normal>928</span>
<span class=normal>929</span>
<span class=normal>930</span>
<span class=normal>931</span>
<span class=normal>932</span>
<span class=normal>933</span>
<span class=normal>934</span>
<span class=normal>935</span>
<span class=normal>936</span>
<span class=normal>937</span>
<span class=normal>938</span>
<span class=normal>939</span>
<span class=normal>940</span>
<span class=normal>941</span>
<span class=normal>942</span>
<span class=normal>943</span>
<span class=normal>944</span>
<span class=normal>945</span>
<span class=normal>946</span>
<span class=normal>947</span>
<span class=normal>948</span>
<span class=normal>949</span>
<span class=normal>950</span>
<span class=normal>951</span>
<span class=normal>952</span>
<span class=normal>953</span>
<span class=normal>954</span>
<span class=normal>955</span>
<span class=normal>956</span>
<span class=normal>957</span>
<span class=normal>958</span>
<span class=normal>959</span>
<span class=normal>960</span>
<span class=normal>961</span>
<span class=normal>962</span>
<span class=normal>963</span>
<span class=normal>964</span>
<span class=normal>965</span>
<span class=normal>966</span>
<span class=normal>967</span>
<span class=normal>968</span>
<span class=normal>969</span>
<span class=normal>970</span>
<span class=normal>971</span>
<span class=normal>972</span>
<span class=normal>973</span>
<span class=normal>974</span>
<span class=normal>975</span>
<span class=normal>976</span>
<span class=normal>977</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>handle_alternate_site</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>processed_site</span><span class=p>,</span> <span class=n>file_id</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    For special use cases where one site vendors another.</span>

<span class=sd>    Current use case is sftp site vendoring (exposing) same data as</span>
<span class=sd>    regular site (studio). Each site is accessible for different</span>
<span class=sd>    audience. &#39;studio&#39; for artists in a studio, &#39;sftp&#39; for externals.</span>

<span class=sd>    Change of file status on one site actually means same change on</span>
<span class=sd>    &#39;alternate&#39; site. (eg. artists publish to &#39;studio&#39;, &#39;sftp&#39; is using</span>
<span class=sd>    same location &gt;&gt; file is accessible on &#39;sftp&#39; site right away.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>
<span class=sd>        representation_id (str): Representation id.</span>
<span class=sd>        processed_site (str): Real site_name of published/uploaded file</span>
<span class=sd>        file_id (str): File id of file handled.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sites</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_transform_sites_from_settings</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>sync_studio_settings</span><span class=p>)</span>
    <span class=n>sites</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>DEFAULT_SITE</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;provider&quot;</span><span class=p>:</span> <span class=s2>&quot;local_drive&quot;</span><span class=p>,</span>
        <span class=s2>&quot;alternative_sites&quot;</span><span class=p>:</span> <span class=p>[]</span>
    <span class=p>}</span>

    <span class=n>alternate_sites</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>site_info</span> <span class=ow>in</span> <span class=n>sites</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=n>conf_alternative_sites</span> <span class=o>=</span> <span class=n>site_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;alternative_sites&quot;</span><span class=p>,</span> <span class=p>[])</span>
        <span class=k>if</span> <span class=n>processed_site</span> <span class=ow>in</span> <span class=n>conf_alternative_sites</span><span class=p>:</span>
            <span class=n>alternate_sites</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>
            <span class=k>continue</span>
        <span class=k>if</span> <span class=n>processed_site</span> <span class=o>==</span> <span class=n>site_name</span> <span class=ow>and</span> <span class=n>conf_alternative_sites</span><span class=p>:</span>
            <span class=n>alternate_sites</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>conf_alternative_sites</span><span class=p>)</span>
            <span class=k>continue</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>alternate_sites</span><span class=p>:</span>
        <span class=k>return</span>

    <span class=n>sync_state</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_repre_sync_state</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_id</span><span class=p>,</span>
        <span class=n>processed_site</span>
    <span class=p>)</span>
    <span class=c1># not yet available on processed_site, wont update alternate site yet</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>sync_state</span><span class=p>:</span>
        <span class=k>return</span>
    <span class=k>for</span> <span class=n>file_info</span> <span class=ow>in</span> <span class=n>sync_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]:</span>
        <span class=c1># expose status of remote site, it is expected on the server</span>
        <span class=n>file_info</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>file_info</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>][</span><span class=s2>&quot;status&quot;</span><span class=p>]</span>

    <span class=n>payload_dict</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;files&quot;</span><span class=p>:</span> <span class=n>sync_state</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]}</span>

    <span class=n>alternate_sites</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>alternate_sites</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>alt_site</span> <span class=ow>in</span> <span class=n>alternate_sites</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Adding alternate </span><span class=si>{}</span><span class=s2> to </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>alt_site</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>))</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_set_state_sync_state</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>representation_id</span><span class=p>,</span>
            <span class=n>alt_site</span><span class=p>,</span>
            <span class=n>payload_dict</span>
        <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.initialize class="doc doc-heading"> <code class="highlight language-python"><span class=n>initialize</span><span class=p>(</span><span class=n>addon_settings</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Called during Addon Manager creation.</p> <p>Collects needed data, checks asyncio presence. Sets 'enabled' according to global settings for the addon. Shouldn't be doing any initialization, that's a job for 'tray_init'</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>initialize</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>addon_settings</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Called during Addon Manager creation.</span>

<span class=sd>    Collects needed data, checks asyncio presence.</span>
<span class=sd>    Sets &#39;enabled&#39; according to global settings for the addon.</span>
<span class=sd>    Shouldn&#39;t be doing any initialization, that&#39;s a job for &#39;tray_init&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># some parts of code need to run sequentially, not in async</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_sync_studio_settings</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=c1># settings for all enabled projects for sync</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_sync_project_settings</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># asyncio requires new thread</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_paused</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_paused_projects</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_paused_representations</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_anatomies</span> <span class=o>=</span> <span class=p>{}</span>

    <span class=c1># list of long blocking tasks</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>long_running_tasks</span> <span class=o>=</span> <span class=n>deque</span><span class=p>()</span>
    <span class=c1># projects that long tasks are running on</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>projects_processed</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.is_paused class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_paused</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Is server paused</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>is_paused</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot; Is server paused &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_paused</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.is_project_enabled class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_project_enabled</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>single</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Checks if 'project_name' is enabled for syncing. 'get_sync_project_setting' is potentially expensive operation (pulls settings for all projects if cached version is not available), using project_settings for specific project should be faster. Args: project_name (str) single (bool): use 'get_addon_project_settings' method</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>893</span>
<span class=normal>894</span>
<span class=normal>895</span>
<span class=normal>896</span>
<span class=normal>897</span>
<span class=normal>898</span>
<span class=normal>899</span>
<span class=normal>900</span>
<span class=normal>901</span>
<span class=normal>902</span>
<span class=normal>903</span>
<span class=normal>904</span>
<span class=normal>905</span>
<span class=normal>906</span>
<span class=normal>907</span>
<span class=normal>908</span>
<span class=normal>909</span>
<span class=normal>910</span>
<span class=normal>911</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>is_project_enabled</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>single</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Checks if &#39;project_name&#39; is enabled for syncing.</span>
<span class=sd>    &#39;get_sync_project_setting&#39; is potentially expensive operation (pulls</span>
<span class=sd>    settings for all projects if cached version is not available), using</span>
<span class=sd>    project_settings for specific project should be faster.</span>
<span class=sd>    Args:</span>
<span class=sd>        project_name (str)</span>
<span class=sd>        single (bool): use &#39;get_addon_project_settings&#39; method</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>single</span><span class=p>:</span>
            <span class=n>project_settings</span> <span class=o>=</span> <span class=n>get_addon_project_settings</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>version</span><span class=p>,</span> <span class=n>project_name</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>project_settings</span> <span class=ow>and</span> <span class=n>project_settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enabled&quot;</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>True</span>
    <span class=k>return</span> <span class=kc>False</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.is_project_paused class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_project_paused</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>check_parents</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Is project sync paused.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>check_parents</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>check if server itself is not paused</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> </td> <td> <div class=doc-md-description> <p>Is project paused.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span>
<span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span>
<span class=normal>675</span>
<span class=normal>676</span>
<span class=normal>677</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>is_project_paused</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>check_parents</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Is project sync paused.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str):</span>
<span class=sd>        check_parents (bool): check if server itself</span>
<span class=sd>            is not paused</span>

<span class=sd>    Returns:</span>
<span class=sd>        bool: Is project paused.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>is_paused</span> <span class=o>=</span> <span class=n>project_name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_paused_projects</span>
    <span class=k>if</span> <span class=n>check_parents</span><span class=p>:</span>
        <span class=n>is_paused</span> <span class=o>=</span> <span class=n>is_paused</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_paused</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>is_paused</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.is_representation_on_site class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_representation_on_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>max_retries</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Check if representation has all files available on site.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> </td> <td> <div class=doc-md-description> <p>True if representation has all files correctly on the site.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>823</span>
<span class=normal>824</span>
<span class=normal>825</span>
<span class=normal>826</span>
<span class=normal>827</span>
<span class=normal>828</span>
<span class=normal>829</span>
<span class=normal>830</span>
<span class=normal>831</span>
<span class=normal>832</span>
<span class=normal>833</span>
<span class=normal>834</span>
<span class=normal>835</span>
<span class=normal>836</span>
<span class=normal>837</span>
<span class=normal>838</span>
<span class=normal>839</span>
<span class=normal>840</span>
<span class=normal>841</span>
<span class=normal>842</span>
<span class=normal>843</span>
<span class=normal>844</span>
<span class=normal>845</span>
<span class=normal>846</span>
<span class=normal>847</span>
<span class=normal>848</span>
<span class=normal>849</span>
<span class=normal>850</span>
<span class=normal>851</span>
<span class=normal>852</span>
<span class=normal>853</span>
<span class=normal>854</span>
<span class=normal>855</span>
<span class=normal>856</span>
<span class=normal>857</span>
<span class=normal>858</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>is_representation_on_site</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>max_retries</span><span class=o>=</span><span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Check if representation has all files available on site.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str)</span>
<span class=sd>        representation_id (str)</span>
<span class=sd>        site_name (str)</span>
<span class=sd>        max_retries (int) (optional) - provide only if method used in while</span>
<span class=sd>            loop to bail out</span>

<span class=sd>    Returns:</span>
<span class=sd>        bool: True if representation has all files correctly on the site.</span>

<span class=sd>    Raises:</span>
<span class=sd>          ValueError  Only If &#39;max_retries&#39; provided if upload/download</span>
<span class=sd>            failed too many times to limit infinite loop check.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>representation_status</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_repre_sync_state</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>representation_status</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=k>if</span> <span class=n>site_name</span> <span class=o>==</span> <span class=n>get_local_site_id</span><span class=p>():</span>
        <span class=n>status</span> <span class=o>=</span> <span class=n>representation_status</span><span class=p>[</span><span class=s2>&quot;localStatus&quot;</span><span class=p>]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>status</span> <span class=o>=</span> <span class=n>representation_status</span><span class=p>[</span><span class=s2>&quot;remoteStatus&quot;</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>max_retries</span><span class=p>:</span>
        <span class=n>tries</span> <span class=o>=</span> <span class=n>status</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;retries&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>tries</span> <span class=o>&gt;=</span> <span class=n>max_retries</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Failed too many times&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>status</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.is_representation_paused class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_representation_paused</span><span class=p>(</span><span class=n>representation_id</span><span class=p>,</span> <span class=n>check_parents</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>project_name</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Is representation paused.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>representation_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Representation id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>check_parents</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Check if parent project or server itself are not paused.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project to check if paused.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> </td> <td> <div class=doc-md-description> <p>Is representation paused now.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>is_representation_paused</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>check_parents</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>project_name</span><span class=o>=</span><span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Is representation paused.</span>

<span class=sd>    Args:</span>
<span class=sd>        representation_id (str): Representation id.</span>
<span class=sd>        check_parents (bool): Check if parent project or server itself</span>
<span class=sd>            are not paused.</span>
<span class=sd>        project_name (str): Project to check if paused.</span>

<span class=sd>        if &#39;check_parents&#39;, &#39;project_name&#39; should be set too</span>

<span class=sd>    Returns:</span>
<span class=sd>        bool: Is representation paused now.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>is_paused</span> <span class=o>=</span> <span class=n>representation_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_paused_representations</span>
    <span class=k>if</span> <span class=n>check_parents</span> <span class=ow>and</span> <span class=n>project_name</span><span class=p>:</span>
        <span class=n>is_paused</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>is_paused</span>
            <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_project_paused</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
            <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_paused</span><span class=p>()</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=n>is_paused</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.pause_project class="doc doc-heading"> <code class="highlight language-python"><span class=n>pause_project</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Pause sync of whole project.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>pause_project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Pause sync of whole project.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Pausing SiteSync for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>project_name</span><span class=p>))</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_paused_projects</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.pause_representation class="doc doc-heading"> <code class="highlight language-python"><span class=n>pause_representation</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Pause sync of representation entity on site.</p> <p>Sets 'representation_id' as paused, eg. no syncing should be happening on it.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Representation id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Site name 'gdrive', 'studio' etc.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>pause_representation</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Pause sync of representation entity on site.</span>

<span class=sd>    Sets &#39;representation_id&#39; as paused, eg. no syncing should be</span>
<span class=sd>        happening on it.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>
<span class=sd>        representation_id (str): Representation id.</span>
<span class=sd>        site_name (str): Site name &#39;gdrive&#39;, &#39;studio&#39; etc.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Pausing SiteSync for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>representation_id</span><span class=p>))</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_paused_representations</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>representation_id</span><span class=p>)</span>
    <span class=n>repre_entity</span> <span class=o>=</span> <span class=n>get_representation_by_id</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span>
    <span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>update_db</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>repre_entity</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>pause</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.pause_server class="doc doc-heading"> <code class="highlight language-python"><span class=n>pause_server</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Pause sync server.</p> <p>It won't check anything, not uploading/downloading...</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>pause_server</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Pause sync server.</span>

<span class=sd>    It won&#39;t check anything, not uploading/downloading...</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Pausing SiteSync&quot;</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_paused</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.remove_site class="doc doc-heading"> <code class="highlight language-python"><span class=n>remove_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>remove_local_files</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Removes site for particular representation in project.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>project name (must match DB)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>MongoDB _id value</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>name of configured and active site</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>remove_local_files</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>remove only files for 'local_id' site</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>Throws if any issue.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>remove_site</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>representation_id</span><span class=p>,</span>
    <span class=n>site_name</span><span class=p>,</span>
    <span class=n>remove_local_files</span><span class=o>=</span><span class=kc>False</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Removes site for particular representation in project.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): project name (must match DB)</span>
<span class=sd>        representation_id (str): MongoDB _id value</span>
<span class=sd>        site_name (str): name of configured and active site</span>
<span class=sd>        remove_local_files (bool): remove only files for &#39;local_id&#39;</span>
<span class=sd>            site</span>

<span class=sd>    Raises:</span>
<span class=sd>        ValueError: Throws if any issue.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_sync_project_setting</span><span class=p>(</span><span class=n>project_name</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Project not configured&quot;</span><span class=p>)</span>

    <span class=n>sync_info</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_repre_sync_state</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_id</span><span class=p>,</span>
        <span class=n>site_name</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>sync_info</span><span class=p>:</span>
        <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Site </span><span class=si>{}</span><span class=s2> not found&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>site_name</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
        <span class=k>return</span>

    <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state/</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_id</span><span class=p>,</span>
        <span class=n>site_name</span>
    <span class=p>)</span>

    <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>endpoint</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>200</span><span class=p>,</span> <span class=mi>204</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Cannot update status&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>remove_local_files</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_remove_local_file</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.reset_site_on_representation class="doc doc-heading"> <code class="highlight language-python"><span class=n>reset_site_on_representation</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>side</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>site_name</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <pre><code>Reset information about synchronization for particular 'file_id'
and provider.
Useful for testing or forcing file to be reuploaded.

'side' and 'site_name' are disjunctive.

'side' is used for resetting local or remote side for
current user for repre.

'site_name' is used to set synchronization for particular site.
Should be used when repre should be synced to new site.
</code></pre> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>name of project (eg. collection) in DB</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Representation id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>file_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>File id in representation.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>side</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Local or remote side.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>for adding new site</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span>
<span class=normal>1579</span>
<span class=normal>1580</span>
<span class=normal>1581</span>
<span class=normal>1582</span>
<span class=normal>1583</span>
<span class=normal>1584</span>
<span class=normal>1585</span>
<span class=normal>1586</span>
<span class=normal>1587</span>
<span class=normal>1588</span>
<span class=normal>1589</span>
<span class=normal>1590</span>
<span class=normal>1591</span>
<span class=normal>1592</span>
<span class=normal>1593</span>
<span class=normal>1594</span>
<span class=normal>1595</span>
<span class=normal>1596</span>
<span class=normal>1597</span>
<span class=normal>1598</span>
<span class=normal>1599</span>
<span class=normal>1600</span>
<span class=normal>1601</span>
<span class=normal>1602</span>
<span class=normal>1603</span>
<span class=normal>1604</span>
<span class=normal>1605</span>
<span class=normal>1606</span>
<span class=normal>1607</span>
<span class=normal>1608</span>
<span class=normal>1609</span>
<span class=normal>1610</span>
<span class=normal>1611</span>
<span class=normal>1612</span>
<span class=normal>1613</span>
<span class=normal>1614</span>
<span class=normal>1615</span>
<span class=normal>1616</span>
<span class=normal>1617</span>
<span class=normal>1618</span>
<span class=normal>1619</span>
<span class=normal>1620</span>
<span class=normal>1621</span>
<span class=normal>1622</span>
<span class=normal>1623</span>
<span class=normal>1624</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>reset_site_on_representation</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>representation_id</span><span class=p>,</span>
    <span class=n>side</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>site_name</span><span class=o>=</span><span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Reset information about synchronization for particular &#39;file_id&#39;</span>
<span class=sd>        and provider.</span>
<span class=sd>        Useful for testing or forcing file to be reuploaded.</span>

<span class=sd>        &#39;side&#39; and &#39;site_name&#39; are disjunctive.</span>

<span class=sd>        &#39;side&#39; is used for resetting local or remote side for</span>
<span class=sd>        current user for repre.</span>

<span class=sd>        &#39;site_name&#39; is used to set synchronization for particular site.</span>
<span class=sd>        Should be used when repre should be synced to new site.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): name of project (eg. collection) in DB</span>
<span class=sd>        representation_id (str): Representation id.</span>
<span class=sd>        file_id (str): File id in representation.</span>
<span class=sd>        side (str): Local or remote side.</span>
<span class=sd>        site_name (str): for adding new site</span>

<span class=sd>    Raises:</span>
<span class=sd>        SiteAlreadyPresentError - if adding already existing site and</span>
<span class=sd>            not &#39;force&#39;</span>
<span class=sd>        ValueError - other errors (repre not found, misconfiguration)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>representation</span> <span class=o>=</span> <span class=n>get_representation_by_id</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>representation</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;Representation </span><span class=si>{}</span><span class=s2> not found in </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>representation_id</span><span class=p>,</span> <span class=n>project_name</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>side</span> <span class=ow>and</span> <span class=n>site_name</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;Misconfiguration, only one of side and&quot;</span>
            <span class=s2>&quot; site_name arguments should be passed.&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>side</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>side</span> <span class=o>==</span> <span class=s2>&quot;local&quot;</span><span class=p>:</span>
            <span class=n>site_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_active_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>site_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_remote_site</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>add_site</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>file_id</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.reset_timer class="doc doc-heading"> <code class="highlight language-python"><span class=n>reset_timer</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Called when waiting for next loop should be skipped.</p> <p>In case of user's involvement (reset site), start that right away.</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2057</span>
<span class=normal>2058</span>
<span class=normal>2059</span>
<span class=normal>2060</span>
<span class=normal>2061</span>
<span class=normal>2062</span>
<span class=normal>2063</span>
<span class=normal>2064</span>
<span class=normal>2065</span>
<span class=normal>2066</span>
<span class=normal>2067</span>
<span class=normal>2068</span>
<span class=normal>2069</span>
<span class=normal>2070</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>reset_timer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Called when waiting for next loop should be skipped.</span>

<span class=sd>        In case of user&#39;s involvement (reset site), start that right away.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
        <span class=k>return</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_reset_timer_with_rest_api</span><span class=p>()</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span><span class=o>.</span><span class=n>reset_timer</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.server_init class="doc doc-heading"> <code class="highlight language-python"><span class=n>server_init</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Actual initialization of Sync Server.</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>server_init</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Actual initialization of Sync Server.&quot;&quot;&quot;</span>
    <span class=c1># import only in tray or Python3, because of Python2 hosts</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
        <span class=k>return</span>

    <span class=kn>from</span><span class=w> </span><span class=nn>.sitesync</span><span class=w> </span><span class=kn>import</span> <span class=n>SiteSyncThread</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>sitesync_thread</span> <span class=o>=</span> <span class=n>SiteSyncThread</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.set_sync_project_settings class="doc doc-heading"> <code class="highlight language-python"><span class=n>set_sync_project_settings</span><span class=p>(</span><span class=n>exclude_locals</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Set sync_project_settings for all projects (caching) Args: exclude_locals (bool): ignore overrides from Local Settings For performance</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>set_sync_project_settings</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exclude_locals</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Set sync_project_settings for all projects (caching)</span>
<span class=sd>        Args:</span>
<span class=sd>            exclude_locals (bool): ignore overrides from Local Settings</span>
<span class=sd>        For performance</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sync_project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_sync_project_settings</span><span class=p>(</span>
        <span class=n>exclude_locals</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_sync_project_settings</span> <span class=o>=</span> <span class=n>sync_project_settings</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.tray_exit class="doc doc-heading"> <code class="highlight language-python"><span class=n>tray_exit</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Stops sync thread if running.</p> <p>Called from Addon Manager</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>tray_exit</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Stops sync thread if running.</span>

<span class=sd>    Called from Addon Manager</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>server_exit</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.tray_init class="doc doc-heading"> <code class="highlight language-python"><span class=n>tray_init</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Initialization of Site Sync Server for Tray.</p> <p>Called when tray is initialized, it checks if addon should be enabled. If not, no initialization necessary.</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>tray_init</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialization of Site Sync Server for Tray.</span>

<span class=sd>    Called when tray is initialized, it checks if addon should be</span>
<span class=sd>    enabled. If not, no initialization necessary.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>server_init</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.tray_start class="doc doc-heading"> <code class="highlight language-python"><span class=n>tray_start</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Triggered when Tray is started.</p> <p>Checks if configuration presets are available and if there is any provider ('gdrive', 'S3') that is activated (eg. has valid credentials).</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>tray_start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Triggered when Tray is started.</span>

<span class=sd>    Checks if configuration presets are available and if there is</span>
<span class=sd>    any provider (&#39;gdrive&#39;, &#39;S3&#39;) that is activated</span>
<span class=sd>    (eg. has valid credentials).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>server_start</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.unpause_project class="doc doc-heading"> <code class="highlight language-python"><span class=n>unpause_project</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Unpause sync of whole project.</p> <p>Does not fail or warn if project wasn't paused.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>unpause_project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Unpause sync of whole project.</span>

<span class=sd>    Does not fail or warn if project wasn&#39;t paused.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Unpausing SiteSync for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>project_name</span><span class=p>))</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_paused_projects</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
    <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
        <span class=k>pass</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.unpause_representation class="doc doc-heading"> <code class="highlight language-python"><span class=n>unpause_representation</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Unpause sync of representation entity on site.</p> <p>Does not fail or warn if repre wasn't paused.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>representation_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Representation id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Site name 'gdrive', 'studio' etc.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>unpause_representation</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span><span class=p>,</span> <span class=n>site_name</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Unpause sync of representation entity on site.</span>

<span class=sd>    Does not fail or warn if repre wasn&#39;t paused.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name.</span>
<span class=sd>        representation_id (str): Representation id.</span>
<span class=sd>        site_name (str): Site name &#39;gdrive&#39;, &#39;studio&#39; etc.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Unpausing SiteSync for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>representation_id</span><span class=p>))</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_paused_representations</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>representation_id</span><span class=p>)</span>
    <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
        <span class=k>pass</span>
    <span class=c1># self.paused_representations is not persistent</span>
    <span class=n>repre_entity</span> <span class=o>=</span> <span class=n>get_representation_by_id</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>representation_id</span>
    <span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>update_db</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>repre_entity</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>pause</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.unpause_server class="doc doc-heading"> <code class="highlight language-python"><span class=n>unpause_server</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Unpause server sync.</p> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>unpause_server</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Unpause server sync.&quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Unpausing SiteSync&quot;</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_paused</span> <span class=o>=</span> <span class=kc>False</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.update_db class="doc doc-heading"> <code class="highlight language-python"><span class=n>update_db</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>repre_status</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>new_file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>file</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>side</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>progress</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>priority</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>pause</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Update 'provider' portion of records in DB.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Project name. Force to db connection as each file might come from different collection.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>repre_status</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Representation status from sitesync database.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Site name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>new_file_id</code> </td> <td> <code><span title=Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>File id of new file.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>file</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>info about processed file (pulled from DB)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>side</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>'local' | 'remote'</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>error</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>exception message</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>progress</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>0-1 of progress of upload/download</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>priority</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>0-100 set priority</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>pause</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>stop synchronizing (only before starting of download, upload)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>None</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span>
<span class=normal>1475</span>
<span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span>
<span class=normal>1499</span>
<span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span>
<span class=normal>1511</span>
<span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span>
<span class=normal>1526</span>
<span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>update_db</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>project_name</span><span class=p>,</span>
    <span class=n>repre_status</span><span class=p>,</span>
    <span class=n>site_name</span><span class=p>,</span>
    <span class=n>new_file_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>file</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>side</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>error</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>progress</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>priority</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>pause</span><span class=o>=</span><span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Update &#39;provider&#39; portion of records in DB.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): Project name. Force to db connection as</span>
<span class=sd>            each file might come from different collection.</span>
<span class=sd>        repre_status (dict): Representation status from sitesync database.</span>
<span class=sd>        site_name (str): Site name.</span>
<span class=sd>        new_file_id (Optional[str]): File id of new file.</span>
<span class=sd>        file (dict[str, Any]): info about processed file (pulled from DB)</span>
<span class=sd>        side (str): &#39;local&#39; | &#39;remote&#39;</span>
<span class=sd>        error (str): exception message</span>
<span class=sd>        progress (float): 0-1 of progress of upload/download</span>
<span class=sd>        priority (int): 0-100 set priority</span>
<span class=sd>        pause (bool): stop synchronizing (only before starting of download,</span>
<span class=sd>            upload)</span>

<span class=sd>    Returns:</span>
<span class=sd>        None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>files_status</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>file_status</span> <span class=ow>in</span> <span class=n>repre_status</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]:</span>
        <span class=n>status_entity</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span>
            <span class=n>file_status</span><span class=p>[</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2>Status&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>side</span><span class=p>)]</span>
        <span class=p>)</span>
        <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;fileHash&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>file_status</span><span class=p>[</span><span class=s2>&quot;fileHash&quot;</span><span class=p>]</span>
        <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>file_status</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>file_status</span><span class=p>[</span><span class=s2>&quot;fileHash&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>file</span><span class=p>[</span><span class=s2>&quot;fileHash&quot;</span><span class=p>]:</span>
            <span class=k>if</span> <span class=n>new_file_id</span><span class=p>:</span>
                <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
                <span class=n>status_entity</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;message&quot;</span><span class=p>)</span>
                <span class=n>status_entity</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;retries&quot;</span><span class=p>)</span>
            <span class=k>elif</span> <span class=n>progress</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>IN_PROGRESS</span>
                <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;progress&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>progress</span>
            <span class=k>elif</span> <span class=n>error</span><span class=p>:</span>
                <span class=n>max_retries</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>sync_project_settings</span>
                    <span class=p>[</span><span class=n>project_name</span><span class=p>]</span>
                    <span class=p>[</span><span class=s2>&quot;config&quot;</span><span class=p>]</span>
                    <span class=p>[</span><span class=s2>&quot;retry_cnt&quot;</span><span class=p>]</span>
                <span class=p>)</span>
                <span class=n>tries</span> <span class=o>=</span> <span class=n>status_entity</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;retries&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
                <span class=n>tries</span> <span class=o>+=</span> <span class=mi>1</span>
                <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;retries&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>tries</span>
                <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>error</span>
                <span class=k>if</span> <span class=n>tries</span> <span class=o>&gt;=</span> <span class=n>max_retries</span><span class=p>:</span>
                    <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>FAILED</span>
            <span class=k>elif</span> <span class=n>pause</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>pause</span><span class=p>:</span>
                    <span class=n>status_entity</span><span class=p>[</span><span class=s2>&quot;pause&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>status_entity</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s2>&quot;pause&quot;</span><span class=p>)</span>
            <span class=n>files_status</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>status_entity</span><span class=p>)</span>

    <span class=n>representation_id</span> <span class=o>=</span> <span class=n>repre_status</span><span class=p>[</span><span class=s2>&quot;representationId&quot;</span><span class=p>]</span>

    <span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>/state/</span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>endpoint_prefix</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>representation_id</span><span class=p>,</span>
        <span class=n>site_name</span><span class=p>)</span>

    <span class=c1># get to upload</span>
    <span class=n>kwargs</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;files&quot;</span><span class=p>:</span> <span class=n>files_status</span>
    <span class=p>}</span>

    <span class=k>if</span> <span class=n>priority</span><span class=p>:</span>
        <span class=n>kwargs</span><span class=p>[</span><span class=s2>&quot;priority&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>priority</span>

    <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>200</span><span class=p>,</span> <span class=mi>204</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Cannot update status&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>progress</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>priority</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>return</span>

    <span class=n>status</span> <span class=o>=</span> <span class=s2>&quot;failed&quot;</span>
    <span class=n>error_str</span> <span class=o>=</span> <span class=s2>&quot;with error </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>new_file_id</span><span class=p>:</span>
        <span class=n>status</span> <span class=o>=</span> <span class=s2>&quot;succeeded with id </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>new_file_id</span><span class=p>)</span>
        <span class=n>error_str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>

    <span class=n>source_file</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
        <span class=s2>&quot;File for </span><span class=si>{}</span><span class=s2> - </span><span class=si>{source_file}</span><span class=s2> process </span><span class=si>{status}</span><span class=s2> </span><span class=si>{error_str}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>representation_id</span><span class=p>,</span>
            <span class=n>status</span><span class=o>=</span><span class=n>status</span><span class=p>,</span>
            <span class=n>source_file</span><span class=o>=</span><span class=n>source_file</span><span class=p>,</span>
            <span class=n>error_str</span><span class=o>=</span><span class=n>error_str</span>
        <span class=p>)</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_sitesync.addon.SiteSyncAddon.validate_project class="doc doc-heading"> <code class="highlight language-python"><span class=n>validate_project</span><span class=p>(</span><span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>reset_missing</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Validate 'project_name' of 'site_name' and its local files</p> <p>If file present and not marked with a 'site_name' in DB, DB is updated with site name and file modified date.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>project name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>site_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>active site name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>reset_missing</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>if True reset site in DB if missing physically to be resynched</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_sitesync/addon.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>validate_project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>reset_missing</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Validate &#39;project_name&#39; of &#39;site_name&#39; and its local files</span>

<span class=sd>    If file present and not marked with a &#39;site_name&#39; in DB, DB is</span>
<span class=sd>    updated with site name and file modified date.</span>

<span class=sd>    Args:</span>
<span class=sd>        project_name (str): project name</span>
<span class=sd>        site_name (str): active site name</span>
<span class=sd>        reset_missing (bool): if True reset site in DB if missing</span>
<span class=sd>            physically to be resynched</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Validation of </span><span class=si>{}</span><span class=s2> for </span><span class=si>{}</span><span class=s2> started&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span>
    <span class=p>))</span>
    <span class=n>repre_entities</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>get_representations</span><span class=p>(</span><span class=n>project_name</span><span class=p>))</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>repre_entities</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;No repre found&quot;</span><span class=p>)</span>
        <span class=k>return</span>

    <span class=n>sites_added</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>sites_reset</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>repre_ids</span> <span class=o>=</span> <span class=p>[</span><span class=n>repre</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>repre</span> <span class=ow>in</span> <span class=n>repre_entities</span><span class=p>]</span>
    <span class=n>repre_states</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_representations_sync_state</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>repre_ids</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>repre_entity</span> <span class=ow>in</span> <span class=n>repre_entities</span><span class=p>:</span>
        <span class=n>repre_id</span> <span class=o>=</span> <span class=n>repre_entity</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>
        <span class=n>is_on_site</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=n>repre_state</span> <span class=o>=</span> <span class=n>repre_states</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>repre_id</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>repre_state</span><span class=p>:</span>
            <span class=n>is_on_site</span> <span class=o>=</span> <span class=n>repre_state</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
        <span class=k>for</span> <span class=n>repre_file</span> <span class=ow>in</span> <span class=n>repre_entity</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;files&quot;</span><span class=p>,</span> <span class=p>[]):</span>
            <span class=n>file_path</span> <span class=o>=</span> <span class=n>repre_file</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
            <span class=n>local_file_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_local_file_path</span><span class=p>(</span>
                <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span><span class=p>,</span> <span class=n>file_path</span>
            <span class=p>)</span>

            <span class=n>file_exists</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>local_file_path</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>local_file_path</span><span class=p>)</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>is_on_site</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>file_exists</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                        <span class=sa>f</span><span class=s2>&quot;Adding presence on site &#39;</span><span class=si>{</span><span class=n>site_name</span><span class=si>}</span><span class=s2>&#39; for &quot;</span>
                        <span class=sa>f</span><span class=s2>&quot;&#39;</span><span class=si>{</span><span class=n>repre_id</span><span class=si>}</span><span class=s2>&#39;&quot;</span>
                    <span class=p>)</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>add_site</span><span class=p>(</span>
                        <span class=n>project_name</span><span class=p>,</span>
                        <span class=n>repre_id</span><span class=p>,</span>
                        <span class=n>site_name</span><span class=o>=</span><span class=n>site_name</span><span class=p>,</span>
                        <span class=n>file_id</span><span class=o>=</span><span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
                        <span class=n>force</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                        <span class=n>status</span><span class=o>=</span><span class=n>SiteSyncStatus</span><span class=o>.</span><span class=n>OK</span>
                    <span class=p>)</span>
                    <span class=n>sites_added</span> <span class=o>+=</span> <span class=mi>1</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>file_exists</span> <span class=ow>and</span> <span class=n>reset_missing</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                        <span class=s2>&quot;Resetting site </span><span class=si>{}</span><span class=s2> for </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                            <span class=n>site_name</span><span class=p>,</span> <span class=n>repre_id</span>
                        <span class=p>))</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>reset_site_on_representation</span><span class=p>(</span>
                        <span class=n>project_name</span><span class=p>,</span>
                        <span class=n>repre_id</span><span class=p>,</span>
                        <span class=n>site_name</span><span class=o>=</span><span class=n>site_name</span><span class=p>,</span>
                        <span class=n>file_id</span><span class=o>=</span><span class=n>repre_file</span><span class=p>[</span><span class=s2>&quot;_id&quot;</span><span class=p>]</span>
                    <span class=p>)</span>
                    <span class=n>sites_reset</span> <span class=o>+=</span> <span class=mi>1</span>

    <span class=k>if</span> <span class=n>sites_added</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Sites added </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>sites_added</span><span class=p>))</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Validation of </span><span class=si>{}</span><span class=s2> for </span><span class=si>{}</span><span class=s2> ended&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=n>project_name</span><span class=p>,</span> <span class=n>site_name</span>
    <span class=p>))</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Sites added </span><span class=si>{}</span><span class=s2>, sites reset </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=n>sites_added</span><span class=p>,</span> <span class=n>reset_missing</span>
    <span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>